!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).PubNub=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n;function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}function s(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}!function(t){!function(e,n){var r=Math.pow(2,-24),s=Math.pow(2,32),i=Math.pow(2,53);var o={encode:function(e){var t,r=new ArrayBuffer(256),o=new DataView(r),a=0;function c(e){for(var n=r.byteLength,s=a+e;n<s;)n*=2;if(n!==r.byteLength){var i=o;r=new ArrayBuffer(n),o=new DataView(r);for(var c=a+3>>2,u=0;u<c;++u)o.setUint32(4*u,i.getUint32(4*u))}return t=e,o}function u(){a+=t}function l(e){u(c(1).setUint8(a,e))}function h(e){for(var t=c(e.length),n=0;n<e.length;++n)t.setUint8(a+n,e[n]);u()}function p(e,t){t<24?l(e<<5|t):t<256?(l(e<<5|24),l(t)):t<65536?(l(e<<5|25),function(e){u(c(2).setUint16(a,e))}(t)):t<4294967296?(l(e<<5|26),function(e){u(c(4).setUint32(a,e))}(t)):(l(e<<5|27),function(e){var t=e%s,n=(e-t)/s,r=c(8);r.setUint32(a,n),r.setUint32(a+4,t),u()}(t))}if(function e(t){var r;if(!1===t)return l(244);if(!0===t)return l(245);if(null===t)return l(246);if(t===n)return l(247);switch(typeof t){case"number":if(Math.floor(t)===t){if(0<=t&&t<=i)return p(0,t);if(-i<=t&&t<0)return p(1,-(t+1))}return l(251),function(e){u(c(8).setFloat64(a,e))}(t);case"string":var s=[];for(r=0;r<t.length;++r){var o=t.charCodeAt(r);o<128?s.push(o):o<2048?(s.push(192|o>>6),s.push(128|63&o)):o<55296?(s.push(224|o>>12),s.push(128|o>>6&63),s.push(128|63&o)):(o=(1023&o)<<10,o|=1023&t.charCodeAt(++r),o+=65536,s.push(240|o>>18),s.push(128|o>>12&63),s.push(128|o>>6&63),s.push(128|63&o))}return p(3,s.length),h(s);default:var d;if(Array.isArray(t))for(p(4,d=t.length),r=0;r<d;++r)e(t[r]);else if(t instanceof Uint8Array)p(2,t.length),h(t);else{var g=Object.keys(t);for(p(5,d=g.length),r=0;r<d;++r){var y=g[r];e(y),e(t[y])}}}}(e),"slice"in r)return r.slice(0,a);for(var d=new ArrayBuffer(a),g=new DataView(d),y=0;y<a;++y)g.setUint8(y,o.getUint8(y));return d},decode:function(e,t,i){var o=new DataView(e),a=0;function c(e,t){return a+=t,e}function u(t){return c(new Uint8Array(e,a,t),t)}function l(){return c(o.getUint8(a),1)}function h(){return c(o.getUint16(a),2)}function p(){return c(o.getUint32(a),4)}function d(){return 255===o.getUint8(a)&&(a+=1,!0)}function g(e){if(e<24)return e;if(24===e)return l();if(25===e)return h();if(26===e)return p();if(27===e)return p()*s+p();if(31===e)return-1;throw"Invalid length encoding"}function y(e){var t=l();if(255===t)return-1;var n=g(31&t);if(n<0||t>>5!==e)throw"Invalid indefinite length element";return n}function f(e,t){for(var n=0;n<t;++n){var r=l();128&r&&(r<224?(r=(31&r)<<6|63&l(),t-=1):r<240?(r=(15&r)<<12|(63&l())<<6|63&l(),t-=2):(r=(15&r)<<18|(63&l())<<12|(63&l())<<6|63&l(),t-=3)),r<65536?e.push(r):(r-=65536,e.push(55296|r>>10),e.push(56320|1023&r))}}"function"!=typeof t&&(t=function(e){return e}),"function"!=typeof i&&(i=function(){return n});var b=function e(){var s,p,b=l(),m=b>>5,v=31&b;if(7===m)switch(v){case 25:return function(){var e=new ArrayBuffer(4),t=new DataView(e),n=h(),s=32768&n,i=31744&n,o=1023&n;if(31744===i)i=261120;else if(0!==i)i+=114688;else if(0!==o)return o*r;return t.setUint32(0,s<<16|i<<13|o<<13),t.getFloat32(0)}();case 26:return c(o.getFloat32(a),4);case 27:return c(o.getFloat64(a),8)}if((p=g(v))<0&&(m<2||6<m))throw"Invalid length";switch(m){case 0:return p;case 1:return-1-p;case 2:if(p<0){for(var w=[],E=0;(p=y(m))>=0;)E+=p,w.push(u(p));var C=new Uint8Array(E),N=0;for(s=0;s<w.length;++s)C.set(w[s],N),N+=w[s].length;return C}return u(p);case 3:var S=[];if(p<0)for(;(p=y(m))>=0;)f(S,p);else f(S,p);return String.fromCharCode.apply(null,S);case 4:var P;if(p<0)for(P=[];!d();)P.push(e());else for(P=new Array(p),s=0;s<p;++s)P[s]=e();return P;case 5:var k={};for(s=0;s<p||p<0&&!d();++s){k[e()]=e()}return k;case 6:return t(e(),p);case 7:switch(p){case 20:return!1;case 21:return!0;case 22:return null;case 23:return n;default:return i(p)}}}();if(a!==e.byteLength)throw"Remaining bytes";return b}};t.exports?t.exports=o:e.CBOR||(e.CBOR=o)}(e)}({exports:{}}),"function"==typeof SuppressedError&&SuppressedError,new TextEncoder,new TextDecoder,function(e){e.PNNetworkIssuesCategory="PNNetworkIssuesCategory",e.PNTimeoutCategory="PNTimeoutCategory",e.PNCancelledCategory="PNCancelledCategory",e.PNBadRequestCategory="PNBadRequestCategory",e.PNAccessDeniedCategory="PNAccessDeniedCategory",e.PNValidationErrorCategory="PNValidationErrorCategory",e.PNAcknowledgmentCategory="PNAcknowledgmentCategory",e.PNUnknownCategory="PNUnknownCategory",e.PNNetworkUpCategory="PNNetworkUpCategory",e.PNNetworkDownCategory="PNNetworkDownCategory",e.PNReconnectedCategory="PNReconnectedCategory",e.PNConnectedCategory="PNConnectedCategory",e.PNRequestMessageCountExceededCategory="PNRequestMessageCountExceededCategory",e.PNDisconnectedCategory="PNDisconnectedCategory",e.PNConnectionErrorCategory="PNConnectionErrorCategory",e.PNDisconnectedUnexpectedlyCategory="PNDisconnectedUnexpectedlyCategory"}(n||(n={}));var i=n;class o extends Error{constructor(e,t){super(e),this.status=t,this.name="PubNubError",this.message=e,Object.setPrototypeOf(this,new.target.prototype)}}function a(e,t){return n=Object.assign({message:e},void 0!==t?{statusCode:t}:{}),null!==(r=n.statusCode)&&void 0!==r||(n.statusCode=0),Object.assign(Object.assign({},n),{statusCode:n.statusCode,category:i.PNValidationErrorCategory,error:!0});var n,r}var c,u,l,h,p,d=d||function(e,t){var n={},r=n.lib={},s=function(){},i=r.Base={extend:function(e){s.prototype=this;var t=new s;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var s=0;s<e;s++)t[r+s>>>2]|=(n[s>>>2]>>>24-s%4*8&255)<<24-(r+s)%4*8;else if(65535<n.length)for(s=0;s<e;s+=4)t[r+s>>>2]=n[s>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),a=n.enc={},c=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var s=t[r>>>2]>>>24-r%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},u=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,s=n.sigBytes,i=this.blockSize,a=s/(4*i);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*i,s=e.min(4*t,s),t){for(var c=0;c<t;c+=i)this._doProcessBlock(r,c);c=r.splice(0,t),n.sigBytes-=s}return new o.init(c,s)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=h.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new p.HMAC.init(e,n).finalize(t)}}});var p=n.algo={};return n}(Math);!function(e){for(var t=d,n=(s=t.lib).WordArray,r=s.Hasher,s=t.algo,i=[],o=[],a=function(e){return 4294967296*(e-(0|e))|0},c=2,u=0;64>u;){var l;e:{l=c;for(var h=e.sqrt(l),p=2;p<=h;p++)if(!(l%p)){l=!1;break e}l=!0}l&&(8>u&&(i[u]=a(e.pow(c,.5))),o[u]=a(e.pow(c,1/3)),u++),c++}var g=[];s=s.SHA256=r.extend({_doReset:function(){this._hash=new n.init(i.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],s=n[1],i=n[2],a=n[3],c=n[4],u=n[5],l=n[6],h=n[7],p=0;64>p;p++){if(16>p)g[p]=0|e[t+p];else{var d=g[p-15],y=g[p-2];g[p]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+g[p-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+g[p-16]}d=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&l)+o[p]+g[p],y=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&s^r&i^s&i),h=l,l=u,u=c,c=a+d|0,a=i,i=s,s=r,r=d+y|0}n[0]=n[0]+r|0,n[1]=n[1]+s|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0,n[5]=n[5]+u|0,n[6]=n[6]+l|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,s=8*t.sigBytes;return n[s>>>5]|=128<<24-s%32,n[14+(s+64>>>9<<4)]=e.floor(r/4294967296),n[15+(s+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(s),t.HmacSHA256=r._createHmacHelper(s)}(Math),u=(c=d).enc.Utf8,c.algo.HMAC=c.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),i=this._iKey=t.clone(),o=s.words,a=i.words,c=0;c<n;c++)o[c]^=1549556828,a[c]^=909522486;s.sigBytes=i.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),h=(l=d).lib.WordArray,l.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var s=0;s<n;s+=3)for(var i=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,o=0;4>o&&s+.75*o<n;o++)e.push(r.charAt(i>>>6*(3-o)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(r=n.charAt(64))&&-1!=(r=e.indexOf(r))&&(t=r);for(var r=[],s=0,i=0;i<t;i++)if(i%4){var o=n.indexOf(e.charAt(i-1))<<i%4*2,a=n.indexOf(e.charAt(i))>>>6-i%4*2;r[s>>>2]|=(o|a)<<24-s%4*8,s++}return h.create(r,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,n,r,s,i,o){return((e=e+(t&n|~t&r)+s+o)<<i|e>>>32-i)+t}function n(e,t,n,r,s,i,o){return((e=e+(t&r|n&~r)+s+o)<<i|e>>>32-i)+t}function r(e,t,n,r,s,i,o){return((e=e+(t^n^r)+s+o)<<i|e>>>32-i)+t}function s(e,t,n,r,s,i,o){return((e=e+(n^(t|~r))+s+o)<<i|e>>>32-i)+t}for(var i=d,o=(c=i.lib).WordArray,a=c.Hasher,c=i.algo,u=[],l=0;64>l;l++)u[l]=4294967296*e.abs(e.sin(l+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var o=0;16>o;o++){var a=e[c=i+o];e[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}o=this._hash.words;var c=e[i+0],l=(a=e[i+1],e[i+2]),h=e[i+3],p=e[i+4],d=e[i+5],g=e[i+6],y=e[i+7],f=e[i+8],b=e[i+9],m=e[i+10],v=e[i+11],w=e[i+12],E=e[i+13],C=e[i+14],N=e[i+15],S=t(S=o[0],M=o[1],k=o[2],P=o[3],c,7,u[0]),P=t(P,S,M,k,a,12,u[1]),k=t(k,P,S,M,l,17,u[2]),M=t(M,k,P,S,h,22,u[3]);S=t(S,M,k,P,p,7,u[4]),P=t(P,S,M,k,d,12,u[5]),k=t(k,P,S,M,g,17,u[6]),M=t(M,k,P,S,y,22,u[7]),S=t(S,M,k,P,f,7,u[8]),P=t(P,S,M,k,b,12,u[9]),k=t(k,P,S,M,m,17,u[10]),M=t(M,k,P,S,v,22,u[11]),S=t(S,M,k,P,w,7,u[12]),P=t(P,S,M,k,E,12,u[13]),k=t(k,P,S,M,C,17,u[14]),S=n(S,M=t(M,k,P,S,N,22,u[15]),k,P,a,5,u[16]),P=n(P,S,M,k,g,9,u[17]),k=n(k,P,S,M,v,14,u[18]),M=n(M,k,P,S,c,20,u[19]),S=n(S,M,k,P,d,5,u[20]),P=n(P,S,M,k,m,9,u[21]),k=n(k,P,S,M,N,14,u[22]),M=n(M,k,P,S,p,20,u[23]),S=n(S,M,k,P,b,5,u[24]),P=n(P,S,M,k,C,9,u[25]),k=n(k,P,S,M,h,14,u[26]),M=n(M,k,P,S,f,20,u[27]),S=n(S,M,k,P,E,5,u[28]),P=n(P,S,M,k,l,9,u[29]),k=n(k,P,S,M,y,14,u[30]),S=r(S,M=n(M,k,P,S,w,20,u[31]),k,P,d,4,u[32]),P=r(P,S,M,k,f,11,u[33]),k=r(k,P,S,M,v,16,u[34]),M=r(M,k,P,S,C,23,u[35]),S=r(S,M,k,P,a,4,u[36]),P=r(P,S,M,k,p,11,u[37]),k=r(k,P,S,M,y,16,u[38]),M=r(M,k,P,S,m,23,u[39]),S=r(S,M,k,P,E,4,u[40]),P=r(P,S,M,k,c,11,u[41]),k=r(k,P,S,M,h,16,u[42]),M=r(M,k,P,S,g,23,u[43]),S=r(S,M,k,P,b,4,u[44]),P=r(P,S,M,k,w,11,u[45]),k=r(k,P,S,M,N,16,u[46]),S=s(S,M=r(M,k,P,S,l,23,u[47]),k,P,c,6,u[48]),P=s(P,S,M,k,y,10,u[49]),k=s(k,P,S,M,C,15,u[50]),M=s(M,k,P,S,d,21,u[51]),S=s(S,M,k,P,w,6,u[52]),P=s(P,S,M,k,h,10,u[53]),k=s(k,P,S,M,m,15,u[54]),M=s(M,k,P,S,a,21,u[55]),S=s(S,M,k,P,f,6,u[56]),P=s(P,S,M,k,N,10,u[57]),k=s(k,P,S,M,g,15,u[58]),M=s(M,k,P,S,E,21,u[59]),S=s(S,M,k,P,p,6,u[60]),P=s(P,S,M,k,v,10,u[61]),k=s(k,P,S,M,l,15,u[62]),M=s(M,k,P,S,b,21,u[63]);o[0]=o[0]+S|0,o[1]=o[1]+M|0,o[2]=o[2]+k|0,o[3]=o[3]+P|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,s=8*t.sigBytes;n[s>>>5]|=128<<24-s%32;var i=e.floor(r/4294967296);for(n[15+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)s=n[r],n[r]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.MD5=a._createHelper(c),i.HmacMD5=a._createHmacHelper(c)}(Math),function(){var e,t=d,n=(e=t.lib).Base,r=e.WordArray,s=(e=t.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(a=this.cfg).hasher.create(),s=r.create(),i=s.words,o=a.keySize,a=a.iterations;i.length<o;){c&&n.update(c);var c=n.update(e).finalize(t);n.reset();for(var u=1;u<a;u++)c=n.finalize(c),n.reset();s.concat(c)}return s.sigBytes=4*o,s}});t.EvpKDF=function(e,t,n){return s.create(n).compute(e,t)}}(),d.lib.Cipher||function(e){var t=(g=d).lib,n=t.Base,r=t.WordArray,s=t.BufferedBlockAlgorithm,i=g.enc.Base64,o=g.algo.EvpKDF,a=t.Cipher=s.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?y:p).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?y:p).decrypt(e,t,n,r)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=g.mode={},u=function(e,t,n){var r=this._iv;r?this._iv=undefined:r=this._prevBlock;for(var s=0;s<n;s++)e[t+s]^=r[s]},l=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;u.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),l.Decryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,s=e.slice(t,t+r);n.decryptBlock(e,t),u.call(this,e,t,r),this._prevBlock=s}}),c=c.CBC=l,l=(g.pad={}).Pkcs7={pad:function(e,t){for(var n,s=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,i=[],o=0;o<n;o+=4)i.push(s);n=r.create(i,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:l}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),p=(c=(g.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(i)},parse:function(e){var t=(e=i.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var s=e.createEncryptor(n,r);return t=s.finalize(t),s=s.cfg,h.create({ciphertext:t,key:n,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),g=(g.kdf={}).OpenSSL={execute:function(e,t,n,s){return s||(s=r.random(8)),e=o.create({keySize:t+n}).compute(e,s),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,h.create({key:e,iv:n,salt:s})}},y=t.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:g}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=p.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,p.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=d,t=e.lib.BlockCipher,n=e.algo,r=[],s=[],i=[],o=[],a=[],c=[],u=[],l=[],h=[],p=[],g=[],y=0;256>y;y++)g[y]=128>y?y<<1:y<<1^283;var f=0,b=0;for(y=0;256>y;y++){var m=(m=b^b<<1^b<<2^b<<3^b<<4)>>>8^255&m^99;r[f]=m,s[m]=f;var v=g[f],w=g[v],E=g[w],C=257*g[m]^16843008*m;i[f]=C<<24|C>>>8,o[f]=C<<16|C>>>16,a[f]=C<<8|C>>>24,c[f]=C,C=16843009*E^65537*w^257*v^16843008*f,u[m]=C<<24|C>>>8,l[m]=C<<16|C>>>16,h[m]=C<<8|C>>>24,p[m]=C,f?(f=v^g[g[g[E^v]]],b^=g[g[b]]):f=b=1}var N=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),s=this._keySchedule=[],i=0;i<n;i++)if(i<t)s[i]=e[i];else{var o=s[i-1];i%t?6<t&&4==i%t&&(o=r[o>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[255&o]):(o=r[(o=o<<8|o>>>24)>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[255&o],o^=N[i/t|0]<<24),s[i]=s[i-t]^o}for(e=this._invKeySchedule=[],t=0;t<n;t++)i=n-t,o=t%4?s[i]:s[i-4],e[t]=4>t||4>=i?o:u[r[o>>>24]]^l[r[o>>>16&255]]^h[r[o>>>8&255]]^p[r[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,o,a,c,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,l,h,p,s),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,s,i,o,a){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],h=e[t+2]^n[2],p=e[t+3]^n[3],d=4,g=1;g<c;g++){var y=r[u>>>24]^s[l>>>16&255]^i[h>>>8&255]^o[255&p]^n[d++],f=r[l>>>24]^s[h>>>16&255]^i[p>>>8&255]^o[255&u]^n[d++],b=r[h>>>24]^s[p>>>16&255]^i[u>>>8&255]^o[255&l]^n[d++];p=r[p>>>24]^s[u>>>16&255]^i[l>>>8&255]^o[255&h]^n[d++],u=y,l=f,h=b}y=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&p])^n[d++],f=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[p>>>8&255]<<8|a[255&u])^n[d++],b=(a[h>>>24]<<24|a[p>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^n[d++],p=(a[p>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^n[d++],e[t]=y,e[t+1]=f,e[t+2]=b,e[t+3]=p},keySize:8});e.AES=t._createHelper(n)}(),d.mode.ECB=((p=d.lib.BlockCipherMode.extend()).Encryptor=p.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),p.Decryptor=p.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),p),new TextEncoder,new TextDecoder,new TextEncoder,new TextDecoder,new TextEncoder,new TextDecoder,new TextDecoder;class g extends Error{static create(e,t){return e instanceof Error?g.createFromError(e):g.createFromServiceResponse(e,t)}static createFromError(e){let t=i.PNUnknownCategory,n="Unknown error",r="Error";if(!e)return new g(n,t,0);if(e instanceof g)return e;if(e instanceof Error&&(n=e.message,r=e.name),"AbortError"===r||-1!==n.indexOf("Aborted"))t=i.PNCancelledCategory,n="Request cancelled";else if(-1!==n.indexOf("timeout"))t=i.PNTimeoutCategory,n="Request timeout";else if(-1!==n.indexOf("network"))t=i.PNNetworkIssuesCategory,n="Network issues";else if("TypeError"===r)t=-1!==n.indexOf("Load failed")||-1!=n.indexOf("Failed to fetch")?i.PNTimeoutCategory:i.PNBadRequestCategory;else if("FetchError"===r){const r=e.code;["ECONNREFUSED","ENETUNREACH","ENOTFOUND","ECONNRESET","EAI_AGAIN"].includes(r)&&(t=i.PNNetworkIssuesCategory),"ECONNREFUSED"===r?n="Connection refused":"ENETUNREACH"===r?n="Network not reachable":"ENOTFOUND"===r?n="Server not found":"ECONNRESET"===r?n="Connection reset by peer":"EAI_AGAIN"===r?n="Name resolution error":"ETIMEDOUT"===r?(t=i.PNTimeoutCategory,n="Request timeout"):n=`Unknown system error: ${e}`}else"Request timeout"===n&&(t=i.PNTimeoutCategory);return new g(n,t,0,e)}static createFromServiceResponse(e,t){let n,r=i.PNUnknownCategory,s="Unknown error",{status:o}=e;if(null!=t||(t=e.body),402===o?s="Not available for used key set. Contact support@pubnub.com":400===o?(r=i.PNBadRequestCategory,s="Bad request"):403===o&&(r=i.PNAccessDeniedCategory,s="Access denied"),t&&t.byteLength>0){const r=(new TextDecoder).decode(t);if(-1!==e.headers["content-type"].indexOf("text/javascript")||-1!==e.headers["content-type"].indexOf("application/json"))try{const e=JSON.parse(r);"object"!=typeof e||Array.isArray(e)||("error"in e&&(1===e.error||!0===e.error)&&"status"in e&&"number"==typeof e.status&&"message"in e&&"service"in e?(n=e,o=e.status):n=e,"error"in e&&e.error instanceof Error&&(n=e.error))}catch(e){n=r}else if(-1!==e.headers["content-type"].indexOf("xml")){const e=/<Message>(.*)<\/Message>/gi.exec(r);s=e?`Upload to bucket failed: ${e[1]}`:"Upload to bucket failed."}else n=r}return new g(s,r,o,n)}constructor(e,t,n,r){super(e),this.category=t,this.statusCode=n,this.errorData=r,this.name="PubNubAPIError"}toStatus(e){return{error:!0,category:this.category,operation:e,statusCode:this.statusCode,errorData:this.errorData}}toPubNubError(e,t){return new o(null!=t?t:this.message,this.toStatus(e))}}const y=e=>encodeURIComponent(e).replace(/[!~*'()]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)),f=(e,t)=>{const n=e.map((e=>y(e)));return n.length?n.join(","):null!=t?t:""};class b{constructor(e=!1,t){this.keepAlive=e,this.logVerbosity=t}makeSendable(e){let t,n;return e.cancellable&&(n=new AbortController,t={abortController:n,abort:()=>null==n?void 0:n.abort()}),[this.requestFromTransportRequest(e).then((t=>{const r=(new Date).getTime();this.logRequestProcessProgress(t);const s=new Promise(((t,n)=>{const r=setTimeout((()=>{clearTimeout(r),n(new Error("Request timeout"))}),1e3*e.timeout)}));return Promise.race([fetch(t,{signal:null==n?void 0:n.signal}),s]).then((e=>e.arrayBuffer().then((t=>[e,t])))).then((e=>{const n=e[1].byteLength>0?e[1]:void 0,{status:s,headers:i}=e[0],o={};i.forEach(((e,t)=>o[t]=e.toLowerCase()));const a={status:s,url:t.url,headers:o,body:n};if(s>=400)throw g.create(a);return this.logRequestProcessProgress(t,(new Date).getTime()-r,n),a})).catch((e=>{throw g.create(e)}))})),t]}request(e){return e}requestFromTransportRequest(e){return s(this,void 0,void 0,(function*(){let t,n=e.path;if(e.formData&&e.formData.length>0){e.queryParameters={};const n=e.body,r=new FormData;for(const{key:t,value:n}of e.formData)r.append(t,n);try{const e=yield n.toArrayBuffer();r.append("file",new Blob([e],{type:"application/octet-stream"}),n.name)}catch(e){try{const e=yield n.toFileUri();r.append("file",e,n.name)}catch(e){}}t=r}else e.body&&("string"==typeof e.body||e.body instanceof ArrayBuffer)&&(t=e.body);var r;return e.queryParameters&&0!==Object.keys(e.queryParameters).length&&(n=`${n}?${r=e.queryParameters,Object.keys(r).map((e=>{const t=r[e];return Array.isArray(t)?t.map((t=>`${e}=${y(t)}`)).join("&"):`${e}=${y(t)}`})).join("&")}`),new Request(`${e.origin}${n}`,{method:e.method,headers:e.headers,redirect:"follow",body:t})}))}logRequestProcessProgress(e,t,n){if(!this.logVerbosity)return;const{protocol:r,host:s,pathname:i,search:o}=new URL(e.url),a=(new Date).toISOString();if(t){const e=n?b.decoder.decode(n):void 0;console.log(">>>>>>"),console.log(`[${a} / ${t}]`,`\n${r}//${s}${i}`,`\n${o}`,`\n${e}`),console.log("-----")}else console.log("<<<<<"),console.log(`[${a}]`,`\n${r}//${s}${i}`,`\n${o}`),console.log("-----")}}b.decoder=new TextDecoder;const m=e=>{var t,n,r;return e.subscriptionWorkerUrl&&"undefined"==typeof SharedWorker&&(e.subscriptionWorkerUrl=null),Object.assign(Object.assign({},(e=>{var t,n,r,s,i,a,c,u,l,h,p,d,g,y;const f=Object.assign({},e);if(null!==(t=f.logVerbosity)&&void 0!==t||(f.logVerbosity=!1),null!==(n=f.ssl)&&void 0!==n||(f.ssl=!0),null!==(r=f.transactionalRequestTimeout)&&void 0!==r||(f.transactionalRequestTimeout=15),null!==(s=f.subscribeRequestTimeout)&&void 0!==s||(f.subscribeRequestTimeout=310),null!==(i=f.restore)&&void 0!==i||(f.restore=!1),null!==(a=f.useInstanceId)&&void 0!==a||(f.useInstanceId=!1),null!==(c=f.suppressLeaveEvents)&&void 0!==c||(f.suppressLeaveEvents=!1),null!==(u=f.requestMessageCountThreshold)&&void 0!==u||(f.requestMessageCountThreshold=100),null!==(l=f.autoNetworkDetection)&&void 0!==l||(f.autoNetworkDetection=!1),null!==(h=f.enableEventEngine)&&void 0!==h||(f.enableEventEngine=!1),null!==(p=f.maintainPresenceState)&&void 0!==p||(f.maintainPresenceState=!0),null!==(d=f.keepAlive)&&void 0!==d||(f.keepAlive=!1),f.userId&&f.uuid)throw new o("PubNub client configuration error: use only 'userId'");if(null!==(g=f.userId)&&void 0!==g||(f.userId=f.uuid),!f.userId)throw new o("PubNub client configuration error: 'userId' not set");if(0===(null===(y=f.userId)||void 0===y?void 0:y.trim().length))throw new o("PubNub client configuration error: 'userId' is empty");f.origin||(f.origin=Array.from({length:20},((e,t)=>`ps${t+1}.pndsn.com`)));const b={subscribeKey:f.subscribeKey,publishKey:f.publishKey,secretKey:f.secretKey};void 0!==f.presenceTimeout&&f.presenceTimeout<20&&(f.presenceTimeout=20,console.log("WARNING: Presence timeout is less than the minimum. Using minimum value: ",20)),void 0!==f.presenceTimeout?f.heartbeatInterval=f.presenceTimeout/2-1:f.presenceTimeout=300;let m=!1,v=!0,w=5,E=!1,C=!0;return void 0!==f.dedupeOnSubscribe&&"boolean"==typeof f.dedupeOnSubscribe&&(E=f.dedupeOnSubscribe),void 0!==f.useRequestId&&"boolean"==typeof f.useRequestId&&(C=f.useRequestId),void 0!==f.announceSuccessfulHeartbeats&&"boolean"==typeof f.announceSuccessfulHeartbeats&&(m=f.announceSuccessfulHeartbeats),void 0!==f.announceFailedHeartbeats&&"boolean"==typeof f.announceFailedHeartbeats&&(v=f.announceFailedHeartbeats),void 0!==f.fileUploadPublishRetryLimit&&"number"==typeof f.fileUploadPublishRetryLimit&&(w=f.fileUploadPublishRetryLimit),Object.assign(Object.assign({},f),{keySet:b,dedupeOnSubscribe:E,maximumCacheSize:100,useRequestId:C,announceSuccessfulHeartbeats:m,announceFailedHeartbeats:v,fileUploadPublishRetryLimit:w})})(e)),{listenToBrowserNetworkEvents:null===(t=e.listenToBrowserNetworkEvents)||void 0===t||t,subscriptionWorkerUrl:e.subscriptionWorkerUrl,subscriptionWorkerLogVerbosity:null!==(n=e.subscriptionWorkerLogVerbosity)&&void 0!==n&&n,keepAlive:null===(r=e.keepAlive)||void 0===r||r})};var v={exports:{}};
/*! lil-uuid - v0.1 - MIT License - https://github.com/lil-js/uuid */!function(e,t){!function(e){var t="0.1.0",n={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function r(){var e,t,n="";for(e=0;e<32;e++)t=16*Math.random()|0,8!==e&&12!==e&&16!==e&&20!==e||(n+="-"),n+=(12===e?4:16===e?3&t|8:t).toString(16);return n}function s(e,t){var r=n[t||"all"];return r&&r.test(e)||!1}r.isUUID=s,r.VERSION=t,e.uuid=r,e.isUUID=s}(t),null!==e&&(e.exports=t.uuid)}(v,v.exports);var w=t(v.exports),E={createUUID:()=>w.uuid?w.uuid():w()};const C=(e,t)=>{var n,r,s;null===(n=e.retryConfiguration)||void 0===n||n.validate(),null!==(r=e.useRandomIVs)&&void 0!==r||(e.useRandomIVs=true),e.origin=N(null!==(s=e.ssl)&&void 0!==s&&s,e.origin);const i=e.cryptoModule;i&&delete e.cryptoModule;const o=Object.assign(Object.assign({},e),{_pnsdkSuffix:{},_instanceId:`pn-${E.createUUID()}`,_cryptoModule:void 0,_cipherKey:void 0,_setupCryptoModule:t,get instanceId(){if(this.useInstanceId)return this._instanceId},getUserId(){return this.userId},setUserId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this.userId=e},getAuthKey(){return this.authKey},setAuthKey(e){this.authKey=e},getFilterExpression(){return this.filterExpression},setFilterExpression(e){this.filterExpression=e},getCipherKey(){return this._cipherKey},setCipherKey(t){this._cipherKey=t,t||!this._cryptoModule?t&&this._setupCryptoModule&&(this._cryptoModule=this._setupCryptoModule({cipherKey:t,useRandomIVs:e.useRandomIVs,customEncrypt:this.getCustomEncrypt(),customDecrypt:this.getCustomDecrypt()})):this._cryptoModule=void 0},getCryptoModule(){return this._cryptoModule},getUseRandomIVs:()=>e.useRandomIVs,setPresenceTimeout(e){this.heartbeatInterval=e/2-1,this.presenceTimeout=e},getPresenceTimeout(){return this.presenceTimeout},getHeartbeatInterval(){return this.heartbeatInterval},setHeartbeatInterval(e){this.heartbeatInterval=e},getTransactionTimeout(){return this.transactionalRequestTimeout},getSubscribeTimeout(){return this.subscribeRequestTimeout},get PubNubFile(){return e.PubNubFile},get version(){return"8.2.7"},getVersion(){return this.version},_addPnsdkSuffix(e,t){this._pnsdkSuffix[e]=`${t}`},_getPnsdkSuffix(e){const t=Object.values(this._pnsdkSuffix).join(e);return t.length>0?e+t:""},getUUID(){return this.getUserId()},setUUID(e){this.setUserId(e)},getCustomEncrypt:()=>e.customEncrypt,getCustomDecrypt:()=>e.customDecrypt});return e.cipherKey?o.setCipherKey(e.cipherKey):i&&(o._cryptoModule=i),o},N=(e,t)=>{const n=e?"https://":"http://";return"string"==typeof t?`${n}${t}`:`${n}${t[Math.floor(Math.random()*t.length)]}`};var S;!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.DELETE="DELETE",e.LOCAL="LOCAL"}(S||(S={})),new TextDecoder("utf-8");class P{constructor(e){this.configuration=e}makeSendable(e){return this.configuration.transport.makeSendable(this.request(e))}request(e){var t;const{clientConfiguration:n}=this.configuration;return(e=this.configuration.transport.request(e)).queryParameters||(e.queryParameters={}),n.useInstanceId&&(e.queryParameters.instanceid=n.instanceId),e.queryParameters.uuid||(e.queryParameters.uuid=n.userId),n.useRequestId&&(e.queryParameters.requestid=e.identifier),e.queryParameters.pnsdk=this.generatePNSDK(),null!==(t=e.origin)&&void 0!==t||(e.origin=n.origin),this.authenticateRequest(e),this.signRequest(e),e}authenticateRequest(e){var t;if(e.path.startsWith("/v2/auth/")||e.path.startsWith("/v3/pam/")||e.path.startsWith("/time"))return;const{clientConfiguration:n,tokenManager:r}=this.configuration,s=null!==(t=r&&r.getToken())&&void 0!==t?t:n.authKey;s&&(e.queryParameters.auth=s)}signRequest(e){this.signatureGenerator&&!e.path.startsWith("/time")&&(e.queryParameters.timestamp=String(Math.floor((new Date).getTime()/1e3)),e.queryParameters.signature=this.signatureGenerator.signature(e))}generatePNSDK(){const{clientConfiguration:e}=this.configuration;if(e.sdkName)return e.sdkName;let t=`PubNub-JS-${e.sdkFamily}`;e.partnerId&&(t+=`-${e.partnerId}`),t+=`/${e.getVersion()}`;const n=e._getPnsdkSuffix(" ");return n.length>0&&(t+=n),t}}class k{constructor(){this.listeners=[]}addListener(e){this.listeners.includes(e)||this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter((t=>t!==e))}removeAllListeners(){this.listeners=[]}announceStatus(e){this.listeners.forEach((t=>{t.status&&t.status(e)}))}announcePresence(e){this.listeners.forEach((t=>{t.presence&&t.presence(e)}))}announceMessage(e){this.listeners.forEach((t=>{t.message&&t.message(e)}))}announceSignal(e){this.listeners.forEach((t=>{t.signal&&t.signal(e)}))}announceMessageAction(e){this.listeners.forEach((t=>{t.messageAction&&t.messageAction(e)}))}announceFile(e){this.listeners.forEach((t=>{t.file&&t.file(e)}))}announceObjects(e){this.listeners.forEach((t=>{t.objects&&t.objects(e)}))}announceNetworkUp(){this.listeners.forEach((e=>{e.status&&e.status({category:i.PNNetworkUpCategory})}))}announceNetworkDown(){this.listeners.forEach((e=>{e.status&&e.status({category:i.PNNetworkDownCategory})}))}announceUser(e){this.listeners.forEach((t=>{t.user&&t.user(e)}))}announceSpace(e){this.listeners.forEach((t=>{t.space&&t.space(e)}))}announceMembership(e){this.listeners.forEach((t=>{t.membership&&t.membership(e)}))}}class M{constructor(e){this.time=e}onReconnect(e){this.callback=e}startPolling(){this.timeTimer=setInterval((()=>this.callTime()),3e3)}stopPolling(){this.timeTimer&&clearInterval(this.timeTimer),this.timeTimer=null}callTime(){this.time((e=>{e.error||(this.stopPolling(),this.callback&&this.callback())}))}}class O{_config;hashHistory;constructor({config:e}){this.hashHistory=[],this._config=e}getKey(e){const t=(e=>{let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n+=1)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t})(JSON.stringify(e.message)).toString();return`${e.timetoken}-${t}`}isDuplicate(e){return this.hashHistory.includes(this.getKey(e))}addEntry(e){this.hashHistory.length>=this._config.maximumCacheSize&&this.hashHistory.shift(),this.hashHistory.push(this.getKey(e))}clearHistory(){this.hashHistory=[]}}class A{constructor(e,t,n,r,s,i,o){this.configuration=e,this.listenerManager=t,this.eventEmitter=n,this.subscribeCall=r,this.heartbeatCall=s,this.leaveCall=i,this.reconnectionManager=new M(o),this.dedupingManager=new O({config:this.configuration}),this.heartbeatChannelGroups={},this.heartbeatChannels={},this.presenceChannelGroups={},this.presenceChannels={},this.heartbeatTimer=null,this.presenceState={},this.pendingChannelGroupSubscriptions=new Set,this.pendingChannelSubscriptions=new Set,this.channelGroups={},this.channels={},this.currentTimetoken="0",this.lastTimetoken="0",this.storedTimetoken=null,this.subscriptionStatusAnnounced=!1,this.isOnline=!0}get subscribedChannels(){return Object.keys(this.channels)}get subscribedChannelGroups(){return Object.keys(this.channelGroups)}get abort(){return this._subscribeAbort}set abort(e){this._subscribeAbort=e}disconnect(){this.stopSubscribeLoop(),this.stopHeartbeatTimer(),this.reconnectionManager.stopPolling()}reconnect(){this.startSubscribeLoop(),this.startHeartbeatTimer()}subscribe(e){const{channels:t,channelGroups:n,timetoken:r,withPresence:s=!1,withHeartbeats:i=!1}=e;r&&(this.lastTimetoken=this.currentTimetoken,this.currentTimetoken=r),"0"!==this.currentTimetoken&&0!==this.currentTimetoken&&(this.storedTimetoken=this.currentTimetoken,this.currentTimetoken=0),null==t||t.forEach((e=>{this.pendingChannelSubscriptions.add(e),this.channels[e]={},s&&(this.presenceChannels[e]={}),(i||this.configuration.getHeartbeatInterval())&&(this.heartbeatChannels[e]={})})),null==n||n.forEach((e=>{this.pendingChannelGroupSubscriptions.add(e),this.channelGroups[e]={},s&&(this.presenceChannelGroups[e]={}),(i||this.configuration.getHeartbeatInterval())&&(this.heartbeatChannelGroups[e]={})})),this.subscriptionStatusAnnounced=!1,this.reconnect()}unsubscribe(e,t){let{channels:n,channelGroups:s}=e;const i=new Set,o=new Set;null==n||n.forEach((e=>{e in this.channels&&(delete this.channels[e],o.add(e),e in this.heartbeatChannels&&delete this.heartbeatChannels[e]),e in this.presenceState&&delete this.presenceState[e],e in this.presenceChannels&&(delete this.presenceChannels[e],o.add(e))})),null==s||s.forEach((e=>{e in this.channelGroups&&(delete this.channelGroups[e],i.add(e),e in this.heartbeatChannelGroups&&delete this.heartbeatChannelGroups[e]),e in this.presenceState&&delete this.presenceState[e],e in this.presenceChannelGroups&&(delete this.presenceChannelGroups[e],i.add(e))})),0===o.size&&0===i.size||(!1!==this.configuration.suppressLeaveEvents||t||(s=Array.from(i),n=Array.from(o),this.leaveCall({channels:n,channelGroups:s},(e=>{const{error:t}=e,i=r(e,["error"]);let o;t&&(e.errorData&&"object"==typeof e.errorData&&"message"in e.errorData&&"string"==typeof e.errorData.message?o=e.errorData.message:"message"in e&&"string"==typeof e.message&&(o=e.message)),this.listenerManager.announceStatus(Object.assign(Object.assign({},i),{error:null!=o&&o,affectedChannels:n,affectedChannelGroups:s,currentTimetoken:this.currentTimetoken,lastTimetoken:this.lastTimetoken}))}))),0===Object.keys(this.channels).length&&0===Object.keys(this.presenceChannels).length&&0===Object.keys(this.channelGroups).length&&0===Object.keys(this.presenceChannelGroups).length&&(this.lastTimetoken=0,this.currentTimetoken=0,this.storedTimetoken=null,this.region=null,this.reconnectionManager.stopPolling()),this.reconnect())}unsubscribeAll(e){this.unsubscribe({channels:this.subscribedChannels,channelGroups:this.subscribedChannelGroups},e)}startSubscribeLoop(){this.stopSubscribeLoop();const e=[...Object.keys(this.channelGroups)],t=[...Object.keys(this.channels)];Object.keys(this.presenceChannelGroups).forEach((t=>e.push(`${t}-pnpres`))),Object.keys(this.presenceChannels).forEach((e=>t.push(`${e}-pnpres`))),0===t.length&&0===e.length||this.subscribeCall({channels:t,channelGroups:e,state:this.presenceState,heartbeat:this.configuration.getPresenceTimeout(),timetoken:this.currentTimetoken,region:null!==this.region?this.region:void 0,filterExpression:this.configuration.filterExpression},((e,t)=>{this.processSubscribeResponse(e,t)}))}stopSubscribeLoop(){this._subscribeAbort&&(this._subscribeAbort(),this._subscribeAbort=null)}processSubscribeResponse(e,t){if(e.error){if("object"==typeof e.errorData&&"name"in e.errorData&&"AbortError"===e.errorData.name||e.category===i.PNCancelledCategory)return;return void(e.category===i.PNTimeoutCategory?this.startSubscribeLoop():e.category===i.PNNetworkIssuesCategory?(this.disconnect(),e.error&&this.configuration.autoNetworkDetection&&this.isOnline&&(this.isOnline=!1,this.listenerManager.announceNetworkDown()),this.reconnectionManager.onReconnect((()=>{this.configuration.autoNetworkDetection&&!this.isOnline&&(this.isOnline=!0,this.listenerManager.announceNetworkUp()),this.reconnect(),this.subscriptionStatusAnnounced=!0;const t={category:i.PNReconnectedCategory,operation:e.operation,lastTimetoken:this.lastTimetoken,currentTimetoken:this.currentTimetoken};this.listenerManager.announceStatus(t)})),this.reconnectionManager.startPolling(),this.listenerManager.announceStatus(e)):e.category===i.PNBadRequestCategory?(this.stopHeartbeatTimer(),this.listenerManager.announceStatus(e)):this.listenerManager.announceStatus(e))}if(this.storedTimetoken?(this.currentTimetoken=this.storedTimetoken,this.storedTimetoken=null):(this.lastTimetoken=this.currentTimetoken,this.currentTimetoken=t.cursor.timetoken),!this.subscriptionStatusAnnounced){const t={category:i.PNConnectedCategory,operation:e.operation,affectedChannels:Array.from(this.pendingChannelSubscriptions),subscribedChannels:this.subscribedChannels,affectedChannelGroups:Array.from(this.pendingChannelGroupSubscriptions),lastTimetoken:this.lastTimetoken,currentTimetoken:this.currentTimetoken};this.subscriptionStatusAnnounced=!0,this.listenerManager.announceStatus(t),this.pendingChannelGroupSubscriptions.clear(),this.pendingChannelSubscriptions.clear()}const{messages:n}=t,{requestMessageCountThreshold:r,dedupeOnSubscribe:s}=this.configuration;r&&n.length>=r&&this.listenerManager.announceStatus({category:i.PNRequestMessageCountExceededCategory,operation:e.operation});try{n.forEach((e=>{if(s){if(this.dedupingManager.isDuplicate(e.data))return;this.dedupingManager.addEntry(e.data)}this.eventEmitter.emitEvent(e)}))}catch(e){const t={error:!0,category:i.PNUnknownCategory,errorData:e,statusCode:0};this.listenerManager.announceStatus(t)}this.region=t.cursor.region,this.startSubscribeLoop()}setState(e){const{state:t,channels:n,channelGroups:r}=e;null==n||n.forEach((e=>e in this.channels&&(this.presenceState[e]=t))),null==r||r.forEach((e=>e in this.channelGroups&&(this.presenceState[e]=t)))}changePresence(e){const{connected:t,channels:n,channelGroups:r}=e;t?(null==n||n.forEach((e=>this.heartbeatChannels[e]={})),null==r||r.forEach((e=>this.heartbeatChannelGroups[e]={}))):(null==n||n.forEach((e=>{e in this.heartbeatChannels&&delete this.heartbeatChannels[e]})),null==r||r.forEach((e=>{e in this.heartbeatChannelGroups&&delete this.heartbeatChannelGroups[e]})),!1===this.configuration.suppressLeaveEvents&&this.leaveCall({channels:n,channelGroups:r},(e=>this.listenerManager.announceStatus(e)))),this.reconnect()}startHeartbeatTimer(){this.stopHeartbeatTimer();const e=this.configuration.getHeartbeatInterval();e&&0!==e&&(this.sendHeartbeat(),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),1e3*e))}stopHeartbeatTimer(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}sendHeartbeat(){const e=Object.keys(this.heartbeatChannelGroups),t=Object.keys(this.heartbeatChannels);0===t.length&&0===e.length||this.heartbeatCall({channels:t,channelGroups:e,heartbeat:this.configuration.getPresenceTimeout(),state:this.presenceState},(e=>{e.error&&this.configuration.announceFailedHeartbeats&&this.listenerManager.announceStatus(e),e.error&&this.configuration.autoNetworkDetection&&this.isOnline&&(this.isOnline=!1,this.disconnect(),this.listenerManager.announceNetworkDown(),this.reconnect()),!e.error&&this.configuration.announceSuccessfulHeartbeats&&this.listenerManager.announceStatus(e)}))}}class _{constructor(e){this.params=e,this.requestIdentifier=E.createUUID(),this._cancellationController=null}get cancellationController(){return this._cancellationController}set cancellationController(e){this._cancellationController=e}abort(){this&&this.cancellationController&&this.cancellationController.abort()}operation(){throw Error("Should be implemented by subclass.")}validate(){}parse(e){return s(this,void 0,void 0,(function*(){throw Error("Should be implemented by subclass.")}))}request(){var e,t,n,r;const s={method:null!==(t=null===(e=this.params)||void 0===e?void 0:e.method)&&void 0!==t?t:S.GET,path:this.path,queryParameters:this.queryParameters,cancellable:null!==(r=null===(n=this.params)||void 0===n?void 0:n.cancellable)&&void 0!==r&&r,timeout:1e4,identifier:this.requestIdentifier},i=this.headers;if(i&&(s.headers=i),s.method===S.POST||s.method===S.PATCH){const[e,t]=[this.body,this.formData];t&&(s.formData=t),e&&(s.body=e)}return s}get headers(){}get path(){throw Error("`path` getter should be implemented by subclass.")}get queryParameters(){return{}}get formData(){}get body(){}deserializeResponse(e){const t=e.headers["content-type"];if(!t||-1===t.indexOf("javascript")&&-1===t.indexOf("json"))return;const n=_.decoder.decode(e.body);try{return JSON.parse(n)}catch(e){return void console.error("Error parsing JSON response:",e)}}}var T;_.decoder=new TextDecoder,function(e){e.PNPublishOperation="PNPublishOperation",e.PNSignalOperation="PNSignalOperation",e.PNSubscribeOperation="PNSubscribeOperation",e.PNUnsubscribeOperation="PNUnsubscribeOperation",e.PNWhereNowOperation="PNWhereNowOperation",e.PNHereNowOperation="PNHereNowOperation",e.PNGlobalHereNowOperation="PNGlobalHereNowOperation",e.PNSetStateOperation="PNSetStateOperation",e.PNGetStateOperation="PNGetStateOperation",e.PNHeartbeatOperation="PNHeartbeatOperation",e.PNAddMessageActionOperation="PNAddActionOperation",e.PNRemoveMessageActionOperation="PNRemoveMessageActionOperation",e.PNGetMessageActionsOperation="PNGetMessageActionsOperation",e.PNTimeOperation="PNTimeOperation",e.PNHistoryOperation="PNHistoryOperation",e.PNDeleteMessagesOperation="PNDeleteMessagesOperation",e.PNFetchMessagesOperation="PNFetchMessagesOperation",e.PNMessageCounts="PNMessageCountsOperation",e.PNGetAllUUIDMetadataOperation="PNGetAllUUIDMetadataOperation",e.PNGetUUIDMetadataOperation="PNGetUUIDMetadataOperation",e.PNSetUUIDMetadataOperation="PNSetUUIDMetadataOperation",e.PNRemoveUUIDMetadataOperation="PNRemoveUUIDMetadataOperation",e.PNGetAllChannelMetadataOperation="PNGetAllChannelMetadataOperation",e.PNGetChannelMetadataOperation="PNGetChannelMetadataOperation",e.PNSetChannelMetadataOperation="PNSetChannelMetadataOperation",e.PNRemoveChannelMetadataOperation="PNRemoveChannelMetadataOperation",e.PNGetMembersOperation="PNGetMembersOperation",e.PNSetMembersOperation="PNSetMembersOperation",e.PNGetMembershipsOperation="PNGetMembershipsOperation",e.PNSetMembershipsOperation="PNSetMembershipsOperation",e.PNListFilesOperation="PNListFilesOperation",e.PNGenerateUploadUrlOperation="PNGenerateUploadUrlOperation",e.PNPublishFileOperation="PNPublishFileOperation",e.PNPublishFileMessageOperation="PNPublishFileMessageOperation",e.PNGetFileUrlOperation="PNGetFileUrlOperation",e.PNDownloadFileOperation="PNDownloadFileOperation",e.PNDeleteFileOperation="PNDeleteFileOperation",e.PNAddPushNotificationEnabledChannelsOperation="PNAddPushNotificationEnabledChannelsOperation",e.PNRemovePushNotificationEnabledChannelsOperation="PNRemovePushNotificationEnabledChannelsOperation",e.PNPushNotificationEnabledChannelsOperation="PNPushNotificationEnabledChannelsOperation",e.PNRemoveAllPushNotificationsOperation="PNRemoveAllPushNotificationsOperation",e.PNChannelGroupsOperation="PNChannelGroupsOperation",e.PNRemoveGroupOperation="PNRemoveGroupOperation",e.PNChannelsForGroupOperation="PNChannelsForGroupOperation",e.PNAddChannelsToGroupOperation="PNAddChannelsToGroupOperation",e.PNRemoveChannelsFromGroupOperation="PNRemoveChannelsFromGroupOperation",e.PNAccessManagerGrant="PNAccessManagerGrant",e.PNAccessManagerGrantToken="PNAccessManagerGrantToken",e.PNAccessManagerAudit="PNAccessManagerAudit",e.PNAccessManagerRevokeToken="PNAccessManagerRevokeToken",e.PNHandshakeOperation="PNHandshakeOperation",e.PNReceiveMessagesOperation="PNReceiveMessagesOperation"}(T||(T={}));var x=T;var R;!function(e){e[e.Presence=-2]="Presence",e[e.Message=-1]="Message",e[e.Signal=1]="Signal",e[e.AppContext=2]="AppContext",e[e.MessageAction=3]="MessageAction",e[e.Files=4]="Files"}(R||(R={}));class D extends _{constructor(e){var t,n,r,s,i,o;super({cancellable:!0}),this.parameters=e,null!==(t=(s=this.parameters).withPresence)&&void 0!==t||(s.withPresence=false),null!==(n=(i=this.parameters).channelGroups)&&void 0!==n||(i.channelGroups=[]),null!==(r=(o=this.parameters).channels)&&void 0!==r||(o.channels=[])}operation(){return x.PNSubscribeOperation}validate(){const{keySet:{subscribeKey:e},channels:t,channelGroups:n}=this.parameters;return e?t||n?void 0:"`channels` and `channelGroups` both should not be empty":"Missing Subscribe Key"}parse(e){return s(this,void 0,void 0,(function*(){let t;try{const n=_.decoder.decode(e.body);t=JSON.parse(n)}catch(e){console.error("Error parsing JSON response:",e)}if(!t)throw new o("Service response error, check status for details",a("Unable to deserialize service response"));const n=t.m.map((e=>{let{e:t}=e;return null!=t||(t=e.c.endsWith("-pnpres")?R.Presence:R.Message),t!=R.Signal&&"string"==typeof e.d?t==R.Message?{type:R.Message,data:this.messageFromEnvelope(e)}:{type:R.Files,data:this.fileFromEnvelope(e)}:t==R.Message?{type:R.Message,data:this.messageFromEnvelope(e)}:t===R.Presence?{type:R.Presence,data:this.presenceEventFromEnvelope(e)}:t==R.Signal?{type:R.Signal,data:this.signalFromEnvelope(e)}:t===R.AppContext?{type:R.AppContext,data:this.appContextFromEnvelope(e)}:t===R.MessageAction?{type:R.MessageAction,data:this.messageActionFromEnvelope(e)}:{type:R.Files,data:this.fileFromEnvelope(e)}}));return{cursor:{timetoken:t.t.t,region:t.t.r},messages:n}}))}get headers(){return{accept:"text/javascript"}}presenceEventFromEnvelope(e){const{d:t}=e,[n,r]=this.subscriptionChannelFromEnvelope(e),s=n.replace("-pnpres",""),i=null!==r?s:null,o=null!==r?r:s;return"string"!=typeof t&&"data"in t&&(t.state=t.data,delete t.data),Object.assign({channel:s,subscription:r,actualChannel:i,subscribedChannel:o,timetoken:e.p.t},t)}messageFromEnvelope(e){const[t,n]=this.subscriptionChannelFromEnvelope(e),[r,s]=this.decryptedData(e.d),i={channel:t,subscription:n,actualChannel:null!==n?t:null,subscribedChannel:null!==n?n:t,timetoken:e.p.t,publisher:e.i,message:r};return e.u&&(i.userMetadata=e.u),s&&(i.error=s),i}signalFromEnvelope(e){const[t,n]=this.subscriptionChannelFromEnvelope(e),r={channel:t,subscription:n,timetoken:e.p.t,publisher:e.i,message:e.d};return e.u&&(r.userMetadata=e.u),r}messageActionFromEnvelope(e){const[t,n]=this.subscriptionChannelFromEnvelope(e),r=e.d;return{channel:t,subscription:n,timetoken:e.p.t,publisher:e.i,event:r.event,data:Object.assign(Object.assign({},r.data),{uuid:e.i})}}appContextFromEnvelope(e){const[t,n]=this.subscriptionChannelFromEnvelope(e),r=e.d;return{channel:t,subscription:n,timetoken:e.p.t,message:r}}fileFromEnvelope(e){const[t,n]=this.subscriptionChannelFromEnvelope(e),[r,s]=this.decryptedData(e.d);let i=s;const o={channel:t,subscription:n,timetoken:e.p.t,publisher:e.i};return e.u&&(o.userMetadata=e.u),r?"string"==typeof r?null!=i||(i="Unexpected file information payload data type."):(o.message=r.message,r.file&&(o.file={id:r.file.id,name:r.file.name,url:this.parameters.getFileUrl({id:r.file.id,name:r.file.name,channel:t})})):null!=i||(i="File information payload is missing."),i&&(o.error=i),o}subscriptionChannelFromEnvelope(e){return[e.c,void 0===e.b?e.c:e.b]}decryptedData(e){if(!this.parameters.crypto||"string"!=typeof e)return[e,void 0];let t,n;try{const n=this.parameters.crypto.decrypt(e);t=n instanceof ArrayBuffer?JSON.parse(I.decoder.decode(n)):n}catch(e){t=null,n=`Error while decrypting message content: ${e.message}`}return[null!=t?t:e,n]}}class I extends D{get path(){var e;const{keySet:{subscribeKey:t},channels:n}=this.parameters;return`/v2/subscribe/${t}/${f(null!==(e=null==n?void 0:n.sort())&&void 0!==e?e:[],",")}/0`}get queryParameters(){const{channelGroups:e,filterExpression:t,heartbeat:n,state:r,timetoken:s,region:i}=this.parameters,o={};return e&&e.length>0&&(o["channel-group"]=e.sort().join(",")),t&&t.length>0&&(o["filter-expr"]=t),n&&(o.heartbeat=n),r&&Object.keys(r).length>0&&(o.state=JSON.stringify(r)),void 0!==s&&"string"==typeof s?s.length>0&&"0"!==s&&(o.tt=s):void 0!==s&&s>0&&(o.tt=s),i&&(o.tr=i),o}}class U{constructor(e){this.listenerManager=e,this.channelListenerMap=new Map,this.groupListenerMap=new Map}emitEvent(e){if(e.type===R.Message)this.listenerManager.announceMessage(e.data),this.announce("message",e.data,e.data.channel,e.data.subscription);else if(e.type===R.Signal)this.listenerManager.announceSignal(e.data),this.announce("signal",e.data,e.data.channel,e.data.subscription);else if(e.type===R.Presence)this.listenerManager.announcePresence(e.data),this.announce("presence",e.data,e.data.channel,e.data.subscription);else if(e.type===R.AppContext){const{data:t}=e,{message:n}=t;if(this.listenerManager.announceObjects(t),this.announce("objects",t,t.channel,t.subscription),"uuid"===n.type){const{message:e,channel:s}=t,i=r(t,["message","channel"]),{event:o,type:a}=n,c=r(n,["event","type"]),u=Object.assign(Object.assign({},i),{spaceId:s,message:Object.assign(Object.assign({},c),{event:"set"===o?"updated":"removed",type:"user"})});this.listenerManager.announceUser(u),this.announce("user",u,u.spaceId,u.subscription)}else if("channel"===n.type){const{message:e,channel:s}=t,i=r(t,["message","channel"]),{event:o,type:a}=n,c=r(n,["event","type"]),u=Object.assign(Object.assign({},i),{spaceId:s,message:Object.assign(Object.assign({},c),{event:"set"===o?"updated":"removed",type:"space"})});this.listenerManager.announceSpace(u),this.announce("space",u,u.spaceId,u.subscription)}else if("membership"===n.type){const{message:e,channel:s}=t,i=r(t,["message","channel"]),{event:o,data:a}=n,c=r(n,["event","data"]),{uuid:u,channel:l}=a,h=r(a,["uuid","channel"]),p=Object.assign(Object.assign({},i),{spaceId:s,message:Object.assign(Object.assign({},c),{event:"set"===o?"updated":"removed",data:Object.assign(Object.assign({},h),{user:u,space:l})})});this.listenerManager.announceMembership(p),this.announce("membership",p,p.spaceId,p.subscription)}}else e.type===R.MessageAction?(this.listenerManager.announceMessageAction(e.data),this.announce("messageAction",e.data,e.data.channel,e.data.subscription)):e.type===R.Files&&(this.listenerManager.announceFile(e.data),this.announce("file",e.data,e.data.channel,e.data.subscription))}addListener(e,t,n){t&&n?(null==t||t.forEach((t=>{if(this.channelListenerMap.has(t)){const n=this.channelListenerMap.get(t);n.includes(e)||n.push(e)}else this.channelListenerMap.set(t,[e])})),null==n||n.forEach((t=>{if(this.groupListenerMap.has(t)){const n=this.groupListenerMap.get(t);n.includes(e)||n.push(e)}else this.groupListenerMap.set(t,[e])}))):this.listenerManager.addListener(e)}removeListener(e,t,n){t&&n?(null==t||t.forEach((t=>{this.channelListenerMap.has(t)&&this.channelListenerMap.set(t,this.channelListenerMap.get(t).filter((t=>t!==e)))})),null==n||n.forEach((t=>{this.groupListenerMap.has(t)&&this.groupListenerMap.set(t,this.groupListenerMap.get(t).filter((t=>t!==e)))}))):this.listenerManager.removeListener(e)}removeAllListeners(){this.listenerManager.removeAllListeners(),this.channelListenerMap.clear(),this.groupListenerMap.clear()}announce(e,t,n,r){t&&this.channelListenerMap.has(n)&&this.channelListenerMap.get(n).forEach((n=>{const r=n[e];r&&r(t)})),r&&this.groupListenerMap.has(r)&&this.groupListenerMap.get(r).forEach((n=>{const r=n[e];r&&r(t)}))}}class F{transition(e,t){var n;if(this.transitionMap.has(t.type))return null===(n=this.transitionMap.get(t.type))||void 0===n?void 0:n(e,t)}constructor(e){this.label=e,this.transitionMap=new Map,this.enterEffects=[],this.exitEffects=[]}on(e,t){return this.transitionMap.set(e,t),this}with(e,t){return[this,e,null!=t?t:[]]}onEnter(e){return this.enterEffects.push(e),this}onExit(e){return this.exitEffects.push(e),this}}function G(e,t){const n=function(...n){return{type:e,payload:null==t?void 0:t(...n)}};return n.type=e,n}function j(e,t){const n=(...n)=>({type:e,payload:t(...n),managed:!1});return n.type=e,n}function H(e,t){const n=(...n)=>({type:e,payload:t(...n),managed:!0});return n.type=e,n.cancel={type:"CANCEL",payload:e,managed:!1},n}const B=G("RECONNECT",(()=>({}))),L=G("DISCONNECT",(()=>({}))),q=G("JOINED",((e,t)=>({channels:e,groups:t}))),K=G("LEFT",((e,t)=>({channels:e,groups:t}))),z=G("LEFT_ALL",(()=>({}))),$=G("HEARTBEAT_SUCCESS",(e=>({statusCode:e}))),V=G("HEARTBEAT_FAILURE",(e=>e)),W=G("HEARTBEAT_GIVEUP",(()=>({}))),J=G("TIMES_UP",(()=>({}))),X=j("HEARTBEAT",((e,t)=>({channels:e,groups:t}))),Y=j("LEAVE",((e,t)=>({channels:e,groups:t})));j("EMIT_STATUS",(e=>e));const Q=H("WAIT",(()=>({}))),Z=H("DELAYED_HEARTBEAT",(e=>e)),ee=new F("HEARTBEAT_STOPPED");ee.on(q.type,((e,t)=>ee.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),ee.on(K.type,((e,t)=>ee.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))}))),ee.on(B.type,((e,t)=>se.with({channels:e.channels,groups:e.groups}))),ee.on(z.type,((e,t)=>ie.with(void 0)));const te=new F("HEARTBEAT_COOLDOWN");te.onEnter((()=>Q())),te.onExit((()=>Q.cancel)),te.on(J.type,((e,t)=>se.with({channels:e.channels,groups:e.groups}))),te.on(q.type,((e,t)=>se.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),te.on(K.type,((e,t)=>se.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[Y(t.payload.channels,t.payload.groups)]))),te.on(L.type,(e=>ee.with({channels:e.channels,groups:e.groups},[Y(e.channels,e.groups)]))),te.on(z.type,((e,t)=>ie.with(void 0,[Y(e.channels,e.groups)])));const ne=new F("HEARTBEAT_FAILED");ne.on(q.type,((e,t)=>se.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),ne.on(K.type,((e,t)=>se.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[Y(t.payload.channels,t.payload.groups)]))),ne.on(B.type,((e,t)=>se.with({channels:e.channels,groups:e.groups}))),ne.on(L.type,((e,t)=>ee.with({channels:e.channels,groups:e.groups},[Y(e.channels,e.groups)]))),ne.on(z.type,((e,t)=>ie.with(void 0,[Y(e.channels,e.groups)])));const re=new F("HEARBEAT_RECONNECTING");re.onEnter((e=>Z(e))),re.onExit((()=>Z.cancel)),re.on(q.type,((e,t)=>se.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),re.on(K.type,((e,t)=>se.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[Y(t.payload.channels,t.payload.groups)]))),re.on(L.type,((e,t)=>{ee.with({channels:e.channels,groups:e.groups},[Y(e.channels,e.groups)])})),re.on($.type,((e,t)=>te.with({channels:e.channels,groups:e.groups}))),re.on(V.type,((e,t)=>re.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),re.on(W.type,((e,t)=>ne.with({channels:e.channels,groups:e.groups}))),re.on(z.type,((e,t)=>ie.with(void 0,[Y(e.channels,e.groups)])));const se=new F("HEARTBEATING");se.onEnter((e=>X(e.channels,e.groups))),se.on($.type,((e,t)=>te.with({channels:e.channels,groups:e.groups}))),se.on(q.type,((e,t)=>se.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),se.on(K.type,((e,t)=>se.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[Y(t.payload.channels,t.payload.groups)]))),se.on(V.type,((e,t)=>re.with(Object.assign(Object.assign({},e),{attempts:0,reason:t.payload})))),se.on(L.type,(e=>ee.with({channels:e.channels,groups:e.groups},[Y(e.channels,e.groups)]))),se.on(z.type,((e,t)=>ie.with(void 0,[Y(e.channels,e.groups)])));const ie=new F("HEARTBEAT_INACTIVE");ie.on(q.type,((e,t)=>se.with({channels:t.payload.channels,groups:t.payload.groups})));class oe{static LinearRetryPolicy(e){return{delay:e.delay,maximumRetry:e.maximumRetry,shouldRetry(e,t){var n;return 403!==(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.statusCode)&&this.maximumRetry>t},getDelay(e,t){var n;return 1e3*((null!==(n=t.retryAfter)&&void 0!==n?n:this.delay)+Math.random())},getGiveupReason(e,t){var n;return this.maximumRetry<=t?"retry attempts exhaused.":403===(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.statusCode)?"forbidden operation.":"unknown error"},validate(){if(this.maximumRetry>10)throw new Error("Maximum retry for linear retry policy can not be more than 10")}}}static ExponentialRetryPolicy(e){return{minimumDelay:e.minimumDelay,maximumDelay:e.maximumDelay,maximumRetry:e.maximumRetry,shouldRetry(e,t){var n;return 403!==(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.statusCode)&&this.maximumRetry>t},getDelay(e,t){var n;return 1e3*((null!==(n=t.retryAfter)&&void 0!==n?n:Math.min(Math.pow(2,e),this.maximumDelay))+Math.random())},getGiveupReason(e,t){var n;return this.maximumRetry<=t?"retry attempts exhausted.":403===(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.statusCode)?"forbidden operation.":"unknown error"},validate(){if(this.minimumDelay<2)throw new Error("Minimum delay can not be set less than 2 seconds for retry");if(this.maximumDelay)throw new Error("Maximum delay can not be set more than 150 seconds for retry");if(this.maximumRetry>6)throw new Error("Maximum retry for exponential retry policy can not be more than 6")}}}}const ae=H("HANDSHAKE",((e,t)=>({channels:e,groups:t}))),ce=H("RECEIVE_MESSAGES",((e,t,n)=>({channels:e,groups:t,cursor:n}))),ue=j("EMIT_MESSAGES",(e=>e)),le=j("EMIT_STATUS",(e=>e)),he=H("RECEIVE_RECONNECT",(e=>e)),pe=H("HANDSHAKE_RECONNECT",(e=>e)),de=G("SUBSCRIPTION_CHANGED",((e,t)=>({channels:e,groups:t}))),ge=G("SUBSCRIPTION_RESTORED",((e,t,n,r)=>({channels:e,groups:t,cursor:{timetoken:n,region:null!=r?r:0}}))),ye=G("HANDSHAKE_SUCCESS",(e=>e)),fe=G("HANDSHAKE_FAILURE",(e=>e)),be=G("HANDSHAKE_RECONNECT_SUCCESS",(e=>({cursor:e}))),me=G("HANDSHAKE_RECONNECT_FAILURE",(e=>e)),ve=G("HANDSHAKE_RECONNECT_GIVEUP",(e=>e)),we=G("RECEIVE_SUCCESS",((e,t)=>({cursor:e,events:t}))),Ee=G("RECEIVE_FAILURE",(e=>e)),Ce=G("RECEIVE_RECONNECT_SUCCESS",((e,t)=>({cursor:e,events:t}))),Ne=G("RECEIVE_RECONNECT_FAILURE",(e=>e)),Se=G("RECEIVING_RECONNECT_GIVEUP",(e=>e)),Pe=G("DISCONNECT",(()=>({}))),ke=G("RECONNECT",((e,t)=>({cursor:{timetoken:null!=e?e:"",region:null!=t?t:0}}))),Me=G("UNSUBSCRIBE_ALL",(()=>({}))),Oe=new F("HANDSHAKE_FAILED");Oe.on(de.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Oe.on(ke.type,((e,t)=>Ie.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor||e.cursor}))),Oe.on(ge.type,((e,t)=>{var n,r;return Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region?t.payload.cursor.region:null!==(r=null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.region)&&void 0!==r?r:0}})})),Oe.on(Me.type,(e=>Ue.with()));const Ae=new F("HANDSHAKE_STOPPED");Ae.on(de.type,((e,t)=>Ae.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Ae.on(ke.type,((e,t)=>Ie.with(Object.assign(Object.assign({},e),{cursor:t.payload.cursor||e.cursor})))),Ae.on(ge.type,((e,t)=>{var n;return Ae.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||(null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.region)||0}})})),Ae.on(Me.type,(e=>Ue.with()));const _e=new F("RECEIVE_FAILED");_e.on(ke.type,((e,t)=>{var n;return Ie.with({channels:e.channels,groups:e.groups,cursor:{timetoken:t.payload.cursor.timetoken?null===(n=t.payload.cursor)||void 0===n?void 0:n.timetoken:e.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),_e.on(de.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),_e.on(ge.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),_e.on(Me.type,(e=>Ue.with(void 0)));const Te=new F("RECEIVE_STOPPED");Te.on(de.type,((e,t)=>Te.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Te.on(ge.type,((e,t)=>Te.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),Te.on(ke.type,((e,t)=>{var n;return Ie.with({channels:e.channels,groups:e.groups,cursor:{timetoken:t.payload.cursor.timetoken?null===(n=t.payload.cursor)||void 0===n?void 0:n.timetoken:e.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),Te.on(Me.type,(()=>Ue.with(void 0)));const xe=new F("RECEIVE_RECONNECTING");xe.onEnter((e=>he(e))),xe.onExit((()=>he.cancel)),xe.on(Ce.type,((e,t)=>Re.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor},[ue(t.payload.events)]))),xe.on(Ne.type,((e,t)=>xe.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),xe.on(Se.type,((e,t)=>{var n;return _e.with({groups:e.groups,channels:e.channels,cursor:e.cursor,reason:t.payload},[le({category:i.PNDisconnectedUnexpectedlyCategory,error:null===(n=t.payload)||void 0===n?void 0:n.message})])})),xe.on(Pe.type,(e=>Te.with({channels:e.channels,groups:e.groups,cursor:e.cursor},[le({category:i.PNDisconnectedCategory})]))),xe.on(ge.type,((e,t)=>Re.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),xe.on(de.type,((e,t)=>Re.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),xe.on(Me.type,(e=>Ue.with(void 0,[le({category:i.PNDisconnectedCategory})])));const Re=new F("RECEIVING");Re.onEnter((e=>ce(e.channels,e.groups,e.cursor))),Re.onExit((()=>ce.cancel)),Re.on(we.type,((e,t)=>Re.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor},[ue(t.payload.events)]))),Re.on(de.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?Ue.with(void 0):Re.with({cursor:e.cursor,channels:t.payload.channels,groups:t.payload.groups}))),Re.on(ge.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?Ue.with(void 0):Re.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),Re.on(Ee.type,((e,t)=>xe.with(Object.assign(Object.assign({},e),{attempts:0,reason:t.payload})))),Re.on(Pe.type,(e=>Te.with({channels:e.channels,groups:e.groups,cursor:e.cursor},[le({category:i.PNDisconnectedCategory})]))),Re.on(Me.type,(e=>Ue.with(void 0,[le({category:i.PNDisconnectedCategory})])));const De=new F("HANDSHAKE_RECONNECTING");De.onEnter((e=>pe(e))),De.onExit((()=>pe.cancel)),De.on(be.type,((e,t)=>{var n,r;const s={timetoken:(null===(n=e.cursor)||void 0===n?void 0:n.timetoken)?null===(r=e.cursor)||void 0===r?void 0:r.timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region};return Re.with({channels:e.channels,groups:e.groups,cursor:s},[le({category:i.PNConnectedCategory})])})),De.on(me.type,((e,t)=>De.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),De.on(ve.type,((e,t)=>{var n;return Oe.with({groups:e.groups,channels:e.channels,cursor:e.cursor,reason:t.payload},[le({category:i.PNConnectionErrorCategory,error:null===(n=t.payload)||void 0===n?void 0:n.message})])})),De.on(Pe.type,(e=>Ae.with({channels:e.channels,groups:e.groups,cursor:e.cursor}))),De.on(de.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),De.on(ge.type,((e,t)=>{var n,r;return Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:(null===(n=t.payload.cursor)||void 0===n?void 0:n.region)||(null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.region)||0}})})),De.on(Me.type,(e=>Ue.with(void 0)));const Ie=new F("HANDSHAKING");Ie.onEnter((e=>ae(e.channels,e.groups))),Ie.onExit((()=>ae.cancel)),Ie.on(de.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?Ue.with(void 0):Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Ie.on(ye.type,((e,t)=>{var n,r;return Re.with({channels:e.channels,groups:e.groups,cursor:{timetoken:(null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.timetoken)?null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.timetoken:t.payload.timetoken,region:t.payload.region}},[le({category:i.PNConnectedCategory})])})),Ie.on(fe.type,((e,t)=>De.with({channels:e.channels,groups:e.groups,cursor:e.cursor,attempts:0,reason:t.payload}))),Ie.on(Pe.type,(e=>Ae.with({channels:e.channels,groups:e.groups,cursor:e.cursor}))),Ie.on(ge.type,((e,t)=>{var n;return Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||(null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.region)||0}})})),Ie.on(Me.type,(e=>Ue.with()));const Ue=new F("UNSUBSCRIBED");Ue.on(de.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups}))),Ue.on(ge.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:t.payload.cursor})));class Fe extends _{constructor(e){var t,n,r,s;super(),this.parameters=e,null!==(t=(r=this.parameters).channels)&&void 0!==t||(r.channels=[]),null!==(n=(s=this.parameters).channelGroups)&&void 0!==n||(s.channelGroups=[])}operation(){return x.PNGetStateOperation}validate(){const{keySet:{subscribeKey:e},channels:t,channelGroups:n}=this.parameters;if(!e)return"Missing Subscribe Key"}parse(e){return s(this,void 0,void 0,(function*(){const t=this.deserializeResponse(e);if(!t)throw new o("Service response error, check status for details",a("Unable to deserialize service response"));if(t.status>=400)throw g.create(e);const{channels:n=[],channelGroups:r=[]}=this.parameters,s={channels:{}};return 1===n.length&&0===r.length?s.channels[n[0]]=t.payload:s.channels=t.payload,s}))}get path(){const{keySet:{subscribeKey:e},uuid:t,channels:n}=this.parameters;return`/v2/presence/sub-key/${e}/channel/${f(null!=n?n:[],",")}/uuid/${t}`}get queryParameters(){const{channelGroups:e}=this.parameters;return e&&0!==e.length?{"channel-group":e.join(",")}:{}}}class Ge extends _{constructor(e){super(),this.parameters=e}operation(){return x.PNSetStateOperation}validate(){const{keySet:{subscribeKey:e},state:t,channels:n=[],channelGroups:r=[]}=this.parameters;return e?t?0===(null==n?void 0:n.length)&&0===(null==r?void 0:r.length)?"Please provide a list of channels and/or channel-groups":void 0:"Missing State":"Missing Subscribe Key"}parse(e){return s(this,void 0,void 0,(function*(){const t=this.deserializeResponse(e);if(!t)throw new o("Service response error, check status for details",a("Unable to deserialize service response"));if(t.status>=400)throw g.create(e);return{state:t.payload}}))}get path(){const{keySet:{subscribeKey:e},uuid:t,channels:n}=this.parameters;return`/v2/presence/sub-key/${e}/channel/${f(null!=n?n:[],",")}/uuid/${y(t)}/data`}get queryParameters(){const{channelGroups:e,state:t}=this.parameters,n={state:JSON.stringify(t)};return e&&0!==e.length&&(n["channel-group"]=e.join(",")),n}}class je extends _{constructor(e){super(),this.parameters=e}operation(){return x.PNHeartbeatOperation}validate(){const{keySet:{subscribeKey:e},channels:t=[],channelGroups:n=[]}=this.parameters;return e?0===t.length&&0===n.length?"Please provide a list of channels and/or channel-groups":void 0:"Missing Subscribe Key"}parse(e){return s(this,void 0,void 0,(function*(){const t=this.deserializeResponse(e);if(!t)throw new o("Service response error, check status for details",a("Unable to deserialize service response"));if(t.status>=400)throw g.create(e);return{}}))}get path(){const{keySet:{subscribeKey:e},channels:t}=this.parameters;return`/v2/presence/sub-key/${e}/channel/${f(null!=t?t:[],",")}/heartbeat`}get queryParameters(){const{channelGroups:e,state:t,heartbeat:n}=this.parameters,r={heartbeat:`${n}`};return e&&0!==e.length&&(r["channel-group"]=e.join(",")),t&&(r.state=JSON.stringify(t)),r}}class He extends _{constructor(e){super(),this.parameters=e,this.parameters.channelGroups&&(this.parameters.channelGroups=Array.from(new Set(this.parameters.channelGroups))),this.parameters.channels&&(this.parameters.channels=Array.from(new Set(this.parameters.channels)))}operation(){return x.PNUnsubscribeOperation}validate(){const{keySet:{subscribeKey:e},channels:t=[],channelGroups:n=[]}=this.parameters;return e?0===t.length&&0===n.length?"At least one `channel` or `channel group` should be provided.":void 0:"Missing Subscribe Key"}parse(e){return s(this,void 0,void 0,(function*(){const t=this.deserializeResponse(e);if(!t)throw new o("Service response error, check status for details",a("Unable to deserialize service response"));if(t.status>=400)throw g.create(e);return{}}))}get path(){var e;const{keySet:{subscribeKey:t},channels:n}=this.parameters;return`/v2/presence/sub-key/${t}/channel/${f(null!==(e=null==n?void 0:n.sort())&&void 0!==e?e:[],",")}/leave`}get queryParameters(){const{channelGroups:e}=this.parameters;return e&&0!==e.length?{"channel-group":e.sort().join(",")}:{}}}class Be extends _{constructor(e){super(),this.parameters=e}operation(){return x.PNWhereNowOperation}validate(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"}parse(e){return s(this,void 0,void 0,(function*(){const t=this.deserializeResponse(e);if(!t)throw new o("Service response error, check status for details",a("Unable to deserialize service response"));if(t.status>=400)throw g.create(e);return t.payload?{channels:t.payload.channels}:{channels:[]}}))}get path(){const{keySet:{subscribeKey:e},uuid:t}=this.parameters;return`/v2/presence/sub-key/${e}/uuid/${y(t)}`}}class Le extends _{constructor(e){var t,n,r,s,i,o;super(),this.parameters=e,null!==(t=(s=this.parameters).queryParameters)&&void 0!==t||(s.queryParameters={}),null!==(n=(i=this.parameters).includeUUIDs)&&void 0!==n||(i.includeUUIDs=true),null!==(r=(o=this.parameters).includeState)&&void 0!==r||(o.includeState=false)}operation(){const{channels:e=[],channelGroups:t=[]}=this.parameters;return 0===e.length&&0===t.length?x.PNGlobalHereNowOperation:x.PNHereNowOperation}validate(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"}parse(e){return s(this,void 0,void 0,(function*(){var t,n;const r=this.deserializeResponse(e);if(!r)throw new o("Service response error, check status for details",a("Unable to deserialize service response"));if(r.status>=400)throw g.create(e);const s="occupancy"in r?1:r.payload.total_channels,i="occupancy"in r?r.occupancy:r.payload.total_channels,c={};let u={};if("occupancy"in r){const e=this.parameters.channels[0];u[e]={uuids:null!==(t=r.uuids)&&void 0!==t?t:[],occupancy:i}}else u=null!==(n=r.payload.channels)&&void 0!==n?n:{};return Object.keys(u).forEach((e=>{const t=u[e];c[e]={occupants:this.parameters.includeUUIDs?t.uuids.map((e=>"string"==typeof e?{uuid:e,state:null}:e)):[],name:e,occupancy:t.occupancy}})),{totalChannels:s,totalOccupancy:i,channels:c}}))}get path(){const{keySet:{subscribeKey:e},channels:t,channelGroups:n}=this.parameters;let r=`/v2/presence/sub-key/${e}`;return(t&&t.length>0||n&&n.length>0)&&(r+=`/channel/${f(null!=t?t:[],",")}`),r}get queryParameters(){const{channelGroups:e,includeUUIDs:t,includeState:n,queryParameters:r}=this.parameters;return Object.assign(Object.assign(Object.assign(Object.assign({},t?{}:{disable_uuids:"1"}),null!=n&&n?{state:"1"}:{}),e&&e.length>0?{"channel-group":e.join(",")}:{}),r)}}var qe;!function(e){e[e.Message=-1]="Message",e[e.Files=4]="Files"}(qe||(qe={}));class Ke{constructor(e,t,n){this.id=e,this.eventEmitter=t,this.pubnub=n}subscription(e){throw new Error("Subscription error: subscription module disabled")}}class ze{constructor(e,t,n){this.eventEmitter=t,this.pubnub=n,this.name=e}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class $e{constructor(e,t,n){this.id=e,this.eventEmitter=t,this.pubnub=n}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class Ve{constructor(e,t,n){this.eventEmitter=t,this.pubnub=n,this.name=e}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class We extends _{constructor(){super()}operation(){return x.PNTimeOperation}parse(e){return s(this,void 0,void 0,(function*(){const t=this.deserializeResponse(e);if(!t)throw new o("Service response error, check status for details",a("Unable to deserialize service response"));return{timetoken:t[0]}}))}get path(){return"/time/0"}}class Je{static notificationPayload(e,t){throw new Error("Notification Payload error: publish module disabled")}static generateUUID(){return E.createUUID()}constructor(e){if(this._configuration=e.configuration,this.cryptography=e.cryptography,this.tokenManager=e.tokenManager,this.transport=e.transport,this.crypto=e.crypto,this.listenerManager=new k,this.eventEmitter=new U(this.listenerManager),this._configuration.enableEventEngine)throw new Error("Event Engine error: subscription event engine module disabled");this.subscriptionManager=new A(this._configuration,this.listenerManager,this.eventEmitter,this.makeSubscribe.bind(this),this.heartbeat.bind(this),this.makeUnsubscribe.bind(this),this.time.bind(this))}get configuration(){return this._configuration}get _config(){return this.configuration}get authKey(){var e;return null!==(e=this._configuration.authKey)&&void 0!==e?e:void 0}getAuthKey(){return this.authKey}setAuthKey(e){this._configuration.setAuthKey(e)}get userId(){return this._configuration.userId}set userId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this._configuration.userId=e}getUserId(){return this._configuration.userId}setUserId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this._configuration.userId=e}get filterExpression(){var e;return null!==(e=this._configuration.getFilterExpression())&&void 0!==e?e:void 0}getFilterExpression(){return this.filterExpression}set filterExpression(e){this._configuration.setFilterExpression(e)}setFilterExpression(e){this.filterExpression=e}get cipherKey(){return this._configuration.getCipherKey()}set cipherKey(e){this._configuration.setCipherKey(e)}setCipherKey(e){this.cipherKey=e}set heartbeatInterval(e){this._configuration.setHeartbeatInterval(e)}setHeartbeatInterval(e){this.heartbeatInterval=e}getVersion(){return this._configuration.getVersion()}_addPnsdkSuffix(e,t){this._configuration._addPnsdkSuffix(e,t)}getUUID(){return this.userId}setUUID(e){this.userId=e}get customEncrypt(){return this._configuration.getCustomEncrypt()}get customDecrypt(){return this._configuration.getCustomDecrypt()}channel(e){return new Ve(e,this.eventEmitter,this)}channelGroup(e){return new ze(e,this.eventEmitter,this)}channelMetadata(e){return new Ke(e,this.eventEmitter,this)}userMetadata(e){return new $e(e,this.eventEmitter,this)}subscriptionSet(e){throw new Error("Subscription error: subscription event engine module disabled")}sendRequest(e,t){return s(this,void 0,void 0,(function*(){const n=e.validate();if(n){if(t)return t(a(n),null);throw new o("Validation failed, check status for details",a(n))}const r=e.request();r.formData&&r.formData.length>0?r.timeout=300:e.operation()===x.PNSubscribeOperation?r.timeout=this._configuration.getSubscribeTimeout():r.timeout=this._configuration.getTransactionTimeout();const s={error:!1,operation:e.operation(),category:i.PNAcknowledgmentCategory,statusCode:0},[c,u]=this.transport.makeSendable(r);return e.cancellationController=u||null,c.then((t=>{if(s.statusCode=t.status,200!==t.status&&204!==t.status){const e=t.headers["content-type"];if(e||-1!==e.indexOf("javascript")||-1!==e.indexOf("json")){const e=JSON.parse(Je.decoder.decode(t.body));"object"==typeof e&&"error"in e&&e.error&&"object"==typeof e.error&&(s.errorData=e.error)}}return e.parse(t)})).then((e=>t?t(s,e):e)).catch((n=>{const r=n instanceof g?n:g.create(n);if(t)return t(r.toStatus(e.operation()),null);throw r.toPubNubError(e.operation(),"REST API request processing error, check status for details")}))}))}destroy(e){this.subscriptionManager?(this.subscriptionManager.unsubscribeAll(e),this.subscriptionManager.disconnect()):this.eventEngine&&this.eventEngine.dispose()}stop(){this.destroy()}addListener(e){this.listenerManager.addListener(e)}removeListener(e){this.listenerManager.removeListener(e)}removeAllListeners(){this.listenerManager.removeAllListeners()}publish(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Publish error: publish module disabled")}))}signal(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Publish error: publish module disabled")}))}fire(e,t){return s(this,void 0,void 0,(function*(){return null!=t||(t=()=>{}),this.publish(Object.assign(Object.assign({},e),{replicate:!1,storeInHistory:!1}),t)}))}getSubscribedChannels(){return this.subscriptionManager?this.subscriptionManager.subscribedChannels:this.eventEngine?this.eventEngine.getSubscribedChannels():[]}getSubscribedChannelGroups(){return this.subscriptionManager?this.subscriptionManager.subscribedChannelGroups:this.eventEngine?this.eventEngine.getSubscribedChannelGroups():[]}subscribe(e){this.subscriptionManager?this.subscriptionManager.subscribe(e):this.eventEngine&&this.eventEngine.subscribe(e)}makeSubscribe(e,t){{const n=new I(Object.assign(Object.assign({},e),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule(),getFileUrl:this.getFileUrl.bind(this)}));if(this.sendRequest(n,((e,r)=>{var s;this.subscriptionManager&&(null===(s=this.subscriptionManager.abort)||void 0===s?void 0:s.identifier)===n.requestIdentifier&&(this.subscriptionManager.abort=null),t(e,r)})),this.subscriptionManager){const e=()=>n.abort();e.identifier=n.requestIdentifier,this.subscriptionManager.abort=e}}}unsubscribe(e){this.subscriptionManager?this.subscriptionManager.unsubscribe(e):this.eventEngine&&this.eventEngine.unsubscribe(e)}makeUnsubscribe(e,t){this.sendRequest(new He(Object.assign(Object.assign({},e),{keySet:this._configuration.keySet})),t)}unsubscribeAll(){this.subscriptionManager?this.subscriptionManager.unsubscribeAll():this.eventEngine&&this.eventEngine.unsubscribeAll()}disconnect(){this.subscriptionManager?this.subscriptionManager.disconnect():this.eventEngine&&this.eventEngine.disconnect()}reconnect(e){this.subscriptionManager?this.subscriptionManager.reconnect():this.eventEngine&&this.eventEngine.reconnect(null!=e?e:{})}subscribeHandshake(e){return s(this,void 0,void 0,(function*(){throw new Error("Subscription error: subscription event engine module disabled")}))}subscribeReceiveMessages(e){return s(this,void 0,void 0,(function*(){throw new Error("Subscription error: subscription event engine module disabled")}))}getMessageActions(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get Message Actions error: message reactions module disabled")}))}addMessageAction(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Add Message Action error: message reactions module disabled")}))}removeMessageAction(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Remove Message Action error: message reactions module disabled")}))}fetchMessages(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Messages History error: message persistence module disabled")}))}deleteMessages(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Delete Messages error: message persistence module disabled")}))}messageCounts(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get Messages Count error: message persistence module disabled")}))}history(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get Messages History error: message persistence module disabled")}))}hereNow(e,t){return s(this,void 0,void 0,(function*(){{const n=new Le(Object.assign(Object.assign({},e),{keySet:this._configuration.keySet}));return t?this.sendRequest(n,t):this.sendRequest(n)}}))}whereNow(e,t){return s(this,void 0,void 0,(function*(){var n;{const r=new Be({uuid:null!==(n=e.uuid)&&void 0!==n?n:this._configuration.userId,keySet:this._configuration.keySet});return t?this.sendRequest(r,t):this.sendRequest(r)}}))}getState(e,t){return s(this,void 0,void 0,(function*(){var n;{const r=new Fe(Object.assign(Object.assign({},e),{uuid:null!==(n=e.uuid)&&void 0!==n?n:this._configuration.userId,keySet:this._configuration.keySet}));return t?this.sendRequest(r,t):this.sendRequest(r)}}))}setState(e,t){return s(this,void 0,void 0,(function*(){var n,r;{const{keySet:s,userId:i}=this._configuration,o=this._configuration.getPresenceTimeout();let a;if(this._configuration.enableEventEngine&&this.presenceState){const t=this.presenceState;null===(n=e.channels)||void 0===n||n.forEach((n=>t[n]=e.state)),"channelGroups"in e&&(null===(r=e.channelGroups)||void 0===r||r.forEach((n=>t[n]=e.state)))}return a="withHeartbeat"in e?new je(Object.assign(Object.assign({},e),{keySet:s,heartbeat:o})):new Ge(Object.assign(Object.assign({},e),{keySet:s,uuid:i})),this.subscriptionManager&&this.subscriptionManager.setState(e),t?this.sendRequest(a,t):this.sendRequest(a)}}))}presence(e){var t;null===(t=this.subscriptionManager)||void 0===t||t.changePresence(e)}heartbeat(e,t){return s(this,void 0,void 0,(function*(){{const n=new je(Object.assign(Object.assign({},e),{keySet:this._configuration.keySet}));return t?this.sendRequest(n,t):this.sendRequest(n)}}))}join(e){var t;null===(t=this.presenceEventEngine)||void 0===t||t.join(e)}leave(e){var t;null===(t=this.presenceEventEngine)||void 0===t||t.leave(e)}leaveAll(){var e;null===(e=this.presenceEventEngine)||void 0===e||e.leaveAll()}grantToken(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Grant Token error: PAM module disabled")}))}revokeToken(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Revoke Token error: PAM module disabled")}))}get token(){return this.tokenManager&&this.tokenManager.getToken()}getToken(){return this.token}set token(e){this.tokenManager&&this.tokenManager.setToken(e)}setToken(e){this.token=e}parseToken(e){return this.tokenManager&&this.tokenManager.parseToken(e)}grant(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Grant error: PAM module disabled")}))}audit(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Grant Permissions error: PAM module disabled")}))}get objects(){return this._objects}fetchUsers(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Users Metadata error: App Context module disabled")}))}fetchUser(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch User Metadata error: App Context module disabled")}))}createUser(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Create User Metadata error: App Context module disabled")}))}updateUser(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Update User Metadata error: App Context module disabled")}))}removeUser(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Remove User Metadata error: App Context module disabled")}))}fetchSpaces(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Spaces Metadata error: App Context module disabled")}))}fetchSpace(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Space Metadata error: App Context module disabled")}))}createSpace(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Create Space Metadata error: App Context module disabled")}))}updateSpace(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Update Space Metadata error: App Context module disabled")}))}removeSpace(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Remove Space Metadata error: App Context module disabled")}))}fetchMemberships(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Memberships error: App Context module disabled")}))}addMemberships(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Add Memberships error: App Context module disabled")}))}updateMemberships(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Update Memberships error: App Context module disabled")}))}removeMemberships(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Remove Memberships error: App Context module disabled")}))}get channelGroups(){return this._channelGroups}get push(){return this._push}sendFile(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Send File error: file sharing module disabled")}))}publishFile(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Publish File error: file sharing module disabled")}))}listFiles(e,t){return s(this,void 0,void 0,(function*(){throw new Error("List Files error: file sharing module disabled")}))}getFileUrl(e){throw new Error("Generate File Download Url error: file sharing module disabled")}downloadFile(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Download File error: file sharing module disabled")}))}deleteFile(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Delete File error: file sharing module disabled")}))}time(e){return s(this,void 0,void 0,(function*(){const t=new We;return e?this.sendRequest(t,e):this.sendRequest(t)}))}encrypt(e,t){const n=this._configuration.getCryptoModule();if(!t&&n&&"string"==typeof e){const t=n.encrypt(e);return"string"==typeof t?t:function(e){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(e),s=r.byteLength,i=s%3,o=s-i;let a,c,u,l,h;for(let e=0;e<o;e+=3)h=r[e]<<16|r[e+1]<<8|r[e+2],a=(16515072&h)>>18,c=(258048&h)>>12,u=(4032&h)>>6,l=63&h,t+=n[a]+n[c]+n[u]+n[l];return 1==i?(h=r[o],a=(252&h)>>2,c=(3&h)<<4,t+=n[a]+n[c]+"=="):2==i&&(h=r[o]<<8|r[o+1],a=(64512&h)>>10,c=(1008&h)>>4,u=(15&h)<<2,t+=n[a]+n[c]+n[u]+"="),t}(t)}if(!this.crypto)throw new Error("Encryption error: cypher key not set");throw new Error("Encryption error: crypto module disabled")}decrypt(e,t){const n=this._configuration.getCryptoModule();if(!t&&n){const t=n.decrypt(e);return t instanceof ArrayBuffer?JSON.parse((new TextDecoder).decode(t)):t}if(!this.crypto)throw new Error("Decryption error: cypher key not set");throw new Error("Decryption error: crypto module disabled")}encryptFile(e,t){return s(this,void 0,void 0,(function*(){if("string"!=typeof e&&(t=e),!t)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File encryption error. File constructor not configured.");if("string"!=typeof e&&!this._configuration.getCryptoModule())throw new Error("File encryption error. Crypto module not configured.");if("string"==typeof e){if(!this.cryptography)throw new Error("File encryption error. File encryption not available");throw new Error("Encryption error: file sharing module disabled")}throw new Error("Encryption error: file sharing module disabled")}))}decryptFile(e,t){return s(this,void 0,void 0,(function*(){if("string"!=typeof e&&(t=e),!t)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File decryption error. File constructor not configured.");if("string"==typeof e&&!this._configuration.getCryptoModule())throw new Error("File decryption error. Crypto module not configured.");if("string"==typeof e){if(!this.cryptography)throw new Error("File decryption error. File decryption not available");throw new Error("Decryption error: file sharing module disabled")}throw new Error("Decryption error: file sharing module disabled")}))}}Je.decoder=new TextDecoder,Je.OPERATIONS=x,Je.CATEGORIES=i,Je.ExponentialRetryPolicy=oe.ExponentialRetryPolicy,Je.LinearRetryPolicy=oe.LinearRetryPolicy;class Xe extends Je{constructor(e){var t;const n=m(e),r=Object.assign(Object.assign({},n),{sdkFamily:"Web"}),s=C(r,(e=>{e.cipherKey}));let i,o=new b(s.keepAlive,s.logVerbosity);super({configuration:s,transport:new P({clientConfiguration:s,tokenManager:i,transport:o}),cryptography:undefined,tokenManager:i,crypto:undefined}),(null===(t=e.listenToBrowserNetworkEvents)||void 0===t||t)&&(window.addEventListener("offline",(()=>{this.networkDownDetected()})),window.addEventListener("online",(()=>{this.networkUpDetected()})))}networkDownDetected(){this.listenerManager.announceNetworkDown(),this._configuration.restore?this.disconnect():this.destroy(!0)}networkUpDetected(){this.listenerManager.announceNetworkUp(),this.reconnect()}}return Xe.CryptoModule=void 0,Xe}));
