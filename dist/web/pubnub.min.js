!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).PubNub=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r;function n(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function o(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))}!function(t){!function(e,r){var n=Math.pow(2,-24),o=Math.pow(2,32),s=Math.pow(2,53);var i={encode:function(e){var t,n=new ArrayBuffer(256),i=new DataView(n),a=0;function c(e){for(var r=n.byteLength,o=a+e;r<o;)r*=2;if(r!==n.byteLength){var s=i;n=new ArrayBuffer(r),i=new DataView(n);for(var c=a+3>>2,u=0;u<c;++u)i.setUint32(4*u,s.getUint32(4*u))}return t=e,i}function u(){a+=t}function l(e){u(c(1).setUint8(a,e))}function d(e){for(var t=c(e.length),r=0;r<e.length;++r)t.setUint8(a+r,e[r]);u()}function h(e,t){t<24?l(e<<5|t):t<256?(l(e<<5|24),l(t)):t<65536?(l(e<<5|25),function(e){u(c(2).setUint16(a,e))}(t)):t<4294967296?(l(e<<5|26),function(e){u(c(4).setUint32(a,e))}(t)):(l(e<<5|27),function(e){var t=e%o,r=(e-t)/o,n=c(8);n.setUint32(a,r),n.setUint32(a+4,t),u()}(t))}if(function e(t){var n;if(!1===t)return l(244);if(!0===t)return l(245);if(null===t)return l(246);if(t===r)return l(247);switch(typeof t){case"number":if(Math.floor(t)===t){if(0<=t&&t<=s)return h(0,t);if(-s<=t&&t<0)return h(1,-(t+1))}return l(251),function(e){u(c(8).setFloat64(a,e))}(t);case"string":var o=[];for(n=0;n<t.length;++n){var i=t.charCodeAt(n);i<128?o.push(i):i<2048?(o.push(192|i>>6),o.push(128|63&i)):i<55296?(o.push(224|i>>12),o.push(128|i>>6&63),o.push(128|63&i)):(i=(1023&i)<<10,i|=1023&t.charCodeAt(++n),i+=65536,o.push(240|i>>18),o.push(128|i>>12&63),o.push(128|i>>6&63),o.push(128|63&i))}return h(3,o.length),d(o);default:var p;if(Array.isArray(t))for(h(4,p=t.length),n=0;n<p;++n)e(t[n]);else if(t instanceof Uint8Array)h(2,t.length),d(t);else{var g=Object.keys(t);for(h(5,p=g.length),n=0;n<p;++n){var y=g[n];e(y),e(t[y])}}}}(e),"slice"in n)return n.slice(0,a);for(var p=new ArrayBuffer(a),g=new DataView(p),y=0;y<a;++y)g.setUint8(y,i.getUint8(y));return p},decode:function(e,t,s){var i=new DataView(e),a=0;function c(e,t){return a+=t,e}function u(t){return c(new Uint8Array(e,a,t),t)}function l(){return c(i.getUint8(a),1)}function d(){return c(i.getUint16(a),2)}function h(){return c(i.getUint32(a),4)}function p(){return 255===i.getUint8(a)&&(a+=1,!0)}function g(e){if(e<24)return e;if(24===e)return l();if(25===e)return d();if(26===e)return h();if(27===e)return h()*o+h();if(31===e)return-1;throw"Invalid length encoding"}function y(e){var t=l();if(255===t)return-1;var r=g(31&t);if(r<0||t>>5!==e)throw"Invalid indefinite length element";return r}function f(e,t){for(var r=0;r<t;++r){var n=l();128&n&&(n<224?(n=(31&n)<<6|63&l(),t-=1):n<240?(n=(15&n)<<12|(63&l())<<6|63&l(),t-=2):(n=(15&n)<<18|(63&l())<<12|(63&l())<<6|63&l(),t-=3)),n<65536?e.push(n):(n-=65536,e.push(55296|n>>10),e.push(56320|1023&n))}}"function"!=typeof t&&(t=function(e){return e}),"function"!=typeof s&&(s=function(){return r});var v=function e(){var o,h,v=l(),m=v>>5,b=31&v;if(7===m)switch(b){case 25:return function(){var e=new ArrayBuffer(4),t=new DataView(e),r=d(),o=32768&r,s=31744&r,i=1023&r;if(31744===s)s=261120;else if(0!==s)s+=114688;else if(0!==i)return i*n;return t.setUint32(0,o<<16|s<<13|i<<13),t.getFloat32(0)}();case 26:return c(i.getFloat32(a),4);case 27:return c(i.getFloat64(a),8)}if((h=g(b))<0&&(m<2||6<m))throw"Invalid length";switch(m){case 0:return h;case 1:return-1-h;case 2:if(h<0){for(var w=[],E=0;(h=y(m))>=0;)E+=h,w.push(u(h));var N=new Uint8Array(E),P=0;for(o=0;o<w.length;++o)N.set(w[o],P),P+=w[o].length;return N}return u(h);case 3:var C=[];if(h<0)for(;(h=y(m))>=0;)f(C,h);else f(C,h);return String.fromCharCode.apply(null,C);case 4:var M;if(h<0)for(M=[];!p();)M.push(e());else for(M=new Array(h),o=0;o<h;++o)M[o]=e();return M;case 5:var A={};for(o=0;o<h||h<0&&!p();++o){A[e()]=e()}return A;case 6:return t(e(),h);case 7:switch(h){case 20:return!1;case 21:return!0;case 22:return null;case 23:return r;default:return s(h)}}}();if(a!==e.byteLength)throw"Remaining bytes";return v}};t.exports?t.exports=i:e.CBOR||(e.CBOR=i)}(e)}({exports:{}}),"function"==typeof SuppressedError&&SuppressedError,new TextEncoder,new TextDecoder,function(e){e.PNNetworkIssuesCategory="PNNetworkIssuesCategory",e.PNTimeoutCategory="PNTimeoutCategory",e.PNCancelledCategory="PNCancelledCategory",e.PNBadRequestCategory="PNBadRequestCategory",e.PNAccessDeniedCategory="PNAccessDeniedCategory",e.PNValidationErrorCategory="PNValidationErrorCategory",e.PNAcknowledgmentCategory="PNAcknowledgmentCategory",e.PNUnknownCategory="PNUnknownCategory",e.PNNetworkUpCategory="PNNetworkUpCategory",e.PNNetworkDownCategory="PNNetworkDownCategory",e.PNReconnectedCategory="PNReconnectedCategory",e.PNConnectedCategory="PNConnectedCategory",e.PNRequestMessageCountExceededCategory="PNRequestMessageCountExceededCategory",e.PNDisconnectedCategory="PNDisconnectedCategory",e.PNConnectionErrorCategory="PNConnectionErrorCategory",e.PNDisconnectedUnexpectedlyCategory="PNDisconnectedUnexpectedlyCategory"}(r||(r={}));var s=r;class i extends Error{constructor(e,t){super(e),this.status=t,this.name="PubNubError",this.message=e,Object.setPrototypeOf(this,new.target.prototype)}}function a(e,t){return r=Object.assign({message:e},void 0!==t?{statusCode:t}:{}),null!==(n=r.statusCode)&&void 0!==n||(r.statusCode=0),Object.assign(Object.assign({},r),{statusCode:r.statusCode,category:s.PNValidationErrorCategory,error:!0});var r,n}var c,u,l,d,h,p=p||function(e,t){var r={},n=r.lib={},o=function(){},s=n.Base={extend:function(e){o.prototype=this;var t=new o;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=n.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var o=0;o<e;o++)t[n+o>>>2]|=(r[o>>>2]>>>24-o%4*8&255)<<24-(n+o)%4*8;else if(65535<r.length)for(o=0;o<e;o+=4)t[n+o>>>2]=r[o>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new i.init(r,t)}}),a=r.enc={},c=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var o=t[n>>>2]>>>24-n%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new i.init(r,t/2)}},u=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new i.init(r,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,s=this.blockSize,a=o/(4*s);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,o=e.min(4*t,o),t){for(var c=0;c<t;c+=s)this._doProcessBlock(n,c);c=n.splice(0,t),r.sigBytes-=o}return new i.init(c,o)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=d.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=r.algo={};return r}(Math);!function(e){for(var t=p,r=(o=t.lib).WordArray,n=o.Hasher,o=t.algo,s=[],i=[],a=function(e){return 4294967296*(e-(0|e))|0},c=2,u=0;64>u;){var l;e:{l=c;for(var d=e.sqrt(l),h=2;h<=d;h++)if(!(l%h)){l=!1;break e}l=!0}l&&(8>u&&(s[u]=a(e.pow(c,.5))),i[u]=a(e.pow(c,1/3)),u++),c++}var g=[];o=o.SHA256=n.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],s=r[2],a=r[3],c=r[4],u=r[5],l=r[6],d=r[7],h=0;64>h;h++){if(16>h)g[h]=0|e[t+h];else{var p=g[h-15],y=g[h-2];g[h]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+g[h-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+g[h-16]}p=d+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&l)+i[h]+g[h],y=((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+(n&o^n&s^o&s),d=l,l=u,u=c,c=a+p|0,a=s,s=o,o=n,n=p+y|0}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+s|0,r[3]=r[3]+a|0,r[4]=r[4]+c|0,r[5]=r[5]+u|0,r[6]=r[6]+l|0,r[7]=r[7]+d|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;return r[o>>>5]|=128<<24-o%32,r[14+(o+64>>>9<<4)]=e.floor(n/4294967296),r[15+(o+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=n._createHelper(o),t.HmacSHA256=n._createHmacHelper(o)}(Math),u=(c=p).enc.Utf8,c.algo.HMAC=c.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),i=o.words,a=s.words,c=0;c<r;c++)i[c]^=1549556828,a[c]^=909522486;o.sigBytes=s.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),d=(l=p).lib.WordArray,l.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp(),e=[];for(var o=0;o<r;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,i=0;4>i&&o+.75*i<r;i++)e.push(n.charAt(s>>>6*(3-i)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,r=this._map;(n=r.charAt(64))&&-1!=(n=e.indexOf(n))&&(t=n);for(var n=[],o=0,s=0;s<t;s++)if(s%4){var i=r.indexOf(e.charAt(s-1))<<s%4*2,a=r.indexOf(e.charAt(s))>>>6-s%4*2;n[o>>>2]|=(i|a)<<24-o%4*8,o++}return d.create(n,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,r,n,o,s,i){return((e=e+(t&r|~t&n)+o+i)<<s|e>>>32-s)+t}function r(e,t,r,n,o,s,i){return((e=e+(t&n|r&~n)+o+i)<<s|e>>>32-s)+t}function n(e,t,r,n,o,s,i){return((e=e+(t^r^n)+o+i)<<s|e>>>32-s)+t}function o(e,t,r,n,o,s,i){return((e=e+(r^(t|~n))+o+i)<<s|e>>>32-s)+t}for(var s=p,i=(c=s.lib).WordArray,a=c.Hasher,c=s.algo,u=[],l=0;64>l;l++)u[l]=4294967296*e.abs(e.sin(l+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,s){for(var i=0;16>i;i++){var a=e[c=s+i];e[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}i=this._hash.words;var c=e[s+0],l=(a=e[s+1],e[s+2]),d=e[s+3],h=e[s+4],p=e[s+5],g=e[s+6],y=e[s+7],f=e[s+8],v=e[s+9],m=e[s+10],b=e[s+11],w=e[s+12],E=e[s+13],N=e[s+14],P=e[s+15],C=t(C=i[0],O=i[1],A=i[2],M=i[3],c,7,u[0]),M=t(M,C,O,A,a,12,u[1]),A=t(A,M,C,O,l,17,u[2]),O=t(O,A,M,C,d,22,u[3]);C=t(C,O,A,M,h,7,u[4]),M=t(M,C,O,A,p,12,u[5]),A=t(A,M,C,O,g,17,u[6]),O=t(O,A,M,C,y,22,u[7]),C=t(C,O,A,M,f,7,u[8]),M=t(M,C,O,A,v,12,u[9]),A=t(A,M,C,O,m,17,u[10]),O=t(O,A,M,C,b,22,u[11]),C=t(C,O,A,M,w,7,u[12]),M=t(M,C,O,A,E,12,u[13]),A=t(A,M,C,O,N,17,u[14]),C=r(C,O=t(O,A,M,C,P,22,u[15]),A,M,a,5,u[16]),M=r(M,C,O,A,g,9,u[17]),A=r(A,M,C,O,b,14,u[18]),O=r(O,A,M,C,c,20,u[19]),C=r(C,O,A,M,p,5,u[20]),M=r(M,C,O,A,m,9,u[21]),A=r(A,M,C,O,P,14,u[22]),O=r(O,A,M,C,h,20,u[23]),C=r(C,O,A,M,v,5,u[24]),M=r(M,C,O,A,N,9,u[25]),A=r(A,M,C,O,d,14,u[26]),O=r(O,A,M,C,f,20,u[27]),C=r(C,O,A,M,E,5,u[28]),M=r(M,C,O,A,l,9,u[29]),A=r(A,M,C,O,y,14,u[30]),C=n(C,O=r(O,A,M,C,w,20,u[31]),A,M,p,4,u[32]),M=n(M,C,O,A,f,11,u[33]),A=n(A,M,C,O,b,16,u[34]),O=n(O,A,M,C,N,23,u[35]),C=n(C,O,A,M,a,4,u[36]),M=n(M,C,O,A,h,11,u[37]),A=n(A,M,C,O,y,16,u[38]),O=n(O,A,M,C,m,23,u[39]),C=n(C,O,A,M,E,4,u[40]),M=n(M,C,O,A,c,11,u[41]),A=n(A,M,C,O,d,16,u[42]),O=n(O,A,M,C,g,23,u[43]),C=n(C,O,A,M,v,4,u[44]),M=n(M,C,O,A,w,11,u[45]),A=n(A,M,C,O,P,16,u[46]),C=o(C,O=n(O,A,M,C,l,23,u[47]),A,M,c,6,u[48]),M=o(M,C,O,A,y,10,u[49]),A=o(A,M,C,O,N,15,u[50]),O=o(O,A,M,C,p,21,u[51]),C=o(C,O,A,M,w,6,u[52]),M=o(M,C,O,A,d,10,u[53]),A=o(A,M,C,O,m,15,u[54]),O=o(O,A,M,C,a,21,u[55]),C=o(C,O,A,M,f,6,u[56]),M=o(M,C,O,A,P,10,u[57]),A=o(A,M,C,O,g,15,u[58]),O=o(O,A,M,C,E,21,u[59]),C=o(C,O,A,M,h,6,u[60]),M=o(M,C,O,A,b,10,u[61]),A=o(A,M,C,O,l,15,u[62]),O=o(O,A,M,C,v,21,u[63]);i[0]=i[0]+C|0,i[1]=i[1]+O|0,i[2]=i[2]+A|0,i[3]=i[3]+M|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;r[o>>>5]|=128<<24-o%32;var s=e.floor(n/4294967296);for(r[15+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r[14+(o+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(r.length+1),this._process(),r=(t=this._hash).words,n=0;4>n;n++)o=r[n],r[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),s.MD5=a._createHelper(c),s.HmacMD5=a._createHmacHelper(c)}(Math),function(){var e,t=p,r=(e=t.lib).Base,n=e.WordArray,o=(e=t.algo).EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=(a=this.cfg).hasher.create(),o=n.create(),s=o.words,i=a.keySize,a=a.iterations;s.length<i;){c&&r.update(c);var c=r.update(e).finalize(t);r.reset();for(var u=1;u<a;u++)c=r.finalize(c),r.reset();o.concat(c)}return o.sigBytes=4*i,o}});t.EvpKDF=function(e,t,r){return o.create(r).compute(e,t)}}(),p.lib.Cipher||function(e){var t=(g=p).lib,r=t.Base,n=t.WordArray,o=t.BufferedBlockAlgorithm,s=g.enc.Base64,i=g.algo.EvpKDF,a=t.Cipher=o.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,r,n){return("string"==typeof r?y:h).encrypt(e,t,r,n)},decrypt:function(t,r,n){return("string"==typeof r?y:h).decrypt(e,t,r,n)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=g.mode={},u=function(e,t,r){var n=this._iv;n?this._iv=undefined:n=this._prevBlock;for(var o=0;o<r;o++)e[t+o]^=n[o]},l=(t.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;u.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),l.Decryptor=l.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=e.slice(t,t+n);r.decryptBlock(e,t),u.call(this,e,t,n),this._prevBlock=o}}),c=c.CBC=l,l=(g.pad={}).Pkcs7={pad:function(e,t){for(var r,o=(r=(r=4*t)-e.sigBytes%r)<<24|r<<16|r<<8|r,s=[],i=0;i<r;i+=4)s.push(o);r=n.create(s,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:l}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=t.createEncryptor;else r=t.createDecryptor,this._minBufferSize=1;this._mode=r.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var d=t.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),h=(c=(g.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?n.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){var t=(e=s.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var r=n.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return d.create({ciphertext:e,salt:r})}},t.SerializableCipher=r.extend({cfg:r.extend({format:c}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var o=e.createEncryptor(r,n);return t=o.finalize(t),o=o.cfg,d.create({ciphertext:t,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),g=(g.kdf={}).OpenSSL={execute:function(e,t,r,o){return o||(o=n.random(8)),e=i.create({keySize:t+r}).compute(e,o),r=n.create(e.words.slice(t),4*r),e.sigBytes=4*t,d.create({key:e,iv:r,salt:o})}},y=t.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:g}),encrypt:function(e,t,r,n){return r=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize),n.iv=r.iv,(e=h.encrypt.call(this,e,t,r.key,n)).mixIn(r),e},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),r=n.kdf.execute(r,e.keySize,e.ivSize,t.salt),n.iv=r.iv,h.decrypt.call(this,e,t,r.key,n)}})}(),function(){for(var e=p,t=e.lib.BlockCipher,r=e.algo,n=[],o=[],s=[],i=[],a=[],c=[],u=[],l=[],d=[],h=[],g=[],y=0;256>y;y++)g[y]=128>y?y<<1:y<<1^283;var f=0,v=0;for(y=0;256>y;y++){var m=(m=v^v<<1^v<<2^v<<3^v<<4)>>>8^255&m^99;n[f]=m,o[m]=f;var b=g[f],w=g[b],E=g[w],N=257*g[m]^16843008*m;s[f]=N<<24|N>>>8,i[f]=N<<16|N>>>16,a[f]=N<<8|N>>>24,c[f]=N,N=16843009*E^65537*w^257*b^16843008*f,u[m]=N<<24|N>>>8,l[m]=N<<16|N>>>16,d[m]=N<<8|N>>>24,h[m]=N,f?(f=b^g[g[g[E^b]]],v^=g[g[v]]):f=v=1}var P=[0,1,2,4,8,16,32,64,128,27,54];r=r.AES=t.extend({_doReset:function(){for(var e=(r=this._key).words,t=r.sigBytes/4,r=4*((this._nRounds=t+6)+1),o=this._keySchedule=[],s=0;s<r;s++)if(s<t)o[s]=e[s];else{var i=o[s-1];s%t?6<t&&4==s%t&&(i=n[i>>>24]<<24|n[i>>>16&255]<<16|n[i>>>8&255]<<8|n[255&i]):(i=n[(i=i<<8|i>>>24)>>>24]<<24|n[i>>>16&255]<<16|n[i>>>8&255]<<8|n[255&i],i^=P[s/t|0]<<24),o[s]=o[s-t]^i}for(e=this._invKeySchedule=[],t=0;t<r;t++)s=r-t,i=t%4?o[s]:o[s-4],e[t]=4>t||4>=s?i:u[n[i>>>24]]^l[n[i>>>16&255]]^d[n[i>>>8&255]]^h[n[255&i]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,i,a,c,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,u,l,d,h,o),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,o,s,i,a){for(var c=this._nRounds,u=e[t]^r[0],l=e[t+1]^r[1],d=e[t+2]^r[2],h=e[t+3]^r[3],p=4,g=1;g<c;g++){var y=n[u>>>24]^o[l>>>16&255]^s[d>>>8&255]^i[255&h]^r[p++],f=n[l>>>24]^o[d>>>16&255]^s[h>>>8&255]^i[255&u]^r[p++],v=n[d>>>24]^o[h>>>16&255]^s[u>>>8&255]^i[255&l]^r[p++];h=n[h>>>24]^o[u>>>16&255]^s[l>>>8&255]^i[255&d]^r[p++],u=y,l=f,d=v}y=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^r[p++],f=(a[l>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^r[p++],v=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^r[p++],h=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&d])^r[p++],e[t]=y,e[t+1]=f,e[t+2]=v,e[t+3]=h},keySize:8});e.AES=t._createHelper(r)}(),p.mode.ECB=((h=p.lib.BlockCipherMode.extend()).Encryptor=h.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),h.Decryptor=h.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),h),new TextEncoder,new TextDecoder,new TextEncoder,new TextDecoder,new TextEncoder,new TextDecoder,new TextDecoder;class g extends Error{static create(e,t){return e instanceof Error?g.createFromError(e):g.createFromServiceResponse(e,t)}static createFromError(e){let t=s.PNUnknownCategory,r="Unknown error",n="Error";if(!e)return new g(r,t,0);if(e instanceof g)return e;if(e instanceof Error&&(r=e.message,n=e.name),"AbortError"===n||-1!==r.indexOf("Aborted"))t=s.PNCancelledCategory,r="Request cancelled";else if(-1!==r.indexOf("timeout"))t=s.PNTimeoutCategory,r="Request timeout";else if(-1!==r.indexOf("network"))t=s.PNNetworkIssuesCategory,r="Network issues";else if("TypeError"===n)t=-1!==r.indexOf("Load failed")||-1!=r.indexOf("Failed to fetch")?s.PNTimeoutCategory:s.PNBadRequestCategory;else if("FetchError"===n){const n=e.code;["ECONNREFUSED","ENETUNREACH","ENOTFOUND","ECONNRESET","EAI_AGAIN"].includes(n)&&(t=s.PNNetworkIssuesCategory),"ECONNREFUSED"===n?r="Connection refused":"ENETUNREACH"===n?r="Network not reachable":"ENOTFOUND"===n?r="Server not found":"ECONNRESET"===n?r="Connection reset by peer":"EAI_AGAIN"===n?r="Name resolution error":"ETIMEDOUT"===n?(t=s.PNTimeoutCategory,r="Request timeout"):r=`Unknown system error: ${e}`}else"Request timeout"===r&&(t=s.PNTimeoutCategory);return new g(r,t,0,e)}static createFromServiceResponse(e,t){let r,n=s.PNUnknownCategory,o="Unknown error",{status:i}=e;if(null!=t||(t=e.body),402===i?o="Not available for used key set. Contact support@pubnub.com":400===i?(n=s.PNBadRequestCategory,o="Bad request"):403===i&&(n=s.PNAccessDeniedCategory,o="Access denied"),t&&t.byteLength>0){const n=(new TextDecoder).decode(t);if(-1!==e.headers["content-type"].indexOf("text/javascript")||-1!==e.headers["content-type"].indexOf("application/json"))try{const e=JSON.parse(n);"object"!=typeof e||Array.isArray(e)||("error"in e&&(1===e.error||!0===e.error)&&"status"in e&&"number"==typeof e.status&&"message"in e&&"service"in e?(r=e,i=e.status):r=e,"error"in e&&e.error instanceof Error&&(r=e.error))}catch(e){r=n}else if(-1!==e.headers["content-type"].indexOf("xml")){const e=/<Message>(.*)<\/Message>/gi.exec(n);o=e?`Upload to bucket failed: ${e[1]}`:"Upload to bucket failed."}else r=n}return new g(o,n,i,r)}constructor(e,t,r,n){super(e),this.category=t,this.statusCode=r,this.errorData=n,this.name="PubNubAPIError"}toStatus(e){return{error:!0,category:this.category,operation:e,statusCode:this.statusCode,errorData:this.errorData}}toPubNubError(e,t){return new i(null!=t?t:this.message,this.toStatus(e))}}const y=e=>encodeURIComponent(e).replace(/[!~*'()]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`));class f{constructor(e=!1,t){this.keepAlive=e,this.logVerbosity=t}makeSendable(e){let t,r;return e.cancellable&&(r=new AbortController,t={abortController:r,abort:()=>null==r?void 0:r.abort()}),[this.requestFromTransportRequest(e).then((t=>{const n=(new Date).getTime();this.logRequestProcessProgress(t);const o=new Promise(((t,r)=>{const n=setTimeout((()=>{clearTimeout(n),r(new Error("Request timeout"))}),1e3*e.timeout)}));return Promise.race([fetch(t,{signal:null==r?void 0:r.signal}),o]).then((e=>e.arrayBuffer().then((t=>[e,t])))).then((e=>{const r=e[1].byteLength>0?e[1]:void 0,{status:o,headers:s}=e[0],i={};s.forEach(((e,t)=>i[t]=e.toLowerCase()));const a={status:o,url:t.url,headers:i,body:r};if(o>=400)throw g.create(a);return this.logRequestProcessProgress(t,(new Date).getTime()-n,r),a})).catch((e=>{throw g.create(e)}))})),t]}request(e){return e}requestFromTransportRequest(e){return o(this,void 0,void 0,(function*(){let t,r=e.path;if(e.formData&&e.formData.length>0){e.queryParameters={};const r=e.body,n=new FormData;for(const{key:t,value:r}of e.formData)n.append(t,r);try{const e=yield r.toArrayBuffer();n.append("file",new Blob([e],{type:"application/octet-stream"}),r.name)}catch(e){try{const e=yield r.toFileUri();n.append("file",e,r.name)}catch(e){}}t=n}else e.body&&("string"==typeof e.body||e.body instanceof ArrayBuffer)&&(t=e.body);var n;return e.queryParameters&&0!==Object.keys(e.queryParameters).length&&(r=`${r}?${n=e.queryParameters,Object.keys(n).map((e=>{const t=n[e];return Array.isArray(t)?t.map((t=>`${e}=${y(t)}`)).join("&"):`${e}=${y(t)}`})).join("&")}`),new Request(`${e.origin}${r}`,{method:e.method,headers:e.headers,redirect:"follow",body:t})}))}logRequestProcessProgress(e,t,r){if(!this.logVerbosity)return;const{protocol:n,host:o,pathname:s,search:i}=new URL(e.url),a=(new Date).toISOString();if(t){const e=r?f.decoder.decode(r):void 0;console.log(">>>>>>"),console.log(`[${a} / ${t}]`,`\n${n}//${o}${s}`,`\n${i}`,`\n${e}`),console.log("-----")}else console.log("<<<<<"),console.log(`[${a}]`,`\n${n}//${o}${s}`,`\n${i}`),console.log("-----")}}f.decoder=new TextDecoder;const v=e=>{var t,r,n;return e.subscriptionWorkerUrl&&"undefined"==typeof SharedWorker&&(e.subscriptionWorkerUrl=null),Object.assign(Object.assign({},(e=>{var t,r,n,o,s,a,c,u,l,d,h,p,g,y;const f=Object.assign({},e);if(null!==(t=f.logVerbosity)&&void 0!==t||(f.logVerbosity=!1),null!==(r=f.ssl)&&void 0!==r||(f.ssl=!0),null!==(n=f.transactionalRequestTimeout)&&void 0!==n||(f.transactionalRequestTimeout=15),null!==(o=f.subscribeRequestTimeout)&&void 0!==o||(f.subscribeRequestTimeout=310),null!==(s=f.restore)&&void 0!==s||(f.restore=!1),null!==(a=f.useInstanceId)&&void 0!==a||(f.useInstanceId=!1),null!==(c=f.suppressLeaveEvents)&&void 0!==c||(f.suppressLeaveEvents=!1),null!==(u=f.requestMessageCountThreshold)&&void 0!==u||(f.requestMessageCountThreshold=100),null!==(l=f.autoNetworkDetection)&&void 0!==l||(f.autoNetworkDetection=!1),null!==(d=f.enableEventEngine)&&void 0!==d||(f.enableEventEngine=!1),null!==(h=f.maintainPresenceState)&&void 0!==h||(f.maintainPresenceState=!0),null!==(p=f.keepAlive)&&void 0!==p||(f.keepAlive=!1),f.userId&&f.uuid)throw new i("PubNub client configuration error: use only 'userId'");if(null!==(g=f.userId)&&void 0!==g||(f.userId=f.uuid),!f.userId)throw new i("PubNub client configuration error: 'userId' not set");if(0===(null===(y=f.userId)||void 0===y?void 0:y.trim().length))throw new i("PubNub client configuration error: 'userId' is empty");f.origin||(f.origin=Array.from({length:20},((e,t)=>`ps${t+1}.pndsn.com`)));const v={subscribeKey:f.subscribeKey,publishKey:f.publishKey,secretKey:f.secretKey};void 0!==f.presenceTimeout&&f.presenceTimeout<20&&(f.presenceTimeout=20,console.log("WARNING: Presence timeout is less than the minimum. Using minimum value: ",20)),void 0!==f.presenceTimeout?f.heartbeatInterval=f.presenceTimeout/2-1:f.presenceTimeout=300;let m=!1,b=!0,w=5,E=!1,N=!0;return void 0!==f.dedupeOnSubscribe&&"boolean"==typeof f.dedupeOnSubscribe&&(E=f.dedupeOnSubscribe),void 0!==f.useRequestId&&"boolean"==typeof f.useRequestId&&(N=f.useRequestId),void 0!==f.announceSuccessfulHeartbeats&&"boolean"==typeof f.announceSuccessfulHeartbeats&&(m=f.announceSuccessfulHeartbeats),void 0!==f.announceFailedHeartbeats&&"boolean"==typeof f.announceFailedHeartbeats&&(b=f.announceFailedHeartbeats),void 0!==f.fileUploadPublishRetryLimit&&"number"==typeof f.fileUploadPublishRetryLimit&&(w=f.fileUploadPublishRetryLimit),Object.assign(Object.assign({},f),{keySet:v,dedupeOnSubscribe:E,maximumCacheSize:100,useRequestId:N,announceSuccessfulHeartbeats:m,announceFailedHeartbeats:b,fileUploadPublishRetryLimit:w})})(e)),{listenToBrowserNetworkEvents:null===(t=e.listenToBrowserNetworkEvents)||void 0===t||t,subscriptionWorkerUrl:e.subscriptionWorkerUrl,subscriptionWorkerLogVerbosity:null!==(r=e.subscriptionWorkerLogVerbosity)&&void 0!==r&&r,keepAlive:null===(n=e.keepAlive)||void 0===n||n})};var m={exports:{}};
/*! lil-uuid - v0.1 - MIT License - https://github.com/lil-js/uuid */!function(e,t){!function(e){var t="0.1.0",r={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function n(){var e,t,r="";for(e=0;e<32;e++)t=16*Math.random()|0,8!==e&&12!==e&&16!==e&&20!==e||(r+="-"),r+=(12===e?4:16===e?3&t|8:t).toString(16);return r}function o(e,t){var n=r[t||"all"];return n&&n.test(e)||!1}n.isUUID=o,n.VERSION=t,e.uuid=n,e.isUUID=o}(t),null!==e&&(e.exports=t.uuid)}(m,m.exports);var b=t(m.exports),w={createUUID:()=>b.uuid?b.uuid():b()};const E=(e,t)=>{var r,n,o;null===(r=e.retryConfiguration)||void 0===r||r.validate(),null!==(n=e.useRandomIVs)&&void 0!==n||(e.useRandomIVs=true),e.origin=N(null!==(o=e.ssl)&&void 0!==o&&o,e.origin);const s=e.cryptoModule;s&&delete e.cryptoModule;const i=Object.assign(Object.assign({},e),{_pnsdkSuffix:{},_instanceId:`pn-${w.createUUID()}`,_cryptoModule:void 0,_cipherKey:void 0,_setupCryptoModule:t,get instanceId(){if(this.useInstanceId)return this._instanceId},getUserId(){return this.userId},setUserId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this.userId=e},getAuthKey(){return this.authKey},setAuthKey(e){this.authKey=e},getFilterExpression(){return this.filterExpression},setFilterExpression(e){this.filterExpression=e},getCipherKey(){return this._cipherKey},setCipherKey(t){this._cipherKey=t,t||!this._cryptoModule?t&&this._setupCryptoModule&&(this._cryptoModule=this._setupCryptoModule({cipherKey:t,useRandomIVs:e.useRandomIVs,customEncrypt:this.getCustomEncrypt(),customDecrypt:this.getCustomDecrypt()})):this._cryptoModule=void 0},getCryptoModule(){return this._cryptoModule},getUseRandomIVs:()=>e.useRandomIVs,setPresenceTimeout(e){this.heartbeatInterval=e/2-1,this.presenceTimeout=e},getPresenceTimeout(){return this.presenceTimeout},getHeartbeatInterval(){return this.heartbeatInterval},setHeartbeatInterval(e){this.heartbeatInterval=e},getTransactionTimeout(){return this.transactionalRequestTimeout},getSubscribeTimeout(){return this.subscribeRequestTimeout},get PubNubFile(){return e.PubNubFile},get version(){return"8.2.7"},getVersion(){return this.version},_addPnsdkSuffix(e,t){this._pnsdkSuffix[e]=`${t}`},_getPnsdkSuffix(e){const t=Object.values(this._pnsdkSuffix).join(e);return t.length>0?e+t:""},getUUID(){return this.getUserId()},setUUID(e){this.setUserId(e)},getCustomEncrypt:()=>e.customEncrypt,getCustomDecrypt:()=>e.customDecrypt});return e.cipherKey?i.setCipherKey(e.cipherKey):s&&(i._cryptoModule=s),i},N=(e,t)=>{const r=e?"https://":"http://";return"string"==typeof t?`${r}${t}`:`${r}${t[Math.floor(Math.random()*t.length)]}`};var P,C;!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.DELETE="DELETE",e.LOCAL="LOCAL"}(P||(P={})),new TextDecoder("utf-8");class M{constructor(e){this.configuration=e}makeSendable(e){return this.configuration.transport.makeSendable(this.request(e))}request(e){var t;const{clientConfiguration:r}=this.configuration;return(e=this.configuration.transport.request(e)).queryParameters||(e.queryParameters={}),r.useInstanceId&&(e.queryParameters.instanceid=r.instanceId),e.queryParameters.uuid||(e.queryParameters.uuid=r.userId),r.useRequestId&&(e.queryParameters.requestid=e.identifier),e.queryParameters.pnsdk=this.generatePNSDK(),null!==(t=e.origin)&&void 0!==t||(e.origin=r.origin),this.authenticateRequest(e),this.signRequest(e),e}authenticateRequest(e){var t;if(e.path.startsWith("/v2/auth/")||e.path.startsWith("/v3/pam/")||e.path.startsWith("/time"))return;const{clientConfiguration:r,tokenManager:n}=this.configuration,o=null!==(t=n&&n.getToken())&&void 0!==t?t:r.authKey;o&&(e.queryParameters.auth=o)}signRequest(e){this.signatureGenerator&&!e.path.startsWith("/time")&&(e.queryParameters.timestamp=String(Math.floor((new Date).getTime()/1e3)),e.queryParameters.signature=this.signatureGenerator.signature(e))}generatePNSDK(){const{clientConfiguration:e}=this.configuration;if(e.sdkName)return e.sdkName;let t=`PubNub-JS-${e.sdkFamily}`;e.partnerId&&(t+=`-${e.partnerId}`),t+=`/${e.getVersion()}`;const r=e._getPnsdkSuffix(" ");return r.length>0&&(t+=r),t}}class A{constructor(){this.listeners=[]}addListener(e){this.listeners.includes(e)||this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter((t=>t!==e))}removeAllListeners(){this.listeners=[]}announceStatus(e){this.listeners.forEach((t=>{t.status&&t.status(e)}))}announcePresence(e){this.listeners.forEach((t=>{t.presence&&t.presence(e)}))}announceMessage(e){this.listeners.forEach((t=>{t.message&&t.message(e)}))}announceSignal(e){this.listeners.forEach((t=>{t.signal&&t.signal(e)}))}announceMessageAction(e){this.listeners.forEach((t=>{t.messageAction&&t.messageAction(e)}))}announceFile(e){this.listeners.forEach((t=>{t.file&&t.file(e)}))}announceObjects(e){this.listeners.forEach((t=>{t.objects&&t.objects(e)}))}announceNetworkUp(){this.listeners.forEach((e=>{e.status&&e.status({category:s.PNNetworkUpCategory})}))}announceNetworkDown(){this.listeners.forEach((e=>{e.status&&e.status({category:s.PNNetworkDownCategory})}))}announceUser(e){this.listeners.forEach((t=>{t.user&&t.user(e)}))}announceSpace(e){this.listeners.forEach((t=>{t.space&&t.space(e)}))}announceMembership(e){this.listeners.forEach((t=>{t.membership&&t.membership(e)}))}}class O{constructor(e){this.params=e,this.requestIdentifier=w.createUUID(),this._cancellationController=null}get cancellationController(){return this._cancellationController}set cancellationController(e){this._cancellationController=e}abort(){this&&this.cancellationController&&this.cancellationController.abort()}operation(){throw Error("Should be implemented by subclass.")}validate(){}parse(e){return o(this,void 0,void 0,(function*(){throw Error("Should be implemented by subclass.")}))}request(){var e,t,r,n;const o={method:null!==(t=null===(e=this.params)||void 0===e?void 0:e.method)&&void 0!==t?t:P.GET,path:this.path,queryParameters:this.queryParameters,cancellable:null!==(n=null===(r=this.params)||void 0===r?void 0:r.cancellable)&&void 0!==n&&n,timeout:1e4,identifier:this.requestIdentifier},s=this.headers;if(s&&(o.headers=s),o.method===P.POST||o.method===P.PATCH){const[e,t]=[this.body,this.formData];t&&(o.formData=t),e&&(o.body=e)}return o}get headers(){}get path(){throw Error("`path` getter should be implemented by subclass.")}get queryParameters(){return{}}get formData(){}get body(){}deserializeResponse(e){const t=e.headers["content-type"];if(!t||-1===t.indexOf("javascript")&&-1===t.indexOf("json"))return;const r=O.decoder.decode(e.body);try{return JSON.parse(r)}catch(e){return void console.error("Error parsing JSON response:",e)}}}O.decoder=new TextDecoder,function(e){e.PNPublishOperation="PNPublishOperation",e.PNSignalOperation="PNSignalOperation",e.PNSubscribeOperation="PNSubscribeOperation",e.PNUnsubscribeOperation="PNUnsubscribeOperation",e.PNWhereNowOperation="PNWhereNowOperation",e.PNHereNowOperation="PNHereNowOperation",e.PNGlobalHereNowOperation="PNGlobalHereNowOperation",e.PNSetStateOperation="PNSetStateOperation",e.PNGetStateOperation="PNGetStateOperation",e.PNHeartbeatOperation="PNHeartbeatOperation",e.PNAddMessageActionOperation="PNAddActionOperation",e.PNRemoveMessageActionOperation="PNRemoveMessageActionOperation",e.PNGetMessageActionsOperation="PNGetMessageActionsOperation",e.PNTimeOperation="PNTimeOperation",e.PNHistoryOperation="PNHistoryOperation",e.PNDeleteMessagesOperation="PNDeleteMessagesOperation",e.PNFetchMessagesOperation="PNFetchMessagesOperation",e.PNMessageCounts="PNMessageCountsOperation",e.PNGetAllUUIDMetadataOperation="PNGetAllUUIDMetadataOperation",e.PNGetUUIDMetadataOperation="PNGetUUIDMetadataOperation",e.PNSetUUIDMetadataOperation="PNSetUUIDMetadataOperation",e.PNRemoveUUIDMetadataOperation="PNRemoveUUIDMetadataOperation",e.PNGetAllChannelMetadataOperation="PNGetAllChannelMetadataOperation",e.PNGetChannelMetadataOperation="PNGetChannelMetadataOperation",e.PNSetChannelMetadataOperation="PNSetChannelMetadataOperation",e.PNRemoveChannelMetadataOperation="PNRemoveChannelMetadataOperation",e.PNGetMembersOperation="PNGetMembersOperation",e.PNSetMembersOperation="PNSetMembersOperation",e.PNGetMembershipsOperation="PNGetMembershipsOperation",e.PNSetMembershipsOperation="PNSetMembershipsOperation",e.PNListFilesOperation="PNListFilesOperation",e.PNGenerateUploadUrlOperation="PNGenerateUploadUrlOperation",e.PNPublishFileOperation="PNPublishFileOperation",e.PNPublishFileMessageOperation="PNPublishFileMessageOperation",e.PNGetFileUrlOperation="PNGetFileUrlOperation",e.PNDownloadFileOperation="PNDownloadFileOperation",e.PNDeleteFileOperation="PNDeleteFileOperation",e.PNAddPushNotificationEnabledChannelsOperation="PNAddPushNotificationEnabledChannelsOperation",e.PNRemovePushNotificationEnabledChannelsOperation="PNRemovePushNotificationEnabledChannelsOperation",e.PNPushNotificationEnabledChannelsOperation="PNPushNotificationEnabledChannelsOperation",e.PNRemoveAllPushNotificationsOperation="PNRemoveAllPushNotificationsOperation",e.PNChannelGroupsOperation="PNChannelGroupsOperation",e.PNRemoveGroupOperation="PNRemoveGroupOperation",e.PNChannelsForGroupOperation="PNChannelsForGroupOperation",e.PNAddChannelsToGroupOperation="PNAddChannelsToGroupOperation",e.PNRemoveChannelsFromGroupOperation="PNRemoveChannelsFromGroupOperation",e.PNAccessManagerGrant="PNAccessManagerGrant",e.PNAccessManagerGrantToken="PNAccessManagerGrantToken",e.PNAccessManagerAudit="PNAccessManagerAudit",e.PNAccessManagerRevokeToken="PNAccessManagerRevokeToken",e.PNHandshakeOperation="PNHandshakeOperation",e.PNReceiveMessagesOperation="PNReceiveMessagesOperation"}(C||(C={}));var S,_=C;!function(e){e[e.Presence=-2]="Presence",e[e.Message=-1]="Message",e[e.Signal=1]="Signal",e[e.AppContext=2]="AppContext",e[e.MessageAction=3]="MessageAction",e[e.Files=4]="Files"}(S||(S={}));class k{constructor(e){this.listenerManager=e,this.channelListenerMap=new Map,this.groupListenerMap=new Map}emitEvent(e){if(e.type===S.Message)this.listenerManager.announceMessage(e.data),this.announce("message",e.data,e.data.channel,e.data.subscription);else if(e.type===S.Signal)this.listenerManager.announceSignal(e.data),this.announce("signal",e.data,e.data.channel,e.data.subscription);else if(e.type===S.Presence)this.listenerManager.announcePresence(e.data),this.announce("presence",e.data,e.data.channel,e.data.subscription);else if(e.type===S.AppContext){const{data:t}=e,{message:r}=t;if(this.listenerManager.announceObjects(t),this.announce("objects",t,t.channel,t.subscription),"uuid"===r.type){const{message:e,channel:o}=t,s=n(t,["message","channel"]),{event:i,type:a}=r,c=n(r,["event","type"]),u=Object.assign(Object.assign({},s),{spaceId:o,message:Object.assign(Object.assign({},c),{event:"set"===i?"updated":"removed",type:"user"})});this.listenerManager.announceUser(u),this.announce("user",u,u.spaceId,u.subscription)}else if("channel"===r.type){const{message:e,channel:o}=t,s=n(t,["message","channel"]),{event:i,type:a}=r,c=n(r,["event","type"]),u=Object.assign(Object.assign({},s),{spaceId:o,message:Object.assign(Object.assign({},c),{event:"set"===i?"updated":"removed",type:"space"})});this.listenerManager.announceSpace(u),this.announce("space",u,u.spaceId,u.subscription)}else if("membership"===r.type){const{message:e,channel:o}=t,s=n(t,["message","channel"]),{event:i,data:a}=r,c=n(r,["event","data"]),{uuid:u,channel:l}=a,d=n(a,["uuid","channel"]),h=Object.assign(Object.assign({},s),{spaceId:o,message:Object.assign(Object.assign({},c),{event:"set"===i?"updated":"removed",data:Object.assign(Object.assign({},d),{user:u,space:l})})});this.listenerManager.announceMembership(h),this.announce("membership",h,h.spaceId,h.subscription)}}else e.type===S.MessageAction?(this.listenerManager.announceMessageAction(e.data),this.announce("messageAction",e.data,e.data.channel,e.data.subscription)):e.type===S.Files&&(this.listenerManager.announceFile(e.data),this.announce("file",e.data,e.data.channel,e.data.subscription))}addListener(e,t,r){t&&r?(null==t||t.forEach((t=>{if(this.channelListenerMap.has(t)){const r=this.channelListenerMap.get(t);r.includes(e)||r.push(e)}else this.channelListenerMap.set(t,[e])})),null==r||r.forEach((t=>{if(this.groupListenerMap.has(t)){const r=this.groupListenerMap.get(t);r.includes(e)||r.push(e)}else this.groupListenerMap.set(t,[e])}))):this.listenerManager.addListener(e)}removeListener(e,t,r){t&&r?(null==t||t.forEach((t=>{this.channelListenerMap.has(t)&&this.channelListenerMap.set(t,this.channelListenerMap.get(t).filter((t=>t!==e)))})),null==r||r.forEach((t=>{this.groupListenerMap.has(t)&&this.groupListenerMap.set(t,this.groupListenerMap.get(t).filter((t=>t!==e)))}))):this.listenerManager.removeListener(e)}removeAllListeners(){this.listenerManager.removeAllListeners(),this.channelListenerMap.clear(),this.groupListenerMap.clear()}announce(e,t,r,n){t&&this.channelListenerMap.has(r)&&this.channelListenerMap.get(r).forEach((r=>{const n=r[e];n&&n(t)})),n&&this.groupListenerMap.has(n)&&this.groupListenerMap.get(n).forEach((r=>{const n=r[e];n&&n(t)}))}}class x{transition(e,t){var r;if(this.transitionMap.has(t.type))return null===(r=this.transitionMap.get(t.type))||void 0===r?void 0:r(e,t)}constructor(e){this.label=e,this.transitionMap=new Map,this.enterEffects=[],this.exitEffects=[]}on(e,t){return this.transitionMap.set(e,t),this}with(e,t){return[this,e,null!=t?t:[]]}onEnter(e){return this.enterEffects.push(e),this}onExit(e){return this.exitEffects.push(e),this}}function D(e,t){const r=function(...r){return{type:e,payload:null==t?void 0:t(...r)}};return r.type=e,r}function I(e,t){const r=(...r)=>({type:e,payload:t(...r),managed:!1});return r.type=e,r}function U(e,t){const r=(...r)=>({type:e,payload:t(...r),managed:!0});return r.type=e,r.cancel={type:"CANCEL",payload:e,managed:!1},r}const R=D("RECONNECT",(()=>({}))),T=D("DISCONNECT",(()=>({}))),F=D("JOINED",((e,t)=>({channels:e,groups:t}))),B=D("LEFT",((e,t)=>({channels:e,groups:t}))),H=D("LEFT_ALL",(()=>({}))),L=D("HEARTBEAT_SUCCESS",(e=>({statusCode:e}))),G=D("HEARTBEAT_FAILURE",(e=>e)),j=D("HEARTBEAT_GIVEUP",(()=>({}))),q=D("TIMES_UP",(()=>({}))),K=I("HEARTBEAT",((e,t)=>({channels:e,groups:t}))),z=I("LEAVE",((e,t)=>({channels:e,groups:t})));I("EMIT_STATUS",(e=>e));const V=U("WAIT",(()=>({}))),$=U("DELAYED_HEARTBEAT",(e=>e)),W=new x("HEARTBEAT_STOPPED");W.on(F.type,((e,t)=>W.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),W.on(B.type,((e,t)=>W.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))}))),W.on(R.type,((e,t)=>Q.with({channels:e.channels,groups:e.groups}))),W.on(H.type,((e,t)=>Z.with(void 0)));const J=new x("HEARTBEAT_COOLDOWN");J.onEnter((()=>V())),J.onExit((()=>V.cancel)),J.on(q.type,((e,t)=>Q.with({channels:e.channels,groups:e.groups}))),J.on(F.type,((e,t)=>Q.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),J.on(B.type,((e,t)=>Q.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[z(t.payload.channels,t.payload.groups)]))),J.on(T.type,(e=>W.with({channels:e.channels,groups:e.groups},[z(e.channels,e.groups)]))),J.on(H.type,((e,t)=>Z.with(void 0,[z(e.channels,e.groups)])));const X=new x("HEARTBEAT_FAILED");X.on(F.type,((e,t)=>Q.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),X.on(B.type,((e,t)=>Q.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[z(t.payload.channels,t.payload.groups)]))),X.on(R.type,((e,t)=>Q.with({channels:e.channels,groups:e.groups}))),X.on(T.type,((e,t)=>W.with({channels:e.channels,groups:e.groups},[z(e.channels,e.groups)]))),X.on(H.type,((e,t)=>Z.with(void 0,[z(e.channels,e.groups)])));const Y=new x("HEARBEAT_RECONNECTING");Y.onEnter((e=>$(e))),Y.onExit((()=>$.cancel)),Y.on(F.type,((e,t)=>Q.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),Y.on(B.type,((e,t)=>Q.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[z(t.payload.channels,t.payload.groups)]))),Y.on(T.type,((e,t)=>{W.with({channels:e.channels,groups:e.groups},[z(e.channels,e.groups)])})),Y.on(L.type,((e,t)=>J.with({channels:e.channels,groups:e.groups}))),Y.on(G.type,((e,t)=>Y.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),Y.on(j.type,((e,t)=>X.with({channels:e.channels,groups:e.groups}))),Y.on(H.type,((e,t)=>Z.with(void 0,[z(e.channels,e.groups)])));const Q=new x("HEARTBEATING");Q.onEnter((e=>K(e.channels,e.groups))),Q.on(L.type,((e,t)=>J.with({channels:e.channels,groups:e.groups}))),Q.on(F.type,((e,t)=>Q.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),Q.on(B.type,((e,t)=>Q.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[z(t.payload.channels,t.payload.groups)]))),Q.on(G.type,((e,t)=>Y.with(Object.assign(Object.assign({},e),{attempts:0,reason:t.payload})))),Q.on(T.type,(e=>W.with({channels:e.channels,groups:e.groups},[z(e.channels,e.groups)]))),Q.on(H.type,((e,t)=>Z.with(void 0,[z(e.channels,e.groups)])));const Z=new x("HEARTBEAT_INACTIVE");Z.on(F.type,((e,t)=>Q.with({channels:t.payload.channels,groups:t.payload.groups})));class ee{static LinearRetryPolicy(e){return{delay:e.delay,maximumRetry:e.maximumRetry,shouldRetry(e,t){var r;return 403!==(null===(r=null==e?void 0:e.status)||void 0===r?void 0:r.statusCode)&&this.maximumRetry>t},getDelay(e,t){var r;return 1e3*((null!==(r=t.retryAfter)&&void 0!==r?r:this.delay)+Math.random())},getGiveupReason(e,t){var r;return this.maximumRetry<=t?"retry attempts exhaused.":403===(null===(r=null==e?void 0:e.status)||void 0===r?void 0:r.statusCode)?"forbidden operation.":"unknown error"},validate(){if(this.maximumRetry>10)throw new Error("Maximum retry for linear retry policy can not be more than 10")}}}static ExponentialRetryPolicy(e){return{minimumDelay:e.minimumDelay,maximumDelay:e.maximumDelay,maximumRetry:e.maximumRetry,shouldRetry(e,t){var r;return 403!==(null===(r=null==e?void 0:e.status)||void 0===r?void 0:r.statusCode)&&this.maximumRetry>t},getDelay(e,t){var r;return 1e3*((null!==(r=t.retryAfter)&&void 0!==r?r:Math.min(Math.pow(2,e),this.maximumDelay))+Math.random())},getGiveupReason(e,t){var r;return this.maximumRetry<=t?"retry attempts exhausted.":403===(null===(r=null==e?void 0:e.status)||void 0===r?void 0:r.statusCode)?"forbidden operation.":"unknown error"},validate(){if(this.minimumDelay<2)throw new Error("Minimum delay can not be set less than 2 seconds for retry");if(this.maximumDelay)throw new Error("Maximum delay can not be set more than 150 seconds for retry");if(this.maximumRetry>6)throw new Error("Maximum retry for exponential retry policy can not be more than 6")}}}}const te=U("HANDSHAKE",((e,t)=>({channels:e,groups:t}))),re=U("RECEIVE_MESSAGES",((e,t,r)=>({channels:e,groups:t,cursor:r}))),ne=I("EMIT_MESSAGES",(e=>e)),oe=I("EMIT_STATUS",(e=>e)),se=U("RECEIVE_RECONNECT",(e=>e)),ie=U("HANDSHAKE_RECONNECT",(e=>e)),ae=D("SUBSCRIPTION_CHANGED",((e,t)=>({channels:e,groups:t}))),ce=D("SUBSCRIPTION_RESTORED",((e,t,r,n)=>({channels:e,groups:t,cursor:{timetoken:r,region:null!=n?n:0}}))),ue=D("HANDSHAKE_SUCCESS",(e=>e)),le=D("HANDSHAKE_FAILURE",(e=>e)),de=D("HANDSHAKE_RECONNECT_SUCCESS",(e=>({cursor:e}))),he=D("HANDSHAKE_RECONNECT_FAILURE",(e=>e)),pe=D("HANDSHAKE_RECONNECT_GIVEUP",(e=>e)),ge=D("RECEIVE_SUCCESS",((e,t)=>({cursor:e,events:t}))),ye=D("RECEIVE_FAILURE",(e=>e)),fe=D("RECEIVE_RECONNECT_SUCCESS",((e,t)=>({cursor:e,events:t}))),ve=D("RECEIVE_RECONNECT_FAILURE",(e=>e)),me=D("RECEIVING_RECONNECT_GIVEUP",(e=>e)),be=D("DISCONNECT",(()=>({}))),we=D("RECONNECT",((e,t)=>({cursor:{timetoken:null!=e?e:"",region:null!=t?t:0}}))),Ee=D("UNSUBSCRIBE_ALL",(()=>({}))),Ne=new x("HANDSHAKE_FAILED");Ne.on(ae.type,((e,t)=>_e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Ne.on(we.type,((e,t)=>_e.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor||e.cursor}))),Ne.on(ce.type,((e,t)=>{var r,n;return _e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region?t.payload.cursor.region:null!==(n=null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.region)&&void 0!==n?n:0}})})),Ne.on(Ee.type,(e=>ke.with()));const Pe=new x("HANDSHAKE_STOPPED");Pe.on(ae.type,((e,t)=>Pe.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Pe.on(we.type,((e,t)=>_e.with(Object.assign(Object.assign({},e),{cursor:t.payload.cursor||e.cursor})))),Pe.on(ce.type,((e,t)=>{var r;return Pe.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||(null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.region)||0}})})),Pe.on(Ee.type,(e=>ke.with()));const Ce=new x("RECEIVE_FAILED");Ce.on(we.type,((e,t)=>{var r;return _e.with({channels:e.channels,groups:e.groups,cursor:{timetoken:t.payload.cursor.timetoken?null===(r=t.payload.cursor)||void 0===r?void 0:r.timetoken:e.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),Ce.on(ae.type,((e,t)=>_e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Ce.on(ce.type,((e,t)=>_e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),Ce.on(Ee.type,(e=>ke.with(void 0)));const Me=new x("RECEIVE_STOPPED");Me.on(ae.type,((e,t)=>Me.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Me.on(ce.type,((e,t)=>Me.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),Me.on(we.type,((e,t)=>{var r;return _e.with({channels:e.channels,groups:e.groups,cursor:{timetoken:t.payload.cursor.timetoken?null===(r=t.payload.cursor)||void 0===r?void 0:r.timetoken:e.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),Me.on(Ee.type,(()=>ke.with(void 0)));const Ae=new x("RECEIVE_RECONNECTING");Ae.onEnter((e=>se(e))),Ae.onExit((()=>se.cancel)),Ae.on(fe.type,((e,t)=>Oe.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor},[ne(t.payload.events)]))),Ae.on(ve.type,((e,t)=>Ae.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),Ae.on(me.type,((e,t)=>{var r;return Ce.with({groups:e.groups,channels:e.channels,cursor:e.cursor,reason:t.payload},[oe({category:s.PNDisconnectedUnexpectedlyCategory,error:null===(r=t.payload)||void 0===r?void 0:r.message})])})),Ae.on(be.type,(e=>Me.with({channels:e.channels,groups:e.groups,cursor:e.cursor},[oe({category:s.PNDisconnectedCategory})]))),Ae.on(ce.type,((e,t)=>Oe.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),Ae.on(ae.type,((e,t)=>Oe.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Ae.on(Ee.type,(e=>ke.with(void 0,[oe({category:s.PNDisconnectedCategory})])));const Oe=new x("RECEIVING");Oe.onEnter((e=>re(e.channels,e.groups,e.cursor))),Oe.onExit((()=>re.cancel)),Oe.on(ge.type,((e,t)=>Oe.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor},[ne(t.payload.events)]))),Oe.on(ae.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?ke.with(void 0):Oe.with({cursor:e.cursor,channels:t.payload.channels,groups:t.payload.groups}))),Oe.on(ce.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?ke.with(void 0):Oe.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),Oe.on(ye.type,((e,t)=>Ae.with(Object.assign(Object.assign({},e),{attempts:0,reason:t.payload})))),Oe.on(be.type,(e=>Me.with({channels:e.channels,groups:e.groups,cursor:e.cursor},[oe({category:s.PNDisconnectedCategory})]))),Oe.on(Ee.type,(e=>ke.with(void 0,[oe({category:s.PNDisconnectedCategory})])));const Se=new x("HANDSHAKE_RECONNECTING");Se.onEnter((e=>ie(e))),Se.onExit((()=>ie.cancel)),Se.on(de.type,((e,t)=>{var r,n;const o={timetoken:(null===(r=e.cursor)||void 0===r?void 0:r.timetoken)?null===(n=e.cursor)||void 0===n?void 0:n.timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region};return Oe.with({channels:e.channels,groups:e.groups,cursor:o},[oe({category:s.PNConnectedCategory})])})),Se.on(he.type,((e,t)=>Se.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),Se.on(pe.type,((e,t)=>{var r;return Ne.with({groups:e.groups,channels:e.channels,cursor:e.cursor,reason:t.payload},[oe({category:s.PNConnectionErrorCategory,error:null===(r=t.payload)||void 0===r?void 0:r.message})])})),Se.on(be.type,(e=>Pe.with({channels:e.channels,groups:e.groups,cursor:e.cursor}))),Se.on(ae.type,((e,t)=>_e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Se.on(ce.type,((e,t)=>{var r,n;return _e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:(null===(r=t.payload.cursor)||void 0===r?void 0:r.region)||(null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.region)||0}})})),Se.on(Ee.type,(e=>ke.with(void 0)));const _e=new x("HANDSHAKING");_e.onEnter((e=>te(e.channels,e.groups))),_e.onExit((()=>te.cancel)),_e.on(ae.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?ke.with(void 0):_e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),_e.on(ue.type,((e,t)=>{var r,n;return Oe.with({channels:e.channels,groups:e.groups,cursor:{timetoken:(null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.timetoken)?null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.timetoken:t.payload.timetoken,region:t.payload.region}},[oe({category:s.PNConnectedCategory})])})),_e.on(le.type,((e,t)=>Se.with({channels:e.channels,groups:e.groups,cursor:e.cursor,attempts:0,reason:t.payload}))),_e.on(be.type,(e=>Pe.with({channels:e.channels,groups:e.groups,cursor:e.cursor}))),_e.on(ce.type,((e,t)=>{var r;return _e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||(null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.region)||0}})})),_e.on(Ee.type,(e=>ke.with()));const ke=new x("UNSUBSCRIBED");var xe;ke.on(ae.type,((e,t)=>_e.with({channels:t.payload.channels,groups:t.payload.groups}))),ke.on(ce.type,((e,t)=>_e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:t.payload.cursor}))),function(e){e[e.Message=-1]="Message",e[e.Files=4]="Files"}(xe||(xe={}));class De{constructor(e,t,r){this.id=e,this.eventEmitter=t,this.pubnub=r}subscription(e){throw new Error("Subscription error: subscription module disabled")}}class Ie{constructor(e,t,r){this.eventEmitter=t,this.pubnub=r,this.name=e}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class Ue{constructor(e,t,r){this.id=e,this.eventEmitter=t,this.pubnub=r}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class Re{constructor(e,t,r){this.eventEmitter=t,this.pubnub=r,this.name=e}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class Te extends O{constructor(){super()}operation(){return _.PNTimeOperation}parse(e){return o(this,void 0,void 0,(function*(){const t=this.deserializeResponse(e);if(!t)throw new i("Service response error, check status for details",a("Unable to deserialize service response"));return{timetoken:t[0]}}))}get path(){return"/time/0"}}class Fe{static notificationPayload(e,t){throw new Error("Notification Payload error: publish module disabled")}static generateUUID(){return w.createUUID()}constructor(e){throw this._configuration=e.configuration,this.cryptography=e.cryptography,this.tokenManager=e.tokenManager,this.transport=e.transport,this.crypto=e.crypto,this.listenerManager=new A,this.eventEmitter=new k(this.listenerManager),this._configuration.enableEventEngine?new Error("Event Engine error: subscription event engine module disabled"):new Error("Subscription Manager error: subscription manager module disabled")}get configuration(){return this._configuration}get _config(){return this.configuration}get authKey(){var e;return null!==(e=this._configuration.authKey)&&void 0!==e?e:void 0}getAuthKey(){return this.authKey}setAuthKey(e){this._configuration.setAuthKey(e)}get userId(){return this._configuration.userId}set userId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this._configuration.userId=e}getUserId(){return this._configuration.userId}setUserId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this._configuration.userId=e}get filterExpression(){var e;return null!==(e=this._configuration.getFilterExpression())&&void 0!==e?e:void 0}getFilterExpression(){return this.filterExpression}set filterExpression(e){this._configuration.setFilterExpression(e)}setFilterExpression(e){this.filterExpression=e}get cipherKey(){return this._configuration.getCipherKey()}set cipherKey(e){this._configuration.setCipherKey(e)}setCipherKey(e){this.cipherKey=e}set heartbeatInterval(e){this._configuration.setHeartbeatInterval(e)}setHeartbeatInterval(e){this.heartbeatInterval=e}getVersion(){return this._configuration.getVersion()}_addPnsdkSuffix(e,t){this._configuration._addPnsdkSuffix(e,t)}getUUID(){return this.userId}setUUID(e){this.userId=e}get customEncrypt(){return this._configuration.getCustomEncrypt()}get customDecrypt(){return this._configuration.getCustomDecrypt()}channel(e){return new Re(e,this.eventEmitter,this)}channelGroup(e){return new Ie(e,this.eventEmitter,this)}channelMetadata(e){return new De(e,this.eventEmitter,this)}userMetadata(e){return new Ue(e,this.eventEmitter,this)}subscriptionSet(e){throw new Error("Subscription error: subscription event engine module disabled")}sendRequest(e,t){return o(this,void 0,void 0,(function*(){const r=e.validate();if(r){if(t)return t(a(r),null);throw new i("Validation failed, check status for details",a(r))}const n=e.request();n.formData&&n.formData.length>0?n.timeout=300:e.operation()===_.PNSubscribeOperation?n.timeout=this._configuration.getSubscribeTimeout():n.timeout=this._configuration.getTransactionTimeout();const o={error:!1,operation:e.operation(),category:s.PNAcknowledgmentCategory,statusCode:0},[c,u]=this.transport.makeSendable(n);return e.cancellationController=u||null,c.then((t=>{if(o.statusCode=t.status,200!==t.status&&204!==t.status){const e=t.headers["content-type"];if(e||-1!==e.indexOf("javascript")||-1!==e.indexOf("json")){const e=JSON.parse(Fe.decoder.decode(t.body));"object"==typeof e&&"error"in e&&e.error&&"object"==typeof e.error&&(o.errorData=e.error)}}return e.parse(t)})).then((e=>t?t(o,e):e)).catch((r=>{const n=r instanceof g?r:g.create(r);if(t)return t(n.toStatus(e.operation()),null);throw n.toPubNubError(e.operation(),"REST API request processing error, check status for details")}))}))}destroy(e){this.subscriptionManager?(this.subscriptionManager.unsubscribeAll(e),this.subscriptionManager.disconnect()):this.eventEngine&&this.eventEngine.dispose()}stop(){this.destroy()}addListener(e){this.listenerManager.addListener(e)}removeListener(e){this.listenerManager.removeListener(e)}removeAllListeners(){this.listenerManager.removeAllListeners()}publish(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Publish error: publish module disabled")}))}signal(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Publish error: publish module disabled")}))}fire(e,t){return o(this,void 0,void 0,(function*(){return null!=t||(t=()=>{}),this.publish(Object.assign(Object.assign({},e),{replicate:!1,storeInHistory:!1}),t)}))}getSubscribedChannels(){return this.subscriptionManager?this.subscriptionManager.subscribedChannels:this.eventEngine?this.eventEngine.getSubscribedChannels():[]}getSubscribedChannelGroups(){return this.subscriptionManager?this.subscriptionManager.subscribedChannelGroups:this.eventEngine?this.eventEngine.getSubscribedChannelGroups():[]}subscribe(e){this.subscriptionManager?this.subscriptionManager.subscribe(e):this.eventEngine&&this.eventEngine.subscribe(e)}makeSubscribe(e,t){throw new Error("Subscription error: subscription manager module disabled")}unsubscribe(e){this.subscriptionManager?this.subscriptionManager.unsubscribe(e):this.eventEngine&&this.eventEngine.unsubscribe(e)}makeUnsubscribe(e,t){throw new Error("Unsubscription error: presence module disabled")}unsubscribeAll(){this.subscriptionManager?this.subscriptionManager.unsubscribeAll():this.eventEngine&&this.eventEngine.unsubscribeAll()}disconnect(){this.subscriptionManager?this.subscriptionManager.disconnect():this.eventEngine&&this.eventEngine.disconnect()}reconnect(e){this.subscriptionManager?this.subscriptionManager.reconnect():this.eventEngine&&this.eventEngine.reconnect(null!=e?e:{})}subscribeHandshake(e){return o(this,void 0,void 0,(function*(){throw new Error("Subscription error: subscription event engine module disabled")}))}subscribeReceiveMessages(e){return o(this,void 0,void 0,(function*(){throw new Error("Subscription error: subscription event engine module disabled")}))}getMessageActions(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Get Message Actions error: message reactions module disabled")}))}addMessageAction(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Add Message Action error: message reactions module disabled")}))}removeMessageAction(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Remove Message Action error: message reactions module disabled")}))}fetchMessages(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Fetch Messages History error: message persistence module disabled")}))}deleteMessages(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Delete Messages error: message persistence module disabled")}))}messageCounts(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Get Messages Count error: message persistence module disabled")}))}history(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Get Messages History error: message persistence module disabled")}))}hereNow(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Get Channel Here Now error: presence module disabled")}))}whereNow(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Get UUID Here Now error: presence module disabled")}))}getState(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Get UUID State error: presence module disabled")}))}setState(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Set UUID State error: presence module disabled")}))}presence(e){throw new Error("Change UUID presence error: subscription manager module disabled")}heartbeat(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Announce UUID Presence error: presence module disabled")}))}join(e){throw new Error("Announce UUID Presence error: presence module disabled")}leave(e){throw new Error("Announce UUID Leave error: presence module disabled")}leaveAll(){throw new Error("Announce UUID Leave error: presence module disabled")}grantToken(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Grant Token error: PAM module disabled")}))}revokeToken(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Revoke Token error: PAM module disabled")}))}get token(){return this.tokenManager&&this.tokenManager.getToken()}getToken(){return this.token}set token(e){this.tokenManager&&this.tokenManager.setToken(e)}setToken(e){this.token=e}parseToken(e){return this.tokenManager&&this.tokenManager.parseToken(e)}grant(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Grant error: PAM module disabled")}))}audit(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Grant Permissions error: PAM module disabled")}))}get objects(){return this._objects}fetchUsers(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Fetch Users Metadata error: App Context module disabled")}))}fetchUser(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Fetch User Metadata error: App Context module disabled")}))}createUser(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Create User Metadata error: App Context module disabled")}))}updateUser(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Update User Metadata error: App Context module disabled")}))}removeUser(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Remove User Metadata error: App Context module disabled")}))}fetchSpaces(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Fetch Spaces Metadata error: App Context module disabled")}))}fetchSpace(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Fetch Space Metadata error: App Context module disabled")}))}createSpace(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Create Space Metadata error: App Context module disabled")}))}updateSpace(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Update Space Metadata error: App Context module disabled")}))}removeSpace(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Remove Space Metadata error: App Context module disabled")}))}fetchMemberships(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Fetch Memberships error: App Context module disabled")}))}addMemberships(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Add Memberships error: App Context module disabled")}))}updateMemberships(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Update Memberships error: App Context module disabled")}))}removeMemberships(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Remove Memberships error: App Context module disabled")}))}get channelGroups(){return this._channelGroups}get push(){return this._push}sendFile(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Send File error: file sharing module disabled")}))}publishFile(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Publish File error: file sharing module disabled")}))}listFiles(e,t){return o(this,void 0,void 0,(function*(){throw new Error("List Files error: file sharing module disabled")}))}getFileUrl(e){throw new Error("Generate File Download Url error: file sharing module disabled")}downloadFile(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Download File error: file sharing module disabled")}))}deleteFile(e,t){return o(this,void 0,void 0,(function*(){throw new Error("Delete File error: file sharing module disabled")}))}time(e){return o(this,void 0,void 0,(function*(){const t=new Te;return e?this.sendRequest(t,e):this.sendRequest(t)}))}encrypt(e,t){const r=this._configuration.getCryptoModule();if(!t&&r&&"string"==typeof e){const t=r.encrypt(e);return"string"==typeof t?t:function(e){let t="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(e),o=n.byteLength,s=o%3,i=o-s;let a,c,u,l,d;for(let e=0;e<i;e+=3)d=n[e]<<16|n[e+1]<<8|n[e+2],a=(16515072&d)>>18,c=(258048&d)>>12,u=(4032&d)>>6,l=63&d,t+=r[a]+r[c]+r[u]+r[l];return 1==s?(d=n[i],a=(252&d)>>2,c=(3&d)<<4,t+=r[a]+r[c]+"=="):2==s&&(d=n[i]<<8|n[i+1],a=(64512&d)>>10,c=(1008&d)>>4,u=(15&d)<<2,t+=r[a]+r[c]+r[u]+"="),t}(t)}if(!this.crypto)throw new Error("Encryption error: cypher key not set");throw new Error("Encryption error: crypto module disabled")}decrypt(e,t){const r=this._configuration.getCryptoModule();if(!t&&r){const t=r.decrypt(e);return t instanceof ArrayBuffer?JSON.parse((new TextDecoder).decode(t)):t}if(!this.crypto)throw new Error("Decryption error: cypher key not set");throw new Error("Decryption error: crypto module disabled")}encryptFile(e,t){return o(this,void 0,void 0,(function*(){if("string"!=typeof e&&(t=e),!t)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File encryption error. File constructor not configured.");if("string"!=typeof e&&!this._configuration.getCryptoModule())throw new Error("File encryption error. Crypto module not configured.");if("string"==typeof e){if(!this.cryptography)throw new Error("File encryption error. File encryption not available");throw new Error("Encryption error: file sharing module disabled")}throw new Error("Encryption error: file sharing module disabled")}))}decryptFile(e,t){return o(this,void 0,void 0,(function*(){if("string"!=typeof e&&(t=e),!t)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File decryption error. File constructor not configured.");if("string"==typeof e&&!this._configuration.getCryptoModule())throw new Error("File decryption error. Crypto module not configured.");if("string"==typeof e){if(!this.cryptography)throw new Error("File decryption error. File decryption not available");throw new Error("Decryption error: file sharing module disabled")}throw new Error("Decryption error: file sharing module disabled")}))}}Fe.decoder=new TextDecoder,Fe.OPERATIONS=_,Fe.CATEGORIES=s,Fe.ExponentialRetryPolicy=ee.ExponentialRetryPolicy,Fe.LinearRetryPolicy=ee.LinearRetryPolicy;class Be extends Fe{constructor(e){var t;const r=v(e),n=Object.assign(Object.assign({},r),{sdkFamily:"Web"}),o=E(n,(e=>{e.cipherKey}));let s,i=new f(o.keepAlive,o.logVerbosity);super({configuration:o,transport:new M({clientConfiguration:o,tokenManager:s,transport:i}),cryptography:undefined,tokenManager:s,crypto:undefined}),(null===(t=e.listenToBrowserNetworkEvents)||void 0===t||t)&&(window.addEventListener("offline",(()=>{this.networkDownDetected()})),window.addEventListener("online",(()=>{this.networkUpDetected()})))}networkDownDetected(){this.listenerManager.announceNetworkDown(),this._configuration.restore?this.disconnect():this.destroy(!0)}networkUpDetected(){this.listenerManager.announceNetworkUp(),this.reconnect()}}return Be.CryptoModule=void 0,Be}));
