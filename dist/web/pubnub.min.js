!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).PubNub=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r;function n(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}function s(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))}!function(t){!function(e,r){var n=Math.pow(2,-24),s=Math.pow(2,32),o=Math.pow(2,53);var i={encode:function(e){var t,n=new ArrayBuffer(256),i=new DataView(n),a=0;function c(e){for(var r=n.byteLength,s=a+e;r<s;)r*=2;if(r!==n.byteLength){var o=i;n=new ArrayBuffer(r),i=new DataView(n);for(var c=a+3>>2,u=0;u<c;++u)i.setUint32(4*u,o.getUint32(4*u))}return t=e,i}function u(){a+=t}function l(e){u(c(1).setUint8(a,e))}function h(e){for(var t=c(e.length),r=0;r<e.length;++r)t.setUint8(a+r,e[r]);u()}function p(e,t){t<24?l(e<<5|t):t<256?(l(e<<5|24),l(t)):t<65536?(l(e<<5|25),function(e){u(c(2).setUint16(a,e))}(t)):t<4294967296?(l(e<<5|26),function(e){u(c(4).setUint32(a,e))}(t)):(l(e<<5|27),function(e){var t=e%s,r=(e-t)/s,n=c(8);n.setUint32(a,r),n.setUint32(a+4,t),u()}(t))}if(function e(t){var n;if(!1===t)return l(244);if(!0===t)return l(245);if(null===t)return l(246);if(t===r)return l(247);switch(typeof t){case"number":if(Math.floor(t)===t){if(0<=t&&t<=o)return p(0,t);if(-o<=t&&t<0)return p(1,-(t+1))}return l(251),function(e){u(c(8).setFloat64(a,e))}(t);case"string":var s=[];for(n=0;n<t.length;++n){var i=t.charCodeAt(n);i<128?s.push(i):i<2048?(s.push(192|i>>6),s.push(128|63&i)):i<55296?(s.push(224|i>>12),s.push(128|i>>6&63),s.push(128|63&i)):(i=(1023&i)<<10,i|=1023&t.charCodeAt(++n),i+=65536,s.push(240|i>>18),s.push(128|i>>12&63),s.push(128|i>>6&63),s.push(128|63&i))}return p(3,s.length),h(s);default:var d;if(Array.isArray(t))for(p(4,d=t.length),n=0;n<d;++n)e(t[n]);else if(t instanceof Uint8Array)p(2,t.length),h(t);else{var g=Object.keys(t);for(p(5,d=g.length),n=0;n<d;++n){var f=g[n];e(f),e(t[f])}}}}(e),"slice"in n)return n.slice(0,a);for(var d=new ArrayBuffer(a),g=new DataView(d),f=0;f<a;++f)g.setUint8(f,i.getUint8(f));return d},decode:function(e,t,o){var i=new DataView(e),a=0;function c(e,t){return a+=t,e}function u(t){return c(new Uint8Array(e,a,t),t)}function l(){return c(i.getUint8(a),1)}function h(){return c(i.getUint16(a),2)}function p(){return c(i.getUint32(a),4)}function d(){return 255===i.getUint8(a)&&(a+=1,!0)}function g(e){if(e<24)return e;if(24===e)return l();if(25===e)return h();if(26===e)return p();if(27===e)return p()*s+p();if(31===e)return-1;throw"Invalid length encoding"}function f(e){var t=l();if(255===t)return-1;var r=g(31&t);if(r<0||t>>5!==e)throw"Invalid indefinite length element";return r}function y(e,t){for(var r=0;r<t;++r){var n=l();128&n&&(n<224?(n=(31&n)<<6|63&l(),t-=1):n<240?(n=(15&n)<<12|(63&l())<<6|63&l(),t-=2):(n=(15&n)<<18|(63&l())<<12|(63&l())<<6|63&l(),t-=3)),n<65536?e.push(n):(n-=65536,e.push(55296|n>>10),e.push(56320|1023&n))}}"function"!=typeof t&&(t=function(e){return e}),"function"!=typeof o&&(o=function(){return r});var m=function e(){var s,p,m=l(),b=m>>5,v=31&m;if(7===b)switch(v){case 25:return function(){var e=new ArrayBuffer(4),t=new DataView(e),r=h(),s=32768&r,o=31744&r,i=1023&r;if(31744===o)o=261120;else if(0!==o)o+=114688;else if(0!==i)return i*n;return t.setUint32(0,s<<16|o<<13|i<<13),t.getFloat32(0)}();case 26:return c(i.getFloat32(a),4);case 27:return c(i.getFloat64(a),8)}if((p=g(v))<0&&(b<2||6<b))throw"Invalid length";switch(b){case 0:return p;case 1:return-1-p;case 2:if(p<0){for(var w=[],E=0;(p=f(b))>=0;)E+=p,w.push(u(p));var C=new Uint8Array(E),N=0;for(s=0;s<w.length;++s)C.set(w[s],N),N+=w[s].length;return C}return u(p);case 3:var P=[];if(p<0)for(;(p=f(b))>=0;)y(P,p);else y(P,p);return String.fromCharCode.apply(null,P);case 4:var M;if(p<0)for(M=[];!d();)M.push(e());else for(M=new Array(p),s=0;s<p;++s)M[s]=e();return M;case 5:var k={};for(s=0;s<p||p<0&&!d();++s){k[e()]=e()}return k;case 6:return t(e(),p);case 7:switch(p){case 20:return!1;case 21:return!0;case 22:return null;case 23:return r;default:return o(p)}}}();if(a!==e.byteLength)throw"Remaining bytes";return m}};t.exports?t.exports=i:e.CBOR||(e.CBOR=i)}(e)}({exports:{}}),"function"==typeof SuppressedError&&SuppressedError,new TextEncoder,new TextDecoder,function(e){e.PNNetworkIssuesCategory="PNNetworkIssuesCategory",e.PNTimeoutCategory="PNTimeoutCategory",e.PNCancelledCategory="PNCancelledCategory",e.PNBadRequestCategory="PNBadRequestCategory",e.PNAccessDeniedCategory="PNAccessDeniedCategory",e.PNValidationErrorCategory="PNValidationErrorCategory",e.PNAcknowledgmentCategory="PNAcknowledgmentCategory",e.PNUnknownCategory="PNUnknownCategory",e.PNNetworkUpCategory="PNNetworkUpCategory",e.PNNetworkDownCategory="PNNetworkDownCategory",e.PNReconnectedCategory="PNReconnectedCategory",e.PNConnectedCategory="PNConnectedCategory",e.PNRequestMessageCountExceededCategory="PNRequestMessageCountExceededCategory",e.PNDisconnectedCategory="PNDisconnectedCategory",e.PNConnectionErrorCategory="PNConnectionErrorCategory",e.PNDisconnectedUnexpectedlyCategory="PNDisconnectedUnexpectedlyCategory"}(r||(r={}));var o=r;class i extends Error{constructor(e,t){super(e),this.status=t,this.name="PubNubError",this.message=e,Object.setPrototypeOf(this,new.target.prototype)}}function a(e,t){return r=Object.assign({message:e},void 0!==t?{statusCode:t}:{}),null!==(n=r.statusCode)&&void 0!==n||(r.statusCode=0),Object.assign(Object.assign({},r),{statusCode:r.statusCode,category:o.PNValidationErrorCategory,error:!0});var r,n}var c,u,l,h,p,d=d||function(e,t){var r={},n=r.lib={},s=function(){},o=n.Base={extend:function(e){s.prototype=this;var t=new s;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=n.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var s=0;s<e;s++)t[n+s>>>2]|=(r[s>>>2]>>>24-s%4*8&255)<<24-(n+s)%4*8;else if(65535<r.length)for(s=0;s<e;s+=4)t[n+s>>>2]=r[s>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new i.init(r,t)}}),a=r.enc={},c=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var s=t[n>>>2]>>>24-n%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new i.init(r,t/2)}},u=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new i.init(r,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=n.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,s=r.sigBytes,o=this.blockSize,a=s/(4*o);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,s=e.min(4*t,s),t){for(var c=0;c<t;c+=o)this._doProcessBlock(n,c);c=n.splice(0,t),r.sigBytes-=s}return new i.init(c,s)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=r.algo={};return r}(Math);!function(e){for(var t=d,r=(s=t.lib).WordArray,n=s.Hasher,s=t.algo,o=[],i=[],a=function(e){return 4294967296*(e-(0|e))|0},c=2,u=0;64>u;){var l;e:{l=c;for(var h=e.sqrt(l),p=2;p<=h;p++)if(!(l%p)){l=!1;break e}l=!0}l&&(8>u&&(o[u]=a(e.pow(c,.5))),i[u]=a(e.pow(c,1/3)),u++),c++}var g=[];s=s.SHA256=n.extend({_doReset:function(){this._hash=new r.init(o.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],s=r[1],o=r[2],a=r[3],c=r[4],u=r[5],l=r[6],h=r[7],p=0;64>p;p++){if(16>p)g[p]=0|e[t+p];else{var d=g[p-15],f=g[p-2];g[p]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+g[p-7]+((f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10)+g[p-16]}d=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&l)+i[p]+g[p],f=((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+(n&s^n&o^s&o),h=l,l=u,u=c,c=a+d|0,a=o,o=s,s=n,n=d+f|0}r[0]=r[0]+n|0,r[1]=r[1]+s|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+c|0,r[5]=r[5]+u|0,r[6]=r[6]+l|0,r[7]=r[7]+h|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;return r[s>>>5]|=128<<24-s%32,r[14+(s+64>>>9<<4)]=e.floor(n/4294967296),r[15+(s+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=n._createHelper(s),t.HmacSHA256=n._createHmacHelper(s)}(Math),u=(c=d).enc.Utf8,c.algo.HMAC=c.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),o=this._iKey=t.clone(),i=s.words,a=o.words,c=0;c<r;c++)i[c]^=1549556828,a[c]^=909522486;s.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),h=(l=d).lib.WordArray,l.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp(),e=[];for(var s=0;s<r;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,i=0;4>i&&s+.75*i<r;i++)e.push(n.charAt(o>>>6*(3-i)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,r=this._map;(n=r.charAt(64))&&-1!=(n=e.indexOf(n))&&(t=n);for(var n=[],s=0,o=0;o<t;o++)if(o%4){var i=r.indexOf(e.charAt(o-1))<<o%4*2,a=r.indexOf(e.charAt(o))>>>6-o%4*2;n[s>>>2]|=(i|a)<<24-s%4*8,s++}return h.create(n,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,r,n,s,o,i){return((e=e+(t&r|~t&n)+s+i)<<o|e>>>32-o)+t}function r(e,t,r,n,s,o,i){return((e=e+(t&n|r&~n)+s+i)<<o|e>>>32-o)+t}function n(e,t,r,n,s,o,i){return((e=e+(t^r^n)+s+i)<<o|e>>>32-o)+t}function s(e,t,r,n,s,o,i){return((e=e+(r^(t|~n))+s+i)<<o|e>>>32-o)+t}for(var o=d,i=(c=o.lib).WordArray,a=c.Hasher,c=o.algo,u=[],l=0;64>l;l++)u[l]=4294967296*e.abs(e.sin(l+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,o){for(var i=0;16>i;i++){var a=e[c=o+i];e[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}i=this._hash.words;var c=e[o+0],l=(a=e[o+1],e[o+2]),h=e[o+3],p=e[o+4],d=e[o+5],g=e[o+6],f=e[o+7],y=e[o+8],m=e[o+9],b=e[o+10],v=e[o+11],w=e[o+12],E=e[o+13],C=e[o+14],N=e[o+15],P=t(P=i[0],S=i[1],k=i[2],M=i[3],c,7,u[0]),M=t(M,P,S,k,a,12,u[1]),k=t(k,M,P,S,l,17,u[2]),S=t(S,k,M,P,h,22,u[3]);P=t(P,S,k,M,p,7,u[4]),M=t(M,P,S,k,d,12,u[5]),k=t(k,M,P,S,g,17,u[6]),S=t(S,k,M,P,f,22,u[7]),P=t(P,S,k,M,y,7,u[8]),M=t(M,P,S,k,m,12,u[9]),k=t(k,M,P,S,b,17,u[10]),S=t(S,k,M,P,v,22,u[11]),P=t(P,S,k,M,w,7,u[12]),M=t(M,P,S,k,E,12,u[13]),k=t(k,M,P,S,C,17,u[14]),P=r(P,S=t(S,k,M,P,N,22,u[15]),k,M,a,5,u[16]),M=r(M,P,S,k,g,9,u[17]),k=r(k,M,P,S,v,14,u[18]),S=r(S,k,M,P,c,20,u[19]),P=r(P,S,k,M,d,5,u[20]),M=r(M,P,S,k,b,9,u[21]),k=r(k,M,P,S,N,14,u[22]),S=r(S,k,M,P,p,20,u[23]),P=r(P,S,k,M,m,5,u[24]),M=r(M,P,S,k,C,9,u[25]),k=r(k,M,P,S,h,14,u[26]),S=r(S,k,M,P,y,20,u[27]),P=r(P,S,k,M,E,5,u[28]),M=r(M,P,S,k,l,9,u[29]),k=r(k,M,P,S,f,14,u[30]),P=n(P,S=r(S,k,M,P,w,20,u[31]),k,M,d,4,u[32]),M=n(M,P,S,k,y,11,u[33]),k=n(k,M,P,S,v,16,u[34]),S=n(S,k,M,P,C,23,u[35]),P=n(P,S,k,M,a,4,u[36]),M=n(M,P,S,k,p,11,u[37]),k=n(k,M,P,S,f,16,u[38]),S=n(S,k,M,P,b,23,u[39]),P=n(P,S,k,M,E,4,u[40]),M=n(M,P,S,k,c,11,u[41]),k=n(k,M,P,S,h,16,u[42]),S=n(S,k,M,P,g,23,u[43]),P=n(P,S,k,M,m,4,u[44]),M=n(M,P,S,k,w,11,u[45]),k=n(k,M,P,S,N,16,u[46]),P=s(P,S=n(S,k,M,P,l,23,u[47]),k,M,c,6,u[48]),M=s(M,P,S,k,f,10,u[49]),k=s(k,M,P,S,C,15,u[50]),S=s(S,k,M,P,d,21,u[51]),P=s(P,S,k,M,w,6,u[52]),M=s(M,P,S,k,h,10,u[53]),k=s(k,M,P,S,b,15,u[54]),S=s(S,k,M,P,a,21,u[55]),P=s(P,S,k,M,y,6,u[56]),M=s(M,P,S,k,N,10,u[57]),k=s(k,M,P,S,g,15,u[58]),S=s(S,k,M,P,E,21,u[59]),P=s(P,S,k,M,p,6,u[60]),M=s(M,P,S,k,v,10,u[61]),k=s(k,M,P,S,l,15,u[62]),S=s(S,k,M,P,m,21,u[63]);i[0]=i[0]+P|0,i[1]=i[1]+S|0,i[2]=i[2]+k|0,i[3]=i[3]+M|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;r[s>>>5]|=128<<24-s%32;var o=e.floor(n/4294967296);for(r[15+(s+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(s+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(r.length+1),this._process(),r=(t=this._hash).words,n=0;4>n;n++)s=r[n],r[n]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=a._createHelper(c),o.HmacMD5=a._createHmacHelper(c)}(Math),function(){var e,t=d,r=(e=t.lib).Base,n=e.WordArray,s=(e=t.algo).EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=(a=this.cfg).hasher.create(),s=n.create(),o=s.words,i=a.keySize,a=a.iterations;o.length<i;){c&&r.update(c);var c=r.update(e).finalize(t);r.reset();for(var u=1;u<a;u++)c=r.finalize(c),r.reset();s.concat(c)}return s.sigBytes=4*i,s}});t.EvpKDF=function(e,t,r){return s.create(r).compute(e,t)}}(),d.lib.Cipher||function(e){var t=(g=d).lib,r=t.Base,n=t.WordArray,s=t.BufferedBlockAlgorithm,o=g.enc.Base64,i=g.algo.EvpKDF,a=t.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,r,n){return("string"==typeof r?f:p).encrypt(e,t,r,n)},decrypt:function(t,r,n){return("string"==typeof r?f:p).decrypt(e,t,r,n)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=g.mode={},u=function(e,t,r){var n=this._iv;n?this._iv=undefined:n=this._prevBlock;for(var s=0;s<r;s++)e[t+s]^=n[s]},l=(t.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;u.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),l.Decryptor=l.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,s=e.slice(t,t+n);r.decryptBlock(e,t),u.call(this,e,t,n),this._prevBlock=s}}),c=c.CBC=l,l=(g.pad={}).Pkcs7={pad:function(e,t){for(var r,s=(r=(r=4*t)-e.sigBytes%r)<<24|r<<16|r<<8|r,o=[],i=0;i<r;i+=4)o.push(s);r=n.create(o,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:l}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=t.createEncryptor;else r=t.createDecryptor,this._minBufferSize=1;this._mode=r.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=t.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),p=(c=(g.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?n.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){var t=(e=o.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var r=n.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:r})}},t.SerializableCipher=r.extend({cfg:r.extend({format:c}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var s=e.createEncryptor(r,n);return t=s.finalize(t),s=s.cfg,h.create({ciphertext:t,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),g=(g.kdf={}).OpenSSL={execute:function(e,t,r,s){return s||(s=n.random(8)),e=i.create({keySize:t+r}).compute(e,s),r=n.create(e.words.slice(t),4*r),e.sigBytes=4*t,h.create({key:e,iv:r,salt:s})}},f=t.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:g}),encrypt:function(e,t,r,n){return r=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize),n.iv=r.iv,(e=p.encrypt.call(this,e,t,r.key,n)).mixIn(r),e},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),r=n.kdf.execute(r,e.keySize,e.ivSize,t.salt),n.iv=r.iv,p.decrypt.call(this,e,t,r.key,n)}})}(),function(){for(var e=d,t=e.lib.BlockCipher,r=e.algo,n=[],s=[],o=[],i=[],a=[],c=[],u=[],l=[],h=[],p=[],g=[],f=0;256>f;f++)g[f]=128>f?f<<1:f<<1^283;var y=0,m=0;for(f=0;256>f;f++){var b=(b=m^m<<1^m<<2^m<<3^m<<4)>>>8^255&b^99;n[y]=b,s[b]=y;var v=g[y],w=g[v],E=g[w],C=257*g[b]^16843008*b;o[y]=C<<24|C>>>8,i[y]=C<<16|C>>>16,a[y]=C<<8|C>>>24,c[y]=C,C=16843009*E^65537*w^257*v^16843008*y,u[b]=C<<24|C>>>8,l[b]=C<<16|C>>>16,h[b]=C<<8|C>>>24,p[b]=C,y?(y=v^g[g[g[E^v]]],m^=g[g[m]]):y=m=1}var N=[0,1,2,4,8,16,32,64,128,27,54];r=r.AES=t.extend({_doReset:function(){for(var e=(r=this._key).words,t=r.sigBytes/4,r=4*((this._nRounds=t+6)+1),s=this._keySchedule=[],o=0;o<r;o++)if(o<t)s[o]=e[o];else{var i=s[o-1];o%t?6<t&&4==o%t&&(i=n[i>>>24]<<24|n[i>>>16&255]<<16|n[i>>>8&255]<<8|n[255&i]):(i=n[(i=i<<8|i>>>24)>>>24]<<24|n[i>>>16&255]<<16|n[i>>>8&255]<<8|n[255&i],i^=N[o/t|0]<<24),s[o]=s[o-t]^i}for(e=this._invKeySchedule=[],t=0;t<r;t++)o=r-t,i=t%4?s[o]:s[o-4],e[t]=4>t||4>=o?i:u[n[i>>>24]]^l[n[i>>>16&255]]^h[n[i>>>8&255]]^p[n[255&i]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,i,a,c,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,u,l,h,p,s),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,s,o,i,a){for(var c=this._nRounds,u=e[t]^r[0],l=e[t+1]^r[1],h=e[t+2]^r[2],p=e[t+3]^r[3],d=4,g=1;g<c;g++){var f=n[u>>>24]^s[l>>>16&255]^o[h>>>8&255]^i[255&p]^r[d++],y=n[l>>>24]^s[h>>>16&255]^o[p>>>8&255]^i[255&u]^r[d++],m=n[h>>>24]^s[p>>>16&255]^o[u>>>8&255]^i[255&l]^r[d++];p=n[p>>>24]^s[u>>>16&255]^o[l>>>8&255]^i[255&h]^r[d++],u=f,l=y,h=m}f=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&p])^r[d++],y=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[p>>>8&255]<<8|a[255&u])^r[d++],m=(a[h>>>24]<<24|a[p>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^r[d++],p=(a[p>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^r[d++],e[t]=f,e[t+1]=y,e[t+2]=m,e[t+3]=p},keySize:8});e.AES=t._createHelper(r)}(),d.mode.ECB=((p=d.lib.BlockCipherMode.extend()).Encryptor=p.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),p.Decryptor=p.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),p),new TextEncoder,new TextDecoder,new TextEncoder,new TextDecoder,new TextEncoder,new TextDecoder,new TextDecoder;class g extends Error{static create(e,t){return e instanceof Error?g.createFromError(e):g.createFromServiceResponse(e,t)}static createFromError(e){let t=o.PNUnknownCategory,r="Unknown error",n="Error";if(!e)return new g(r,t,0);if(e instanceof g)return e;if(e instanceof Error&&(r=e.message,n=e.name),"AbortError"===n||-1!==r.indexOf("Aborted"))t=o.PNCancelledCategory,r="Request cancelled";else if(-1!==r.indexOf("timeout"))t=o.PNTimeoutCategory,r="Request timeout";else if(-1!==r.indexOf("network"))t=o.PNNetworkIssuesCategory,r="Network issues";else if("TypeError"===n)t=-1!==r.indexOf("Load failed")||-1!=r.indexOf("Failed to fetch")?o.PNTimeoutCategory:o.PNBadRequestCategory;else if("FetchError"===n){const n=e.code;["ECONNREFUSED","ENETUNREACH","ENOTFOUND","ECONNRESET","EAI_AGAIN"].includes(n)&&(t=o.PNNetworkIssuesCategory),"ECONNREFUSED"===n?r="Connection refused":"ENETUNREACH"===n?r="Network not reachable":"ENOTFOUND"===n?r="Server not found":"ECONNRESET"===n?r="Connection reset by peer":"EAI_AGAIN"===n?r="Name resolution error":"ETIMEDOUT"===n?(t=o.PNTimeoutCategory,r="Request timeout"):r=`Unknown system error: ${e}`}else"Request timeout"===r&&(t=o.PNTimeoutCategory);return new g(r,t,0,e)}static createFromServiceResponse(e,t){let r,n=o.PNUnknownCategory,s="Unknown error",{status:i}=e;if(null!=t||(t=e.body),402===i?s="Not available for used key set. Contact support@pubnub.com":400===i?(n=o.PNBadRequestCategory,s="Bad request"):403===i&&(n=o.PNAccessDeniedCategory,s="Access denied"),t&&t.byteLength>0){const n=(new TextDecoder).decode(t);if(-1!==e.headers["content-type"].indexOf("text/javascript")||-1!==e.headers["content-type"].indexOf("application/json"))try{const e=JSON.parse(n);"object"!=typeof e||Array.isArray(e)||("error"in e&&(1===e.error||!0===e.error)&&"status"in e&&"number"==typeof e.status&&"message"in e&&"service"in e?(r=e,i=e.status):r=e,"error"in e&&e.error instanceof Error&&(r=e.error))}catch(e){r=n}else if(-1!==e.headers["content-type"].indexOf("xml")){const e=/<Message>(.*)<\/Message>/gi.exec(n);s=e?`Upload to bucket failed: ${e[1]}`:"Upload to bucket failed."}else r=n}return new g(s,n,i,r)}constructor(e,t,r,n){super(e),this.category=t,this.statusCode=r,this.errorData=n,this.name="PubNubAPIError"}toStatus(e){return{error:!0,category:this.category,operation:e,statusCode:this.statusCode,errorData:this.errorData}}toPubNubError(e,t){return new i(null!=t?t:this.message,this.toStatus(e))}}const f=e=>encodeURIComponent(e).replace(/[!~*'()]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`));class y{constructor(e=!1,t){this.keepAlive=e,this.logVerbosity=t}makeSendable(e){let t,r;return e.cancellable&&(r=new AbortController,t={abortController:r,abort:()=>null==r?void 0:r.abort()}),[this.requestFromTransportRequest(e).then((t=>{const n=(new Date).getTime();this.logRequestProcessProgress(t);const s=new Promise(((t,r)=>{const n=setTimeout((()=>{clearTimeout(n),r(new Error("Request timeout"))}),1e3*e.timeout)}));return Promise.race([fetch(t,{signal:null==r?void 0:r.signal}),s]).then((e=>e.arrayBuffer().then((t=>[e,t])))).then((e=>{const r=e[1].byteLength>0?e[1]:void 0,{status:s,headers:o}=e[0],i={};o.forEach(((e,t)=>i[t]=e.toLowerCase()));const a={status:s,url:t.url,headers:i,body:r};if(s>=400)throw g.create(a);return this.logRequestProcessProgress(t,(new Date).getTime()-n,r),a})).catch((e=>{throw g.create(e)}))})),t]}request(e){return e}requestFromTransportRequest(e){return s(this,void 0,void 0,(function*(){let t,r=e.path;if(e.formData&&e.formData.length>0){e.queryParameters={};const r=e.body,n=new FormData;for(const{key:t,value:r}of e.formData)n.append(t,r);try{const e=yield r.toArrayBuffer();n.append("file",new Blob([e],{type:"application/octet-stream"}),r.name)}catch(e){try{const e=yield r.toFileUri();n.append("file",e,r.name)}catch(e){}}t=n}else e.body&&("string"==typeof e.body||e.body instanceof ArrayBuffer)&&(t=e.body);var n;return e.queryParameters&&0!==Object.keys(e.queryParameters).length&&(r=`${r}?${n=e.queryParameters,Object.keys(n).map((e=>{const t=n[e];return Array.isArray(t)?t.map((t=>`${e}=${f(t)}`)).join("&"):`${e}=${f(t)}`})).join("&")}`),new Request(`${e.origin}${r}`,{method:e.method,headers:e.headers,redirect:"follow",body:t})}))}logRequestProcessProgress(e,t,r){if(!this.logVerbosity)return;const{protocol:n,host:s,pathname:o,search:i}=new URL(e.url),a=(new Date).toISOString();if(t){const e=r?y.decoder.decode(r):void 0;console.log(">>>>>>"),console.log(`[${a} / ${t}]`,`\n${n}//${s}${o}`,`\n${i}`,`\n${e}`),console.log("-----")}else console.log("<<<<<"),console.log(`[${a}]`,`\n${n}//${s}${o}`,`\n${i}`),console.log("-----")}}y.decoder=new TextDecoder;const m=e=>{var t,r,n;return e.subscriptionWorkerUrl&&"undefined"==typeof SharedWorker&&(e.subscriptionWorkerUrl=null),Object.assign(Object.assign({},(e=>{var t,r,n,s,o,a,c,u,l,h,p,d,g,f;const y=Object.assign({},e);if(null!==(t=y.logVerbosity)&&void 0!==t||(y.logVerbosity=!1),null!==(r=y.ssl)&&void 0!==r||(y.ssl=!0),null!==(n=y.transactionalRequestTimeout)&&void 0!==n||(y.transactionalRequestTimeout=15),null!==(s=y.subscribeRequestTimeout)&&void 0!==s||(y.subscribeRequestTimeout=310),null!==(o=y.restore)&&void 0!==o||(y.restore=!1),null!==(a=y.useInstanceId)&&void 0!==a||(y.useInstanceId=!1),null!==(c=y.suppressLeaveEvents)&&void 0!==c||(y.suppressLeaveEvents=!1),null!==(u=y.requestMessageCountThreshold)&&void 0!==u||(y.requestMessageCountThreshold=100),null!==(l=y.autoNetworkDetection)&&void 0!==l||(y.autoNetworkDetection=!1),null!==(h=y.enableEventEngine)&&void 0!==h||(y.enableEventEngine=!1),null!==(p=y.maintainPresenceState)&&void 0!==p||(y.maintainPresenceState=!0),null!==(d=y.keepAlive)&&void 0!==d||(y.keepAlive=!1),y.userId&&y.uuid)throw new i("PubNub client configuration error: use only 'userId'");if(null!==(g=y.userId)&&void 0!==g||(y.userId=y.uuid),!y.userId)throw new i("PubNub client configuration error: 'userId' not set");if(0===(null===(f=y.userId)||void 0===f?void 0:f.trim().length))throw new i("PubNub client configuration error: 'userId' is empty");y.origin||(y.origin=Array.from({length:20},((e,t)=>`ps${t+1}.pndsn.com`)));const m={subscribeKey:y.subscribeKey,publishKey:y.publishKey,secretKey:y.secretKey};void 0!==y.presenceTimeout&&y.presenceTimeout<20&&(y.presenceTimeout=20,console.log("WARNING: Presence timeout is less than the minimum. Using minimum value: ",20)),void 0!==y.presenceTimeout?y.heartbeatInterval=y.presenceTimeout/2-1:y.presenceTimeout=300;let b=!1,v=!0,w=5,E=!1,C=!0;return void 0!==y.dedupeOnSubscribe&&"boolean"==typeof y.dedupeOnSubscribe&&(E=y.dedupeOnSubscribe),void 0!==y.useRequestId&&"boolean"==typeof y.useRequestId&&(C=y.useRequestId),void 0!==y.announceSuccessfulHeartbeats&&"boolean"==typeof y.announceSuccessfulHeartbeats&&(b=y.announceSuccessfulHeartbeats),void 0!==y.announceFailedHeartbeats&&"boolean"==typeof y.announceFailedHeartbeats&&(v=y.announceFailedHeartbeats),void 0!==y.fileUploadPublishRetryLimit&&"number"==typeof y.fileUploadPublishRetryLimit&&(w=y.fileUploadPublishRetryLimit),Object.assign(Object.assign({},y),{keySet:m,dedupeOnSubscribe:E,maximumCacheSize:100,useRequestId:C,announceSuccessfulHeartbeats:b,announceFailedHeartbeats:v,fileUploadPublishRetryLimit:w})})(e)),{listenToBrowserNetworkEvents:null===(t=e.listenToBrowserNetworkEvents)||void 0===t||t,subscriptionWorkerUrl:e.subscriptionWorkerUrl,subscriptionWorkerLogVerbosity:null!==(r=e.subscriptionWorkerLogVerbosity)&&void 0!==r&&r,keepAlive:null===(n=e.keepAlive)||void 0===n||n})};var b={exports:{}};
/*! lil-uuid - v0.1 - MIT License - https://github.com/lil-js/uuid */!function(e,t){!function(e){var t="0.1.0",r={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function n(){var e,t,r="";for(e=0;e<32;e++)t=16*Math.random()|0,8!==e&&12!==e&&16!==e&&20!==e||(r+="-"),r+=(12===e?4:16===e?3&t|8:t).toString(16);return r}function s(e,t){var n=r[t||"all"];return n&&n.test(e)||!1}n.isUUID=s,n.VERSION=t,e.uuid=n,e.isUUID=s}(t),null!==e&&(e.exports=t.uuid)}(b,b.exports);var v=t(b.exports),w={createUUID:()=>v.uuid?v.uuid():v()};const E=(e,t)=>{var r,n,s;null===(r=e.retryConfiguration)||void 0===r||r.validate(),null!==(n=e.useRandomIVs)&&void 0!==n||(e.useRandomIVs=true),e.origin=C(null!==(s=e.ssl)&&void 0!==s&&s,e.origin);const o=e.cryptoModule;o&&delete e.cryptoModule;const i=Object.assign(Object.assign({},e),{_pnsdkSuffix:{},_instanceId:`pn-${w.createUUID()}`,_cryptoModule:void 0,_cipherKey:void 0,_setupCryptoModule:t,get instanceId(){if(this.useInstanceId)return this._instanceId},getUserId(){return this.userId},setUserId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this.userId=e},getAuthKey(){return this.authKey},setAuthKey(e){this.authKey=e},getFilterExpression(){return this.filterExpression},setFilterExpression(e){this.filterExpression=e},getCipherKey(){return this._cipherKey},setCipherKey(t){this._cipherKey=t,t||!this._cryptoModule?t&&this._setupCryptoModule&&(this._cryptoModule=this._setupCryptoModule({cipherKey:t,useRandomIVs:e.useRandomIVs,customEncrypt:this.getCustomEncrypt(),customDecrypt:this.getCustomDecrypt()})):this._cryptoModule=void 0},getCryptoModule(){return this._cryptoModule},getUseRandomIVs:()=>e.useRandomIVs,setPresenceTimeout(e){this.heartbeatInterval=e/2-1,this.presenceTimeout=e},getPresenceTimeout(){return this.presenceTimeout},getHeartbeatInterval(){return this.heartbeatInterval},setHeartbeatInterval(e){this.heartbeatInterval=e},getTransactionTimeout(){return this.transactionalRequestTimeout},getSubscribeTimeout(){return this.subscribeRequestTimeout},get PubNubFile(){return e.PubNubFile},get version(){return"8.2.7"},getVersion(){return this.version},_addPnsdkSuffix(e,t){this._pnsdkSuffix[e]=`${t}`},_getPnsdkSuffix(e){const t=Object.values(this._pnsdkSuffix).join(e);return t.length>0?e+t:""},getUUID(){return this.getUserId()},setUUID(e){this.setUserId(e)},getCustomEncrypt:()=>e.customEncrypt,getCustomDecrypt:()=>e.customDecrypt});return e.cipherKey?i.setCipherKey(e.cipherKey):o&&(i._cryptoModule=o),i},C=(e,t)=>{const r=e?"https://":"http://";return"string"==typeof t?`${r}${t}`:`${r}${t[Math.floor(Math.random()*t.length)]}`};var N;!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.DELETE="DELETE",e.LOCAL="LOCAL"}(N||(N={})),new TextDecoder("utf-8");class P{constructor(e){this.configuration=e}makeSendable(e){return this.configuration.transport.makeSendable(this.request(e))}request(e){var t;const{clientConfiguration:r}=this.configuration;return(e=this.configuration.transport.request(e)).queryParameters||(e.queryParameters={}),r.useInstanceId&&(e.queryParameters.instanceid=r.instanceId),e.queryParameters.uuid||(e.queryParameters.uuid=r.userId),r.useRequestId&&(e.queryParameters.requestid=e.identifier),e.queryParameters.pnsdk=this.generatePNSDK(),null!==(t=e.origin)&&void 0!==t||(e.origin=r.origin),this.authenticateRequest(e),this.signRequest(e),e}authenticateRequest(e){var t;if(e.path.startsWith("/v2/auth/")||e.path.startsWith("/v3/pam/")||e.path.startsWith("/time"))return;const{clientConfiguration:r,tokenManager:n}=this.configuration,s=null!==(t=n&&n.getToken())&&void 0!==t?t:r.authKey;s&&(e.queryParameters.auth=s)}signRequest(e){this.signatureGenerator&&!e.path.startsWith("/time")&&(e.queryParameters.timestamp=String(Math.floor((new Date).getTime()/1e3)),e.queryParameters.signature=this.signatureGenerator.signature(e))}generatePNSDK(){const{clientConfiguration:e}=this.configuration;if(e.sdkName)return e.sdkName;let t=`PubNub-JS-${e.sdkFamily}`;e.partnerId&&(t+=`-${e.partnerId}`),t+=`/${e.getVersion()}`;const r=e._getPnsdkSuffix(" ");return r.length>0&&(t+=r),t}}class M{constructor(){this.listeners=[]}addListener(e){this.listeners.includes(e)||this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter((t=>t!==e))}removeAllListeners(){this.listeners=[]}announceStatus(e){this.listeners.forEach((t=>{t.status&&t.status(e)}))}announcePresence(e){this.listeners.forEach((t=>{t.presence&&t.presence(e)}))}announceMessage(e){this.listeners.forEach((t=>{t.message&&t.message(e)}))}announceSignal(e){this.listeners.forEach((t=>{t.signal&&t.signal(e)}))}announceMessageAction(e){this.listeners.forEach((t=>{t.messageAction&&t.messageAction(e)}))}announceFile(e){this.listeners.forEach((t=>{t.file&&t.file(e)}))}announceObjects(e){this.listeners.forEach((t=>{t.objects&&t.objects(e)}))}announceNetworkUp(){this.listeners.forEach((e=>{e.status&&e.status({category:o.PNNetworkUpCategory})}))}announceNetworkDown(){this.listeners.forEach((e=>{e.status&&e.status({category:o.PNNetworkDownCategory})}))}announceUser(e){this.listeners.forEach((t=>{t.user&&t.user(e)}))}announceSpace(e){this.listeners.forEach((t=>{t.space&&t.space(e)}))}announceMembership(e){this.listeners.forEach((t=>{t.membership&&t.membership(e)}))}}class k{constructor(e){this.time=e}onReconnect(e){this.callback=e}startPolling(){this.timeTimer=setInterval((()=>this.callTime()),3e3)}stopPolling(){this.timeTimer&&clearInterval(this.timeTimer),this.timeTimer=null}callTime(){this.time((e=>{e.error||(this.stopPolling(),this.callback&&this.callback())}))}}class S{_config;hashHistory;constructor({config:e}){this.hashHistory=[],this._config=e}getKey(e){const t=(e=>{let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r+=1)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t})(JSON.stringify(e.message)).toString();return`${e.timetoken}-${t}`}isDuplicate(e){return this.hashHistory.includes(this.getKey(e))}addEntry(e){this.hashHistory.length>=this._config.maximumCacheSize&&this.hashHistory.shift(),this.hashHistory.push(this.getKey(e))}clearHistory(){this.hashHistory=[]}}class O{constructor(e,t,r,n,s,o,i){this.configuration=e,this.listenerManager=t,this.eventEmitter=r,this.subscribeCall=n,this.heartbeatCall=s,this.leaveCall=o,this.reconnectionManager=new k(i),this.dedupingManager=new S({config:this.configuration}),this.heartbeatChannelGroups={},this.heartbeatChannels={},this.presenceChannelGroups={},this.presenceChannels={},this.heartbeatTimer=null,this.presenceState={},this.pendingChannelGroupSubscriptions=new Set,this.pendingChannelSubscriptions=new Set,this.channelGroups={},this.channels={},this.currentTimetoken="0",this.lastTimetoken="0",this.storedTimetoken=null,this.subscriptionStatusAnnounced=!1,this.isOnline=!0}get subscribedChannels(){return Object.keys(this.channels)}get subscribedChannelGroups(){return Object.keys(this.channelGroups)}get abort(){return this._subscribeAbort}set abort(e){this._subscribeAbort=e}disconnect(){this.stopSubscribeLoop(),this.stopHeartbeatTimer(),this.reconnectionManager.stopPolling()}reconnect(){this.startSubscribeLoop(),this.startHeartbeatTimer()}subscribe(e){const{channels:t,channelGroups:r,timetoken:n,withPresence:s=!1,withHeartbeats:o=!1}=e;n&&(this.lastTimetoken=this.currentTimetoken,this.currentTimetoken=n),"0"!==this.currentTimetoken&&0!==this.currentTimetoken&&(this.storedTimetoken=this.currentTimetoken,this.currentTimetoken=0),null==t||t.forEach((e=>{this.pendingChannelSubscriptions.add(e),this.channels[e]={},s&&(this.presenceChannels[e]={}),(o||this.configuration.getHeartbeatInterval())&&(this.heartbeatChannels[e]={})})),null==r||r.forEach((e=>{this.pendingChannelGroupSubscriptions.add(e),this.channelGroups[e]={},s&&(this.presenceChannelGroups[e]={}),(o||this.configuration.getHeartbeatInterval())&&(this.heartbeatChannelGroups[e]={})})),this.subscriptionStatusAnnounced=!1,this.reconnect()}unsubscribe(e,t){let{channels:r,channelGroups:s}=e;const o=new Set,i=new Set;null==r||r.forEach((e=>{e in this.channels&&(delete this.channels[e],i.add(e),e in this.heartbeatChannels&&delete this.heartbeatChannels[e]),e in this.presenceState&&delete this.presenceState[e],e in this.presenceChannels&&(delete this.presenceChannels[e],i.add(e))})),null==s||s.forEach((e=>{e in this.channelGroups&&(delete this.channelGroups[e],o.add(e),e in this.heartbeatChannelGroups&&delete this.heartbeatChannelGroups[e]),e in this.presenceState&&delete this.presenceState[e],e in this.presenceChannelGroups&&(delete this.presenceChannelGroups[e],o.add(e))})),0===i.size&&0===o.size||(!1!==this.configuration.suppressLeaveEvents||t||(s=Array.from(o),r=Array.from(i),this.leaveCall({channels:r,channelGroups:s},(e=>{const{error:t}=e,o=n(e,["error"]);let i;t&&(e.errorData&&"object"==typeof e.errorData&&"message"in e.errorData&&"string"==typeof e.errorData.message?i=e.errorData.message:"message"in e&&"string"==typeof e.message&&(i=e.message)),this.listenerManager.announceStatus(Object.assign(Object.assign({},o),{error:null!=i&&i,affectedChannels:r,affectedChannelGroups:s,currentTimetoken:this.currentTimetoken,lastTimetoken:this.lastTimetoken}))}))),0===Object.keys(this.channels).length&&0===Object.keys(this.presenceChannels).length&&0===Object.keys(this.channelGroups).length&&0===Object.keys(this.presenceChannelGroups).length&&(this.lastTimetoken=0,this.currentTimetoken=0,this.storedTimetoken=null,this.region=null,this.reconnectionManager.stopPolling()),this.reconnect())}unsubscribeAll(e){this.unsubscribe({channels:this.subscribedChannels,channelGroups:this.subscribedChannelGroups},e)}startSubscribeLoop(){this.stopSubscribeLoop();const e=[...Object.keys(this.channelGroups)],t=[...Object.keys(this.channels)];Object.keys(this.presenceChannelGroups).forEach((t=>e.push(`${t}-pnpres`))),Object.keys(this.presenceChannels).forEach((e=>t.push(`${e}-pnpres`))),0===t.length&&0===e.length||this.subscribeCall({channels:t,channelGroups:e,state:this.presenceState,heartbeat:this.configuration.getPresenceTimeout(),timetoken:this.currentTimetoken,region:null!==this.region?this.region:void 0,filterExpression:this.configuration.filterExpression},((e,t)=>{this.processSubscribeResponse(e,t)}))}stopSubscribeLoop(){this._subscribeAbort&&(this._subscribeAbort(),this._subscribeAbort=null)}processSubscribeResponse(e,t){if(e.error){if("object"==typeof e.errorData&&"name"in e.errorData&&"AbortError"===e.errorData.name||e.category===o.PNCancelledCategory)return;return void(e.category===o.PNTimeoutCategory?this.startSubscribeLoop():e.category===o.PNNetworkIssuesCategory?(this.disconnect(),e.error&&this.configuration.autoNetworkDetection&&this.isOnline&&(this.isOnline=!1,this.listenerManager.announceNetworkDown()),this.reconnectionManager.onReconnect((()=>{this.configuration.autoNetworkDetection&&!this.isOnline&&(this.isOnline=!0,this.listenerManager.announceNetworkUp()),this.reconnect(),this.subscriptionStatusAnnounced=!0;const t={category:o.PNReconnectedCategory,operation:e.operation,lastTimetoken:this.lastTimetoken,currentTimetoken:this.currentTimetoken};this.listenerManager.announceStatus(t)})),this.reconnectionManager.startPolling(),this.listenerManager.announceStatus(e)):e.category===o.PNBadRequestCategory?(this.stopHeartbeatTimer(),this.listenerManager.announceStatus(e)):this.listenerManager.announceStatus(e))}if(this.storedTimetoken?(this.currentTimetoken=this.storedTimetoken,this.storedTimetoken=null):(this.lastTimetoken=this.currentTimetoken,this.currentTimetoken=t.cursor.timetoken),!this.subscriptionStatusAnnounced){const t={category:o.PNConnectedCategory,operation:e.operation,affectedChannels:Array.from(this.pendingChannelSubscriptions),subscribedChannels:this.subscribedChannels,affectedChannelGroups:Array.from(this.pendingChannelGroupSubscriptions),lastTimetoken:this.lastTimetoken,currentTimetoken:this.currentTimetoken};this.subscriptionStatusAnnounced=!0,this.listenerManager.announceStatus(t),this.pendingChannelGroupSubscriptions.clear(),this.pendingChannelSubscriptions.clear()}const{messages:r}=t,{requestMessageCountThreshold:n,dedupeOnSubscribe:s}=this.configuration;n&&r.length>=n&&this.listenerManager.announceStatus({category:o.PNRequestMessageCountExceededCategory,operation:e.operation});try{r.forEach((e=>{if(s){if(this.dedupingManager.isDuplicate(e.data))return;this.dedupingManager.addEntry(e.data)}this.eventEmitter.emitEvent(e)}))}catch(e){const t={error:!0,category:o.PNUnknownCategory,errorData:e,statusCode:0};this.listenerManager.announceStatus(t)}this.region=t.cursor.region,this.startSubscribeLoop()}setState(e){const{state:t,channels:r,channelGroups:n}=e;null==r||r.forEach((e=>e in this.channels&&(this.presenceState[e]=t))),null==n||n.forEach((e=>e in this.channelGroups&&(this.presenceState[e]=t)))}changePresence(e){const{connected:t,channels:r,channelGroups:n}=e;t?(null==r||r.forEach((e=>this.heartbeatChannels[e]={})),null==n||n.forEach((e=>this.heartbeatChannelGroups[e]={}))):(null==r||r.forEach((e=>{e in this.heartbeatChannels&&delete this.heartbeatChannels[e]})),null==n||n.forEach((e=>{e in this.heartbeatChannelGroups&&delete this.heartbeatChannelGroups[e]})),!1===this.configuration.suppressLeaveEvents&&this.leaveCall({channels:r,channelGroups:n},(e=>this.listenerManager.announceStatus(e)))),this.reconnect()}startHeartbeatTimer(){this.stopHeartbeatTimer();const e=this.configuration.getHeartbeatInterval();e&&0!==e&&(this.sendHeartbeat(),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),1e3*e))}stopHeartbeatTimer(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}sendHeartbeat(){const e=Object.keys(this.heartbeatChannelGroups),t=Object.keys(this.heartbeatChannels);0===t.length&&0===e.length||this.heartbeatCall({channels:t,channelGroups:e,heartbeat:this.configuration.getPresenceTimeout(),state:this.presenceState},(e=>{e.error&&this.configuration.announceFailedHeartbeats&&this.listenerManager.announceStatus(e),e.error&&this.configuration.autoNetworkDetection&&this.isOnline&&(this.isOnline=!1,this.disconnect(),this.listenerManager.announceNetworkDown(),this.reconnect()),!e.error&&this.configuration.announceSuccessfulHeartbeats&&this.listenerManager.announceStatus(e)}))}}class A{constructor(e){this.params=e,this.requestIdentifier=w.createUUID(),this._cancellationController=null}get cancellationController(){return this._cancellationController}set cancellationController(e){this._cancellationController=e}abort(){this&&this.cancellationController&&this.cancellationController.abort()}operation(){throw Error("Should be implemented by subclass.")}validate(){}parse(e){return s(this,void 0,void 0,(function*(){throw Error("Should be implemented by subclass.")}))}request(){var e,t,r,n;const s={method:null!==(t=null===(e=this.params)||void 0===e?void 0:e.method)&&void 0!==t?t:N.GET,path:this.path,queryParameters:this.queryParameters,cancellable:null!==(n=null===(r=this.params)||void 0===r?void 0:r.cancellable)&&void 0!==n&&n,timeout:1e4,identifier:this.requestIdentifier},o=this.headers;if(o&&(s.headers=o),s.method===N.POST||s.method===N.PATCH){const[e,t]=[this.body,this.formData];t&&(s.formData=t),e&&(s.body=e)}return s}get headers(){}get path(){throw Error("`path` getter should be implemented by subclass.")}get queryParameters(){return{}}get formData(){}get body(){}deserializeResponse(e){const t=e.headers["content-type"];if(!t||-1===t.indexOf("javascript")&&-1===t.indexOf("json"))return;const r=A.decoder.decode(e.body);try{return JSON.parse(r)}catch(e){return void console.error("Error parsing JSON response:",e)}}}var _;A.decoder=new TextDecoder,function(e){e.PNPublishOperation="PNPublishOperation",e.PNSignalOperation="PNSignalOperation",e.PNSubscribeOperation="PNSubscribeOperation",e.PNUnsubscribeOperation="PNUnsubscribeOperation",e.PNWhereNowOperation="PNWhereNowOperation",e.PNHereNowOperation="PNHereNowOperation",e.PNGlobalHereNowOperation="PNGlobalHereNowOperation",e.PNSetStateOperation="PNSetStateOperation",e.PNGetStateOperation="PNGetStateOperation",e.PNHeartbeatOperation="PNHeartbeatOperation",e.PNAddMessageActionOperation="PNAddActionOperation",e.PNRemoveMessageActionOperation="PNRemoveMessageActionOperation",e.PNGetMessageActionsOperation="PNGetMessageActionsOperation",e.PNTimeOperation="PNTimeOperation",e.PNHistoryOperation="PNHistoryOperation",e.PNDeleteMessagesOperation="PNDeleteMessagesOperation",e.PNFetchMessagesOperation="PNFetchMessagesOperation",e.PNMessageCounts="PNMessageCountsOperation",e.PNGetAllUUIDMetadataOperation="PNGetAllUUIDMetadataOperation",e.PNGetUUIDMetadataOperation="PNGetUUIDMetadataOperation",e.PNSetUUIDMetadataOperation="PNSetUUIDMetadataOperation",e.PNRemoveUUIDMetadataOperation="PNRemoveUUIDMetadataOperation",e.PNGetAllChannelMetadataOperation="PNGetAllChannelMetadataOperation",e.PNGetChannelMetadataOperation="PNGetChannelMetadataOperation",e.PNSetChannelMetadataOperation="PNSetChannelMetadataOperation",e.PNRemoveChannelMetadataOperation="PNRemoveChannelMetadataOperation",e.PNGetMembersOperation="PNGetMembersOperation",e.PNSetMembersOperation="PNSetMembersOperation",e.PNGetMembershipsOperation="PNGetMembershipsOperation",e.PNSetMembershipsOperation="PNSetMembershipsOperation",e.PNListFilesOperation="PNListFilesOperation",e.PNGenerateUploadUrlOperation="PNGenerateUploadUrlOperation",e.PNPublishFileOperation="PNPublishFileOperation",e.PNPublishFileMessageOperation="PNPublishFileMessageOperation",e.PNGetFileUrlOperation="PNGetFileUrlOperation",e.PNDownloadFileOperation="PNDownloadFileOperation",e.PNDeleteFileOperation="PNDeleteFileOperation",e.PNAddPushNotificationEnabledChannelsOperation="PNAddPushNotificationEnabledChannelsOperation",e.PNRemovePushNotificationEnabledChannelsOperation="PNRemovePushNotificationEnabledChannelsOperation",e.PNPushNotificationEnabledChannelsOperation="PNPushNotificationEnabledChannelsOperation",e.PNRemoveAllPushNotificationsOperation="PNRemoveAllPushNotificationsOperation",e.PNChannelGroupsOperation="PNChannelGroupsOperation",e.PNRemoveGroupOperation="PNRemoveGroupOperation",e.PNChannelsForGroupOperation="PNChannelsForGroupOperation",e.PNAddChannelsToGroupOperation="PNAddChannelsToGroupOperation",e.PNRemoveChannelsFromGroupOperation="PNRemoveChannelsFromGroupOperation",e.PNAccessManagerGrant="PNAccessManagerGrant",e.PNAccessManagerGrantToken="PNAccessManagerGrantToken",e.PNAccessManagerAudit="PNAccessManagerAudit",e.PNAccessManagerRevokeToken="PNAccessManagerRevokeToken",e.PNHandshakeOperation="PNHandshakeOperation",e.PNReceiveMessagesOperation="PNReceiveMessagesOperation"}(_||(_={}));var T=_;var D;!function(e){e[e.Presence=-2]="Presence",e[e.Message=-1]="Message",e[e.Signal=1]="Signal",e[e.AppContext=2]="AppContext",e[e.MessageAction=3]="MessageAction",e[e.Files=4]="Files"}(D||(D={}));class x extends A{constructor(e){var t,r,n,s,o,i;super({cancellable:!0}),this.parameters=e,null!==(t=(s=this.parameters).withPresence)&&void 0!==t||(s.withPresence=false),null!==(r=(o=this.parameters).channelGroups)&&void 0!==r||(o.channelGroups=[]),null!==(n=(i=this.parameters).channels)&&void 0!==n||(i.channels=[])}operation(){return T.PNSubscribeOperation}validate(){const{keySet:{subscribeKey:e},channels:t,channelGroups:r}=this.parameters;return e?t||r?void 0:"`channels` and `channelGroups` both should not be empty":"Missing Subscribe Key"}parse(e){return s(this,void 0,void 0,(function*(){let t;try{const r=A.decoder.decode(e.body);t=JSON.parse(r)}catch(e){console.error("Error parsing JSON response:",e)}if(!t)throw new i("Service response error, check status for details",a("Unable to deserialize service response"));const r=t.m.map((e=>{let{e:t}=e;return null!=t||(t=e.c.endsWith("-pnpres")?D.Presence:D.Message),t!=D.Signal&&"string"==typeof e.d?t==D.Message?{type:D.Message,data:this.messageFromEnvelope(e)}:{type:D.Files,data:this.fileFromEnvelope(e)}:t==D.Message?{type:D.Message,data:this.messageFromEnvelope(e)}:t===D.Presence?{type:D.Presence,data:this.presenceEventFromEnvelope(e)}:t==D.Signal?{type:D.Signal,data:this.signalFromEnvelope(e)}:t===D.AppContext?{type:D.AppContext,data:this.appContextFromEnvelope(e)}:t===D.MessageAction?{type:D.MessageAction,data:this.messageActionFromEnvelope(e)}:{type:D.Files,data:this.fileFromEnvelope(e)}}));return{cursor:{timetoken:t.t.t,region:t.t.r},messages:r}}))}get headers(){return{accept:"text/javascript"}}presenceEventFromEnvelope(e){const{d:t}=e,[r,n]=this.subscriptionChannelFromEnvelope(e),s=r.replace("-pnpres",""),o=null!==n?s:null,i=null!==n?n:s;return"string"!=typeof t&&"data"in t&&(t.state=t.data,delete t.data),Object.assign({channel:s,subscription:n,actualChannel:o,subscribedChannel:i,timetoken:e.p.t},t)}messageFromEnvelope(e){const[t,r]=this.subscriptionChannelFromEnvelope(e),[n,s]=this.decryptedData(e.d),o={channel:t,subscription:r,actualChannel:null!==r?t:null,subscribedChannel:null!==r?r:t,timetoken:e.p.t,publisher:e.i,message:n};return e.u&&(o.userMetadata=e.u),s&&(o.error=s),o}signalFromEnvelope(e){const[t,r]=this.subscriptionChannelFromEnvelope(e),n={channel:t,subscription:r,timetoken:e.p.t,publisher:e.i,message:e.d};return e.u&&(n.userMetadata=e.u),n}messageActionFromEnvelope(e){const[t,r]=this.subscriptionChannelFromEnvelope(e),n=e.d;return{channel:t,subscription:r,timetoken:e.p.t,publisher:e.i,event:n.event,data:Object.assign(Object.assign({},n.data),{uuid:e.i})}}appContextFromEnvelope(e){const[t,r]=this.subscriptionChannelFromEnvelope(e),n=e.d;return{channel:t,subscription:r,timetoken:e.p.t,message:n}}fileFromEnvelope(e){const[t,r]=this.subscriptionChannelFromEnvelope(e),[n,s]=this.decryptedData(e.d);let o=s;const i={channel:t,subscription:r,timetoken:e.p.t,publisher:e.i};return e.u&&(i.userMetadata=e.u),n?"string"==typeof n?null!=o||(o="Unexpected file information payload data type."):(i.message=n.message,n.file&&(i.file={id:n.file.id,name:n.file.name,url:this.parameters.getFileUrl({id:n.file.id,name:n.file.name,channel:t})})):null!=o||(o="File information payload is missing."),o&&(i.error=o),i}subscriptionChannelFromEnvelope(e){return[e.c,void 0===e.b?e.c:e.b]}decryptedData(e){if(!this.parameters.crypto||"string"!=typeof e)return[e,void 0];let t,r;try{const r=this.parameters.crypto.decrypt(e);t=r instanceof ArrayBuffer?JSON.parse(I.decoder.decode(r)):r}catch(e){t=null,r=`Error while decrypting message content: ${e.message}`}return[null!=t?t:e,r]}}class I extends x{get path(){var e;const{keySet:{subscribeKey:t},channels:r}=this.parameters;return`/v2/subscribe/${t}/${((e,t)=>{const r=e.map((e=>f(e)));return r.length?r.join(","):null!=t?t:""})(null!==(e=null==r?void 0:r.sort())&&void 0!==e?e:[],",")}/0`}get queryParameters(){const{channelGroups:e,filterExpression:t,heartbeat:r,state:n,timetoken:s,region:o}=this.parameters,i={};return e&&e.length>0&&(i["channel-group"]=e.sort().join(",")),t&&t.length>0&&(i["filter-expr"]=t),r&&(i.heartbeat=r),n&&Object.keys(n).length>0&&(i.state=JSON.stringify(n)),void 0!==s&&"string"==typeof s?s.length>0&&"0"!==s&&(i.tt=s):void 0!==s&&s>0&&(i.tt=s),o&&(i.tr=o),i}}class R{constructor(e){this.listenerManager=e,this.channelListenerMap=new Map,this.groupListenerMap=new Map}emitEvent(e){if(e.type===D.Message)this.listenerManager.announceMessage(e.data),this.announce("message",e.data,e.data.channel,e.data.subscription);else if(e.type===D.Signal)this.listenerManager.announceSignal(e.data),this.announce("signal",e.data,e.data.channel,e.data.subscription);else if(e.type===D.Presence)this.listenerManager.announcePresence(e.data),this.announce("presence",e.data,e.data.channel,e.data.subscription);else if(e.type===D.AppContext){const{data:t}=e,{message:r}=t;if(this.listenerManager.announceObjects(t),this.announce("objects",t,t.channel,t.subscription),"uuid"===r.type){const{message:e,channel:s}=t,o=n(t,["message","channel"]),{event:i,type:a}=r,c=n(r,["event","type"]),u=Object.assign(Object.assign({},o),{spaceId:s,message:Object.assign(Object.assign({},c),{event:"set"===i?"updated":"removed",type:"user"})});this.listenerManager.announceUser(u),this.announce("user",u,u.spaceId,u.subscription)}else if("channel"===r.type){const{message:e,channel:s}=t,o=n(t,["message","channel"]),{event:i,type:a}=r,c=n(r,["event","type"]),u=Object.assign(Object.assign({},o),{spaceId:s,message:Object.assign(Object.assign({},c),{event:"set"===i?"updated":"removed",type:"space"})});this.listenerManager.announceSpace(u),this.announce("space",u,u.spaceId,u.subscription)}else if("membership"===r.type){const{message:e,channel:s}=t,o=n(t,["message","channel"]),{event:i,data:a}=r,c=n(r,["event","data"]),{uuid:u,channel:l}=a,h=n(a,["uuid","channel"]),p=Object.assign(Object.assign({},o),{spaceId:s,message:Object.assign(Object.assign({},c),{event:"set"===i?"updated":"removed",data:Object.assign(Object.assign({},h),{user:u,space:l})})});this.listenerManager.announceMembership(p),this.announce("membership",p,p.spaceId,p.subscription)}}else e.type===D.MessageAction?(this.listenerManager.announceMessageAction(e.data),this.announce("messageAction",e.data,e.data.channel,e.data.subscription)):e.type===D.Files&&(this.listenerManager.announceFile(e.data),this.announce("file",e.data,e.data.channel,e.data.subscription))}addListener(e,t,r){t&&r?(null==t||t.forEach((t=>{if(this.channelListenerMap.has(t)){const r=this.channelListenerMap.get(t);r.includes(e)||r.push(e)}else this.channelListenerMap.set(t,[e])})),null==r||r.forEach((t=>{if(this.groupListenerMap.has(t)){const r=this.groupListenerMap.get(t);r.includes(e)||r.push(e)}else this.groupListenerMap.set(t,[e])}))):this.listenerManager.addListener(e)}removeListener(e,t,r){t&&r?(null==t||t.forEach((t=>{this.channelListenerMap.has(t)&&this.channelListenerMap.set(t,this.channelListenerMap.get(t).filter((t=>t!==e)))})),null==r||r.forEach((t=>{this.groupListenerMap.has(t)&&this.groupListenerMap.set(t,this.groupListenerMap.get(t).filter((t=>t!==e)))}))):this.listenerManager.removeListener(e)}removeAllListeners(){this.listenerManager.removeAllListeners(),this.channelListenerMap.clear(),this.groupListenerMap.clear()}announce(e,t,r,n){t&&this.channelListenerMap.has(r)&&this.channelListenerMap.get(r).forEach((r=>{const n=r[e];n&&n(t)})),n&&this.groupListenerMap.has(n)&&this.groupListenerMap.get(n).forEach((r=>{const n=r[e];n&&n(t)}))}}class U{transition(e,t){var r;if(this.transitionMap.has(t.type))return null===(r=this.transitionMap.get(t.type))||void 0===r?void 0:r(e,t)}constructor(e){this.label=e,this.transitionMap=new Map,this.enterEffects=[],this.exitEffects=[]}on(e,t){return this.transitionMap.set(e,t),this}with(e,t){return[this,e,null!=t?t:[]]}onEnter(e){return this.enterEffects.push(e),this}onExit(e){return this.exitEffects.push(e),this}}function F(e,t){const r=function(...r){return{type:e,payload:null==t?void 0:t(...r)}};return r.type=e,r}function G(e,t){const r=(...r)=>({type:e,payload:t(...r),managed:!1});return r.type=e,r}function H(e,t){const r=(...r)=>({type:e,payload:t(...r),managed:!0});return r.type=e,r.cancel={type:"CANCEL",payload:e,managed:!1},r}const B=F("RECONNECT",(()=>({}))),j=F("DISCONNECT",(()=>({}))),L=F("JOINED",((e,t)=>({channels:e,groups:t}))),q=F("LEFT",((e,t)=>({channels:e,groups:t}))),K=F("LEFT_ALL",(()=>({}))),z=F("HEARTBEAT_SUCCESS",(e=>({statusCode:e}))),$=F("HEARTBEAT_FAILURE",(e=>e)),V=F("HEARTBEAT_GIVEUP",(()=>({}))),W=F("TIMES_UP",(()=>({}))),J=G("HEARTBEAT",((e,t)=>({channels:e,groups:t}))),X=G("LEAVE",((e,t)=>({channels:e,groups:t})));G("EMIT_STATUS",(e=>e));const Y=H("WAIT",(()=>({}))),Q=H("DELAYED_HEARTBEAT",(e=>e)),Z=new U("HEARTBEAT_STOPPED");Z.on(L.type,((e,t)=>Z.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),Z.on(q.type,((e,t)=>Z.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))}))),Z.on(B.type,((e,t)=>ne.with({channels:e.channels,groups:e.groups}))),Z.on(K.type,((e,t)=>se.with(void 0)));const ee=new U("HEARTBEAT_COOLDOWN");ee.onEnter((()=>Y())),ee.onExit((()=>Y.cancel)),ee.on(W.type,((e,t)=>ne.with({channels:e.channels,groups:e.groups}))),ee.on(L.type,((e,t)=>ne.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),ee.on(q.type,((e,t)=>ne.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[X(t.payload.channels,t.payload.groups)]))),ee.on(j.type,(e=>Z.with({channels:e.channels,groups:e.groups},[X(e.channels,e.groups)]))),ee.on(K.type,((e,t)=>se.with(void 0,[X(e.channels,e.groups)])));const te=new U("HEARTBEAT_FAILED");te.on(L.type,((e,t)=>ne.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),te.on(q.type,((e,t)=>ne.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[X(t.payload.channels,t.payload.groups)]))),te.on(B.type,((e,t)=>ne.with({channels:e.channels,groups:e.groups}))),te.on(j.type,((e,t)=>Z.with({channels:e.channels,groups:e.groups},[X(e.channels,e.groups)]))),te.on(K.type,((e,t)=>se.with(void 0,[X(e.channels,e.groups)])));const re=new U("HEARBEAT_RECONNECTING");re.onEnter((e=>Q(e))),re.onExit((()=>Q.cancel)),re.on(L.type,((e,t)=>ne.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),re.on(q.type,((e,t)=>ne.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[X(t.payload.channels,t.payload.groups)]))),re.on(j.type,((e,t)=>{Z.with({channels:e.channels,groups:e.groups},[X(e.channels,e.groups)])})),re.on(z.type,((e,t)=>ee.with({channels:e.channels,groups:e.groups}))),re.on($.type,((e,t)=>re.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),re.on(V.type,((e,t)=>te.with({channels:e.channels,groups:e.groups}))),re.on(K.type,((e,t)=>se.with(void 0,[X(e.channels,e.groups)])));const ne=new U("HEARTBEATING");ne.onEnter((e=>J(e.channels,e.groups))),ne.on(z.type,((e,t)=>ee.with({channels:e.channels,groups:e.groups}))),ne.on(L.type,((e,t)=>ne.with({channels:[...e.channels,...t.payload.channels],groups:[...e.groups,...t.payload.groups]}))),ne.on(q.type,((e,t)=>ne.with({channels:e.channels.filter((e=>!t.payload.channels.includes(e))),groups:e.groups.filter((e=>!t.payload.groups.includes(e)))},[X(t.payload.channels,t.payload.groups)]))),ne.on($.type,((e,t)=>re.with(Object.assign(Object.assign({},e),{attempts:0,reason:t.payload})))),ne.on(j.type,(e=>Z.with({channels:e.channels,groups:e.groups},[X(e.channels,e.groups)]))),ne.on(K.type,((e,t)=>se.with(void 0,[X(e.channels,e.groups)])));const se=new U("HEARTBEAT_INACTIVE");se.on(L.type,((e,t)=>ne.with({channels:t.payload.channels,groups:t.payload.groups})));class oe{static LinearRetryPolicy(e){return{delay:e.delay,maximumRetry:e.maximumRetry,shouldRetry(e,t){var r;return 403!==(null===(r=null==e?void 0:e.status)||void 0===r?void 0:r.statusCode)&&this.maximumRetry>t},getDelay(e,t){var r;return 1e3*((null!==(r=t.retryAfter)&&void 0!==r?r:this.delay)+Math.random())},getGiveupReason(e,t){var r;return this.maximumRetry<=t?"retry attempts exhaused.":403===(null===(r=null==e?void 0:e.status)||void 0===r?void 0:r.statusCode)?"forbidden operation.":"unknown error"},validate(){if(this.maximumRetry>10)throw new Error("Maximum retry for linear retry policy can not be more than 10")}}}static ExponentialRetryPolicy(e){return{minimumDelay:e.minimumDelay,maximumDelay:e.maximumDelay,maximumRetry:e.maximumRetry,shouldRetry(e,t){var r;return 403!==(null===(r=null==e?void 0:e.status)||void 0===r?void 0:r.statusCode)&&this.maximumRetry>t},getDelay(e,t){var r;return 1e3*((null!==(r=t.retryAfter)&&void 0!==r?r:Math.min(Math.pow(2,e),this.maximumDelay))+Math.random())},getGiveupReason(e,t){var r;return this.maximumRetry<=t?"retry attempts exhausted.":403===(null===(r=null==e?void 0:e.status)||void 0===r?void 0:r.statusCode)?"forbidden operation.":"unknown error"},validate(){if(this.minimumDelay<2)throw new Error("Minimum delay can not be set less than 2 seconds for retry");if(this.maximumDelay)throw new Error("Maximum delay can not be set more than 150 seconds for retry");if(this.maximumRetry>6)throw new Error("Maximum retry for exponential retry policy can not be more than 6")}}}}const ie=H("HANDSHAKE",((e,t)=>({channels:e,groups:t}))),ae=H("RECEIVE_MESSAGES",((e,t,r)=>({channels:e,groups:t,cursor:r}))),ce=G("EMIT_MESSAGES",(e=>e)),ue=G("EMIT_STATUS",(e=>e)),le=H("RECEIVE_RECONNECT",(e=>e)),he=H("HANDSHAKE_RECONNECT",(e=>e)),pe=F("SUBSCRIPTION_CHANGED",((e,t)=>({channels:e,groups:t}))),de=F("SUBSCRIPTION_RESTORED",((e,t,r,n)=>({channels:e,groups:t,cursor:{timetoken:r,region:null!=n?n:0}}))),ge=F("HANDSHAKE_SUCCESS",(e=>e)),fe=F("HANDSHAKE_FAILURE",(e=>e)),ye=F("HANDSHAKE_RECONNECT_SUCCESS",(e=>({cursor:e}))),me=F("HANDSHAKE_RECONNECT_FAILURE",(e=>e)),be=F("HANDSHAKE_RECONNECT_GIVEUP",(e=>e)),ve=F("RECEIVE_SUCCESS",((e,t)=>({cursor:e,events:t}))),we=F("RECEIVE_FAILURE",(e=>e)),Ee=F("RECEIVE_RECONNECT_SUCCESS",((e,t)=>({cursor:e,events:t}))),Ce=F("RECEIVE_RECONNECT_FAILURE",(e=>e)),Ne=F("RECEIVING_RECONNECT_GIVEUP",(e=>e)),Pe=F("DISCONNECT",(()=>({}))),Me=F("RECONNECT",((e,t)=>({cursor:{timetoken:null!=e?e:"",region:null!=t?t:0}}))),ke=F("UNSUBSCRIBE_ALL",(()=>({}))),Se=new U("HANDSHAKE_FAILED");Se.on(pe.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Se.on(Me.type,((e,t)=>Ie.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor||e.cursor}))),Se.on(de.type,((e,t)=>{var r,n;return Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region?t.payload.cursor.region:null!==(n=null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.region)&&void 0!==n?n:0}})})),Se.on(ke.type,(e=>Re.with()));const Oe=new U("HANDSHAKE_STOPPED");Oe.on(pe.type,((e,t)=>Oe.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Oe.on(Me.type,((e,t)=>Ie.with(Object.assign(Object.assign({},e),{cursor:t.payload.cursor||e.cursor})))),Oe.on(de.type,((e,t)=>{var r;return Oe.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||(null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.region)||0}})})),Oe.on(ke.type,(e=>Re.with()));const Ae=new U("RECEIVE_FAILED");Ae.on(Me.type,((e,t)=>{var r;return Ie.with({channels:e.channels,groups:e.groups,cursor:{timetoken:t.payload.cursor.timetoken?null===(r=t.payload.cursor)||void 0===r?void 0:r.timetoken:e.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),Ae.on(pe.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Ae.on(de.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),Ae.on(ke.type,(e=>Re.with(void 0)));const _e=new U("RECEIVE_STOPPED");_e.on(pe.type,((e,t)=>_e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),_e.on(de.type,((e,t)=>_e.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),_e.on(Me.type,((e,t)=>{var r;return Ie.with({channels:e.channels,groups:e.groups,cursor:{timetoken:t.payload.cursor.timetoken?null===(r=t.payload.cursor)||void 0===r?void 0:r.timetoken:e.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),_e.on(ke.type,(()=>Re.with(void 0)));const Te=new U("RECEIVE_RECONNECTING");Te.onEnter((e=>le(e))),Te.onExit((()=>le.cancel)),Te.on(Ee.type,((e,t)=>De.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor},[ce(t.payload.events)]))),Te.on(Ce.type,((e,t)=>Te.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),Te.on(Ne.type,((e,t)=>{var r;return Ae.with({groups:e.groups,channels:e.channels,cursor:e.cursor,reason:t.payload},[ue({category:o.PNDisconnectedUnexpectedlyCategory,error:null===(r=t.payload)||void 0===r?void 0:r.message})])})),Te.on(Pe.type,(e=>_e.with({channels:e.channels,groups:e.groups,cursor:e.cursor},[ue({category:o.PNDisconnectedCategory})]))),Te.on(de.type,((e,t)=>De.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),Te.on(pe.type,((e,t)=>De.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Te.on(ke.type,(e=>Re.with(void 0,[ue({category:o.PNDisconnectedCategory})])));const De=new U("RECEIVING");De.onEnter((e=>ae(e.channels,e.groups,e.cursor))),De.onExit((()=>ae.cancel)),De.on(ve.type,((e,t)=>De.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor},[ce(t.payload.events)]))),De.on(pe.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?Re.with(void 0):De.with({cursor:e.cursor,channels:t.payload.channels,groups:t.payload.groups}))),De.on(de.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?Re.with(void 0):De.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}}))),De.on(we.type,((e,t)=>Te.with(Object.assign(Object.assign({},e),{attempts:0,reason:t.payload})))),De.on(Pe.type,(e=>_e.with({channels:e.channels,groups:e.groups,cursor:e.cursor},[ue({category:o.PNDisconnectedCategory})]))),De.on(ke.type,(e=>Re.with(void 0,[ue({category:o.PNDisconnectedCategory})])));const xe=new U("HANDSHAKE_RECONNECTING");xe.onEnter((e=>he(e))),xe.onExit((()=>he.cancel)),xe.on(ye.type,((e,t)=>{var r,n;const s={timetoken:(null===(r=e.cursor)||void 0===r?void 0:r.timetoken)?null===(n=e.cursor)||void 0===n?void 0:n.timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region};return De.with({channels:e.channels,groups:e.groups,cursor:s},[ue({category:o.PNConnectedCategory})])})),xe.on(me.type,((e,t)=>xe.with(Object.assign(Object.assign({},e),{attempts:e.attempts+1,reason:t.payload})))),xe.on(be.type,((e,t)=>{var r;return Se.with({groups:e.groups,channels:e.channels,cursor:e.cursor,reason:t.payload},[ue({category:o.PNConnectionErrorCategory,error:null===(r=t.payload)||void 0===r?void 0:r.message})])})),xe.on(Pe.type,(e=>Oe.with({channels:e.channels,groups:e.groups,cursor:e.cursor}))),xe.on(pe.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),xe.on(de.type,((e,t)=>{var r,n;return Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:(null===(r=t.payload.cursor)||void 0===r?void 0:r.region)||(null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.region)||0}})})),xe.on(ke.type,(e=>Re.with(void 0)));const Ie=new U("HANDSHAKING");Ie.onEnter((e=>ie(e.channels,e.groups))),Ie.onExit((()=>ie.cancel)),Ie.on(pe.type,((e,t)=>0===t.payload.channels.length&&0===t.payload.groups.length?Re.with(void 0):Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor}))),Ie.on(ge.type,((e,t)=>{var r,n;return De.with({channels:e.channels,groups:e.groups,cursor:{timetoken:(null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.timetoken)?null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.timetoken:t.payload.timetoken,region:t.payload.region}},[ue({category:o.PNConnectedCategory})])})),Ie.on(fe.type,((e,t)=>xe.with({channels:e.channels,groups:e.groups,cursor:e.cursor,attempts:0,reason:t.payload}))),Ie.on(Pe.type,(e=>Oe.with({channels:e.channels,groups:e.groups,cursor:e.cursor}))),Ie.on(de.type,((e,t)=>{var r;return Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||(null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.region)||0}})})),Ie.on(ke.type,(e=>Re.with()));const Re=new U("UNSUBSCRIBED");var Ue;Re.on(pe.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups}))),Re.on(de.type,((e,t)=>Ie.with({channels:t.payload.channels,groups:t.payload.groups,cursor:t.payload.cursor}))),function(e){e[e.Message=-1]="Message",e[e.Files=4]="Files"}(Ue||(Ue={}));class Fe{constructor(e,t,r){this.id=e,this.eventEmitter=t,this.pubnub=r}subscription(e){throw new Error("Subscription error: subscription module disabled")}}class Ge{constructor(e,t,r){this.eventEmitter=t,this.pubnub=r,this.name=e}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class He{constructor(e,t,r){this.id=e,this.eventEmitter=t,this.pubnub=r}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class Be{constructor(e,t,r){this.eventEmitter=t,this.pubnub=r,this.name=e}subscription(e){throw new Error("Subscription error: subscription event engine module disabled")}}class je extends A{constructor(){super()}operation(){return T.PNTimeOperation}parse(e){return s(this,void 0,void 0,(function*(){const t=this.deserializeResponse(e);if(!t)throw new i("Service response error, check status for details",a("Unable to deserialize service response"));return{timetoken:t[0]}}))}get path(){return"/time/0"}}class Le{static notificationPayload(e,t){throw new Error("Notification Payload error: publish module disabled")}static generateUUID(){return w.createUUID()}constructor(e){if(this._configuration=e.configuration,this.cryptography=e.cryptography,this.tokenManager=e.tokenManager,this.transport=e.transport,this.crypto=e.crypto,this.listenerManager=new M,this.eventEmitter=new R(this.listenerManager),this._configuration.enableEventEngine)throw new Error("Event Engine error: subscription event engine module disabled");this.subscriptionManager=new O(this._configuration,this.listenerManager,this.eventEmitter,this.makeSubscribe.bind(this),this.heartbeat.bind(this),this.makeUnsubscribe.bind(this),this.time.bind(this))}get configuration(){return this._configuration}get _config(){return this.configuration}get authKey(){var e;return null!==(e=this._configuration.authKey)&&void 0!==e?e:void 0}getAuthKey(){return this.authKey}setAuthKey(e){this._configuration.setAuthKey(e)}get userId(){return this._configuration.userId}set userId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this._configuration.userId=e}getUserId(){return this._configuration.userId}setUserId(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this._configuration.userId=e}get filterExpression(){var e;return null!==(e=this._configuration.getFilterExpression())&&void 0!==e?e:void 0}getFilterExpression(){return this.filterExpression}set filterExpression(e){this._configuration.setFilterExpression(e)}setFilterExpression(e){this.filterExpression=e}get cipherKey(){return this._configuration.getCipherKey()}set cipherKey(e){this._configuration.setCipherKey(e)}setCipherKey(e){this.cipherKey=e}set heartbeatInterval(e){this._configuration.setHeartbeatInterval(e)}setHeartbeatInterval(e){this.heartbeatInterval=e}getVersion(){return this._configuration.getVersion()}_addPnsdkSuffix(e,t){this._configuration._addPnsdkSuffix(e,t)}getUUID(){return this.userId}setUUID(e){this.userId=e}get customEncrypt(){return this._configuration.getCustomEncrypt()}get customDecrypt(){return this._configuration.getCustomDecrypt()}channel(e){return new Be(e,this.eventEmitter,this)}channelGroup(e){return new Ge(e,this.eventEmitter,this)}channelMetadata(e){return new Fe(e,this.eventEmitter,this)}userMetadata(e){return new He(e,this.eventEmitter,this)}subscriptionSet(e){throw new Error("Subscription error: subscription event engine module disabled")}sendRequest(e,t){return s(this,void 0,void 0,(function*(){const r=e.validate();if(r){if(t)return t(a(r),null);throw new i("Validation failed, check status for details",a(r))}const n=e.request();n.formData&&n.formData.length>0?n.timeout=300:e.operation()===T.PNSubscribeOperation?n.timeout=this._configuration.getSubscribeTimeout():n.timeout=this._configuration.getTransactionTimeout();const s={error:!1,operation:e.operation(),category:o.PNAcknowledgmentCategory,statusCode:0},[c,u]=this.transport.makeSendable(n);return e.cancellationController=u||null,c.then((t=>{if(s.statusCode=t.status,200!==t.status&&204!==t.status){const e=t.headers["content-type"];if(e||-1!==e.indexOf("javascript")||-1!==e.indexOf("json")){const e=JSON.parse(Le.decoder.decode(t.body));"object"==typeof e&&"error"in e&&e.error&&"object"==typeof e.error&&(s.errorData=e.error)}}return e.parse(t)})).then((e=>t?t(s,e):e)).catch((r=>{const n=r instanceof g?r:g.create(r);if(t)return t(n.toStatus(e.operation()),null);throw n.toPubNubError(e.operation(),"REST API request processing error, check status for details")}))}))}destroy(e){this.subscriptionManager?(this.subscriptionManager.unsubscribeAll(e),this.subscriptionManager.disconnect()):this.eventEngine&&this.eventEngine.dispose()}stop(){this.destroy()}addListener(e){this.listenerManager.addListener(e)}removeListener(e){this.listenerManager.removeListener(e)}removeAllListeners(){this.listenerManager.removeAllListeners()}publish(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Publish error: publish module disabled")}))}signal(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Publish error: publish module disabled")}))}fire(e,t){return s(this,void 0,void 0,(function*(){return null!=t||(t=()=>{}),this.publish(Object.assign(Object.assign({},e),{replicate:!1,storeInHistory:!1}),t)}))}getSubscribedChannels(){return this.subscriptionManager?this.subscriptionManager.subscribedChannels:this.eventEngine?this.eventEngine.getSubscribedChannels():[]}getSubscribedChannelGroups(){return this.subscriptionManager?this.subscriptionManager.subscribedChannelGroups:this.eventEngine?this.eventEngine.getSubscribedChannelGroups():[]}subscribe(e){this.subscriptionManager?this.subscriptionManager.subscribe(e):this.eventEngine&&this.eventEngine.subscribe(e)}makeSubscribe(e,t){{const r=new I(Object.assign(Object.assign({},e),{keySet:this._configuration.keySet,crypto:this._configuration.getCryptoModule(),getFileUrl:this.getFileUrl.bind(this)}));if(this.sendRequest(r,((e,n)=>{var s;this.subscriptionManager&&(null===(s=this.subscriptionManager.abort)||void 0===s?void 0:s.identifier)===r.requestIdentifier&&(this.subscriptionManager.abort=null),t(e,n)})),this.subscriptionManager){const e=()=>r.abort();e.identifier=r.requestIdentifier,this.subscriptionManager.abort=e}}}unsubscribe(e){this.subscriptionManager?this.subscriptionManager.unsubscribe(e):this.eventEngine&&this.eventEngine.unsubscribe(e)}makeUnsubscribe(e,t){throw new Error("Unsubscription error: presence module disabled")}unsubscribeAll(){this.subscriptionManager?this.subscriptionManager.unsubscribeAll():this.eventEngine&&this.eventEngine.unsubscribeAll()}disconnect(){this.subscriptionManager?this.subscriptionManager.disconnect():this.eventEngine&&this.eventEngine.disconnect()}reconnect(e){this.subscriptionManager?this.subscriptionManager.reconnect():this.eventEngine&&this.eventEngine.reconnect(null!=e?e:{})}subscribeHandshake(e){return s(this,void 0,void 0,(function*(){throw new Error("Subscription error: subscription event engine module disabled")}))}subscribeReceiveMessages(e){return s(this,void 0,void 0,(function*(){throw new Error("Subscription error: subscription event engine module disabled")}))}getMessageActions(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get Message Actions error: message reactions module disabled")}))}addMessageAction(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Add Message Action error: message reactions module disabled")}))}removeMessageAction(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Remove Message Action error: message reactions module disabled")}))}fetchMessages(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Messages History error: message persistence module disabled")}))}deleteMessages(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Delete Messages error: message persistence module disabled")}))}messageCounts(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get Messages Count error: message persistence module disabled")}))}history(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get Messages History error: message persistence module disabled")}))}hereNow(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get Channel Here Now error: presence module disabled")}))}whereNow(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get UUID Here Now error: presence module disabled")}))}getState(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Get UUID State error: presence module disabled")}))}setState(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Set UUID State error: presence module disabled")}))}presence(e){var t;null===(t=this.subscriptionManager)||void 0===t||t.changePresence(e)}heartbeat(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Announce UUID Presence error: presence module disabled")}))}join(e){throw new Error("Announce UUID Presence error: presence module disabled")}leave(e){throw new Error("Announce UUID Leave error: presence module disabled")}leaveAll(){throw new Error("Announce UUID Leave error: presence module disabled")}grantToken(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Grant Token error: PAM module disabled")}))}revokeToken(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Revoke Token error: PAM module disabled")}))}get token(){return this.tokenManager&&this.tokenManager.getToken()}getToken(){return this.token}set token(e){this.tokenManager&&this.tokenManager.setToken(e)}setToken(e){this.token=e}parseToken(e){return this.tokenManager&&this.tokenManager.parseToken(e)}grant(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Grant error: PAM module disabled")}))}audit(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Grant Permissions error: PAM module disabled")}))}get objects(){return this._objects}fetchUsers(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Users Metadata error: App Context module disabled")}))}fetchUser(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch User Metadata error: App Context module disabled")}))}createUser(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Create User Metadata error: App Context module disabled")}))}updateUser(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Update User Metadata error: App Context module disabled")}))}removeUser(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Remove User Metadata error: App Context module disabled")}))}fetchSpaces(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Spaces Metadata error: App Context module disabled")}))}fetchSpace(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Space Metadata error: App Context module disabled")}))}createSpace(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Create Space Metadata error: App Context module disabled")}))}updateSpace(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Update Space Metadata error: App Context module disabled")}))}removeSpace(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Remove Space Metadata error: App Context module disabled")}))}fetchMemberships(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Fetch Memberships error: App Context module disabled")}))}addMemberships(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Add Memberships error: App Context module disabled")}))}updateMemberships(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Update Memberships error: App Context module disabled")}))}removeMemberships(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Remove Memberships error: App Context module disabled")}))}get channelGroups(){return this._channelGroups}get push(){return this._push}sendFile(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Send File error: file sharing module disabled")}))}publishFile(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Publish File error: file sharing module disabled")}))}listFiles(e,t){return s(this,void 0,void 0,(function*(){throw new Error("List Files error: file sharing module disabled")}))}getFileUrl(e){throw new Error("Generate File Download Url error: file sharing module disabled")}downloadFile(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Download File error: file sharing module disabled")}))}deleteFile(e,t){return s(this,void 0,void 0,(function*(){throw new Error("Delete File error: file sharing module disabled")}))}time(e){return s(this,void 0,void 0,(function*(){const t=new je;return e?this.sendRequest(t,e):this.sendRequest(t)}))}encrypt(e,t){const r=this._configuration.getCryptoModule();if(!t&&r&&"string"==typeof e){const t=r.encrypt(e);return"string"==typeof t?t:function(e){let t="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(e),s=n.byteLength,o=s%3,i=s-o;let a,c,u,l,h;for(let e=0;e<i;e+=3)h=n[e]<<16|n[e+1]<<8|n[e+2],a=(16515072&h)>>18,c=(258048&h)>>12,u=(4032&h)>>6,l=63&h,t+=r[a]+r[c]+r[u]+r[l];return 1==o?(h=n[i],a=(252&h)>>2,c=(3&h)<<4,t+=r[a]+r[c]+"=="):2==o&&(h=n[i]<<8|n[i+1],a=(64512&h)>>10,c=(1008&h)>>4,u=(15&h)<<2,t+=r[a]+r[c]+r[u]+"="),t}(t)}if(!this.crypto)throw new Error("Encryption error: cypher key not set");throw new Error("Encryption error: crypto module disabled")}decrypt(e,t){const r=this._configuration.getCryptoModule();if(!t&&r){const t=r.decrypt(e);return t instanceof ArrayBuffer?JSON.parse((new TextDecoder).decode(t)):t}if(!this.crypto)throw new Error("Decryption error: cypher key not set");throw new Error("Decryption error: crypto module disabled")}encryptFile(e,t){return s(this,void 0,void 0,(function*(){if("string"!=typeof e&&(t=e),!t)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File encryption error. File constructor not configured.");if("string"!=typeof e&&!this._configuration.getCryptoModule())throw new Error("File encryption error. Crypto module not configured.");if("string"==typeof e){if(!this.cryptography)throw new Error("File encryption error. File encryption not available");throw new Error("Encryption error: file sharing module disabled")}throw new Error("Encryption error: file sharing module disabled")}))}decryptFile(e,t){return s(this,void 0,void 0,(function*(){if("string"!=typeof e&&(t=e),!t)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File decryption error. File constructor not configured.");if("string"==typeof e&&!this._configuration.getCryptoModule())throw new Error("File decryption error. Crypto module not configured.");if("string"==typeof e){if(!this.cryptography)throw new Error("File decryption error. File decryption not available");throw new Error("Decryption error: file sharing module disabled")}throw new Error("Decryption error: file sharing module disabled")}))}}Le.decoder=new TextDecoder,Le.OPERATIONS=T,Le.CATEGORIES=o,Le.ExponentialRetryPolicy=oe.ExponentialRetryPolicy,Le.LinearRetryPolicy=oe.LinearRetryPolicy;class qe extends Le{constructor(e){var t;const r=m(e),n=Object.assign(Object.assign({},r),{sdkFamily:"Web"}),s=E(n,(e=>{e.cipherKey}));let o,i=new y(s.keepAlive,s.logVerbosity);super({configuration:s,transport:new P({clientConfiguration:s,tokenManager:o,transport:i}),cryptography:undefined,tokenManager:o,crypto:undefined}),(null===(t=e.listenToBrowserNetworkEvents)||void 0===t||t)&&(window.addEventListener("offline",(()=>{this.networkDownDetected()})),window.addEventListener("online",(()=>{this.networkUpDetected()})))}networkDownDetected(){this.listenerManager.announceNetworkDown(),this._configuration.restore?this.disconnect():this.destroy(!0)}networkUpDetected(){this.listenerManager.announceNetworkUp(),this.reconnect()}}return qe.CryptoModule=void 0,qe}));
